"use strict";(()=>{var __defProp=Object.defineProperty;var __getOwnPropNames=Object.getOwnPropertyNames;var __esm=(fn,res)=>function(){return fn&&(res=(0,fn[__getOwnPropNames(fn)[0]])(fn=0)),res};var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:!0})};function Token(type,content,matchedStr,alias){this.type=type,this.content=content,this.alias=alias,this.length=matchedStr.length}var plainTextGrammar,rest,tokenize,resolve,languages,tokenizeText,withoutTokenizer,closingTag,openingTags,closingTags,highlightTokens,stringify,matchGrammar,init_index_bkac8M6P=__esm({"node_modules/.pnpm/prism-code-editor@3.4.0/node_modules/prism-code-editor/dist/index-bkac8M6P.js"(){plainTextGrammar={},rest=Symbol(),tokenize=Symbol(),resolve=id=>typeof id=="string"?languages[id]:id,languages={plain:plainTextGrammar,plaintext:plainTextGrammar,text:plainTextGrammar,txt:plainTextGrammar},tokenizeText=(text,grammar)=>(grammar[tokenize]||withoutTokenizer)(text,grammar),withoutTokenizer=(text,grammar)=>{for(var startNode=[text],restGrammar,array=[],i=0;restGrammar=resolve(grammar[rest]);)delete grammar[rest],Object.assign(grammar,restGrammar);for(matchGrammar(text,grammar,startNode,0);array[i++]=startNode[0],startNode=startNode[1];);return array},closingTag="</span>",openingTags="",closingTags="",highlightTokens=tokens=>{for(var str="",l=tokens.length,i=0;i<l;)str+=stringify(tokens[i++]);return str},stringify=token=>{if(token instanceof Token){var{type,alias,content}=token,prevOpening=openingTags,prevClosing=closingTags,opening=`<span class="token ${type+(alias?" "+alias:"")+(type=="keyword"&&typeof content=="string"?" keyword-"+content:"")}">`;closingTags+=closingTag,openingTags+=opening;var contentStr=stringify(content);return openingTags=prevOpening,closingTags=prevClosing,opening+contentStr+closingTag}return typeof token!="string"?highlightTokens(token):(token=token.replace(/&/g,"&amp;").replace(/</g,"&lt;"),closingTags&&token.includes(`
`)?token.replace(/\n/g,closingTags+`
`+openingTags):token)},matchGrammar=(text,grammar,startNode,startPos,rematch)=>{for(var token in grammar)if(grammar[token])for(var j=0,p=grammar[token],patterns=Array.isArray(p)?p:[p];j<patterns.length;++j){if(rematch&&rematch[0]==token&&rematch[1]==j)return;for(var patternObj=patterns[j],pattern=patternObj.pattern||patternObj,inside=resolve(patternObj.inside),lookbehind=patternObj.lookbehind,greedy=patternObj.greedy&&pattern.global,alias=patternObj.alias,currentNode=startNode,pos=startPos;currentNode&&(!rematch||pos<rematch[2]);pos+=currentNode[0].length,currentNode=currentNode[1]){var str=currentNode[0],removeCount=0,match,lookbehindLength;if(!(str instanceof Token)){if(pattern.lastIndex=greedy?pos:0,match=pattern.exec(greedy?text:str),match&&lookbehind&&match[1]&&(lookbehindLength=match[1].length,match.index+=lookbehindLength,match[0]=match[0].slice(lookbehindLength)),greedy){if(!match)break;if(match[0]){for(var from=match.index,to=from+match[0].length,l;from>=pos+(l=currentNode[0].length);currentNode=currentNode[1],pos+=l);if(currentNode[0]instanceof Token)continue;for(var k=currentNode,p=pos;(p+=k[0].length)<to;k=k[1],removeCount++);str=text.slice(pos,p),match.index-=pos}}if(match&&match[0]){for(var from=match.index,matchStr=match[0],after=str.slice(from+matchStr.length),reach=pos+str.length,newToken=new Token(token,inside?tokenizeText(matchStr,inside):matchStr,matchStr,alias),next=currentNode,i=0,nestedRematch;next=next[1],i++<removeCount;);after&&(!next||next[0]instanceof Token?next=[after,next]:next[0]=after+next[0]),pos+=from,currentNode[0]=from?str.slice(0,from):newToken,from?currentNode=currentNode[1]=[newToken,next]:currentNode[1]=next,removeCount&&(matchGrammar(text,grammar,currentNode,pos,nestedRematch=[token,j,reach]),reach=nestedRematch[2]),rematch&&reach>rematch[2]&&(rematch[2]=reach)}}}}}}});var createEditor,templateEl,createTemplate,addTextareaListener,getElement,userAgent,isMac,isChrome,isWebKit,numLines,languageMap,editorTemplate,preventDefault,selectionChange,init_index_BltwYS88=__esm({"node_modules/.pnpm/prism-code-editor@3.4.0/node_modules/prism-code-editor/dist/index-BltwYS88.js"(){init_index_bkac8M6P();createEditor=(container2,options,...extensions)=>{let language,grammar,prevLines=[],activeLine,value="",activeLineNumber,removed=!1,focused=!1,handleSelectionChange=!0,tokens=[],readOnly,lineCount=0,scrollContainer=editorTemplate(),wrapper=scrollContainer.firstChild,lines=wrapper.children,overlays=lines[0],textarea=overlays.firstChild,currentOptions={language:"text",value},currentExtensions=new Set(extensions),listeners={},setOptions=options2=>{if(Object.assign(currentOptions,options2),value=options2.value??value,language=currentOptions.language,!languages[language])throw Error(`Language '${language}' has no grammar.`);readOnly=!!currentOptions.readOnly,scrollContainer.style.tabSize=currentOptions.tabSize||2,textarea.inputMode=readOnly?"none":"",textarea.setAttribute("aria-readonly",readOnly),updateClassName(),updateExtensions(),(grammar!=(grammar=languages[language])||value!=textarea.value)&&(focusRelatedTarget(),textarea.value=value,textarea.selectionEnd=0,update2())},update2=()=>{tokens=tokenizeText(value=textarea.value,grammar),dispatchEvent("tokenize",tokens,language,value);let newLines=highlightTokens(tokens).split(`
`),start=0,end2=lineCount,end1=lineCount=newLines.length;for(;newLines[start]==prevLines[start]&&start<end1;)++start;for(;end1&&newLines[--end1]==prevLines[--end2];);if(start==end1&&start==end2)lines[start+1].innerHTML=newLines[start]+`
`;else{let insertStart=end2<start?end2:start-1,i=insertStart,newHTML="";for(;i<end1;)newHTML+=`<div class=pce-line aria-hidden=true>${newLines[++i]}
</div>`;for(i=end1<start?end1:start-1;i<end2;i++)lines[start+1].remove();for(newHTML&&lines[insertStart+1].insertAdjacentHTML("afterend",newHTML),i=insertStart+1;i<lineCount;)lines[++i].setAttribute("data-line",i);scrollContainer.style.setProperty("--number-width",Math.ceil(Math.log10(lineCount+1))+".001ch")}dispatchEvent("update",value),dispatchSelection(!0),handleSelectionChange&&setTimeout(setTimeout,0,()=>handleSelectionChange=!0),prevLines=newLines,handleSelectionChange=!1},updateExtensions=newExtensions=>{(newExtensions||currentExtensions).forEach(extension=>{typeof extension=="object"?(extension.update(self,currentOptions),newExtensions&&currentExtensions.add(extension)):(extension(self,currentOptions),newExtensions||currentExtensions.delete(extension))})},updateClassName=([start,end]=getInputSelection())=>{scrollContainer.className=`prism-code-editor language-${language}${currentOptions.lineNumbers==!1?"":" show-line-numbers"} pce-${currentOptions.wordWrap?"":"no"}wrap${currentOptions.rtl?" pce-rtl":""} pce-${start<end?"has":"no"}-selection${focused?" pce-focus":""}${readOnly?" pce-readonly":""}`},getInputSelection=()=>[textarea.selectionStart,textarea.selectionEnd,textarea.selectionDirection],keyCommandMap={Escape(){textarea.blur()}},inputCommandMap={},focusRelatedTarget=()=>isWebKit&&!focused&&addTextareaListener(self,"focus",e=>{let relatedTarget=e.relatedTarget;relatedTarget?relatedTarget.focus():textarea.blur()},{once:!0}),dispatchEvent=(name,...args)=>{listeners[name]?.forEach(handler=>handler.apply(self,args)),currentOptions["on"+name[0].toUpperCase()+name.slice(1)]?.apply(self,args)},dispatchSelection=force=>{if(force||handleSelectionChange){let selection=getInputSelection(),newLine=lines[activeLineNumber=numLines(value,0,selection[selection[2]<"f"?0:1])];newLine!=activeLine&&(activeLine?.classList.remove("active-line"),newLine.classList.add("active-line"),activeLine=newLine),updateClassName(selection),dispatchEvent("selectionChange",selection,value)}},self={scrollContainer,wrapper,overlays,textarea,get activeLine(){return activeLine},get activeLineNumber(){return activeLineNumber},get value(){return value},options:currentOptions,get focused(){return focused},get removed(){return removed},get tokens(){return tokens},inputCommandMap,keyCommandMap,extensions:{},setOptions,update:update2,getSelection:getInputSelection,setSelection(start,end=start,direction){focusRelatedTarget(),textarea.setSelectionRange(start,end,direction),dispatchSelection(!0)},addExtensions(...extensions2){updateExtensions(extensions2)},addListener(name,handler){(listeners[name]||(listeners[name]=new Set)).add(handler)},removeListener(name,handler){listeners[name]?.delete(handler)},remove(){scrollContainer.remove(),removed=!0}};return addTextareaListener(self,"keydown",e=>{keyCommandMap[e.key]?.(e,getInputSelection(),value)&&preventDefault(e)}),addTextareaListener(self,"beforeinput",e=>{(readOnly||e.inputType=="insertText"&&inputCommandMap[e.data]?.(e,getInputSelection(),value))&&preventDefault(e)}),addTextareaListener(self,"input",update2),addTextareaListener(self,"blur",()=>{selectionChange=null,focused=!1,updateClassName()}),addTextareaListener(self,"focus",()=>{selectionChange=dispatchSelection,focused=!0,updateClassName()}),addTextareaListener(self,"selectionchange",e=>{dispatchSelection(),preventDefault(e)}),getElement(container2)?.append(scrollContainer),options&&setOptions(options),self},templateEl=document.createElement("div"),createTemplate=html=>{templateEl.innerHTML=html;let node=templateEl.firstChild;return()=>node.cloneNode(!0)},addTextareaListener=(editor,type,listener,options)=>editor.textarea.addEventListener(type,listener,options),getElement=el=>typeof el=="string"?document.querySelector(el):el,userAgent=navigator.userAgent,isMac=/Mac|iPhone|iPod|iPad/i.test(navigator.platform),isChrome=/Chrome\//.test(userAgent),isWebKit=!isChrome&&/AppleWebKit\//.test(userAgent),numLines=(str,start=0,end=1/0)=>{let count=1;for(;(start=str.indexOf(`
`,start)+1)&&start<=end;count++);return count},languageMap={},editorTemplate=createTemplate("<div><div class=pce-wrapper><div class=pce-overlays><textarea spellcheck=false autocapitalize=off autocomplete=off>"),preventDefault=e=>{e.preventDefault(),e.stopImmediatePropagation()};document.addEventListener("selectionchange",()=>selectionChange?.())}});var init_dist=__esm({"node_modules/.pnpm/prism-code-editor@3.4.0/node_modules/prism-code-editor/dist/index.js"(){init_index_BltwYS88()}});var getLineStart,getLineEnd,addListener,getStyleValue,init_local_VpqO7_GV=__esm({"node_modules/.pnpm/prism-code-editor@3.4.0/node_modules/prism-code-editor/dist/local-VpqO7_GV.js"(){getLineStart=(text,position)=>position?text.lastIndexOf(`
`,position-1)+1:0,getLineEnd=(text,position)=>(position=text.indexOf(`
`,position))+1?position:text.length,addListener=(editor,type,listener)=>(editor.addListener(type,listener),()=>editor.removeListener(type,listener)),getStyleValue=(el,prop)=>parseFloat(getComputedStyle(el)[prop])}});var prevSelection,regexEscape,getLineBefore,getLines,getClosestToken,getLanguage,insertText,getModifierCode,init_utils=__esm({"node_modules/.pnpm/prism-code-editor@3.4.0/node_modules/prism-code-editor/dist/utils/index.js"(){init_index_BltwYS88();init_local_VpqO7_GV();regexEscape=str=>str.replace(/[$+?|.^*()[\]{}\\]/g,"\\$&"),getLineBefore=(text,position)=>text.slice(getLineStart(text,position),position),getLines=(text,start,end=start)=>[text.slice(start=getLineStart(text,start),end=getLineEnd(text,end)).split(`
`),start,end],getClosestToken=(editor,selector,marginLeft=0,marginRight=marginLeft,position=editor.getSelection()[0])=>{let value=editor.value,line=editor.wrapper.children[numLines(value,0,position)],walker=document.createTreeWalker(line,5),node=walker.lastChild(),offset=getLineEnd(value,position)+1-position-node.length;for(;-offset<=marginRight&&(node=walker.previousNode());)if(!node.lastChild&&(offset-=node.length||0,offset<=marginLeft)){for(;node!=line;node=node.parentNode)if(node.matches?.(selector))return node}},getLanguage=(editor,position)=>getClosestToken(editor,'[class*="language-"]',0,0,position)?.className.match(/language-(\S*)/)[1]||editor.options.language,insertText=(editor,text,start,end,newCursorStart,newCursorEnd)=>{if(editor.options.readOnly)return;prevSelection=editor.getSelection(),end??(end=start);let textarea=editor.textarea,value=editor.value,avoidBug=isChrome&&!value[end??prevSelection[1]]&&/\n$/.test(text)&&/^$|\n$/.test(value),removeListener;editor.focused||textarea.focus(),start!=null&&textarea.setSelectionRange(start,end),newCursorStart!=null&&(removeListener=addListener(editor,"update",()=>{textarea.setSelectionRange(newCursorStart,newCursorEnd??newCursorStart,prevSelection[2]),removeListener()})),isWebKit||textarea.dispatchEvent(new InputEvent("beforeinput",{data:text})),isChrome||isWebKit?(avoidBug&&(textarea.selectionEnd--,text=text.slice(0,-1)),isWebKit&&(text+=`
`),document.execCommand(text?"insertHTML":"delete",!1,text.replace(/&/g,"&amp;").replace(/</g,"&lt;")),avoidBug&&textarea.selectionStart++):document.execCommand(text?"insertText":"delete",!1,text),prevSelection=0},getModifierCode=e=>e.altKey+e.ctrlKey*2+e.metaKey*4+e.shiftKey*8}});var ignoreTab,clipboard,mod,setIgnoreTab,whitespaceEnd,defaultCommands,init_commands=__esm({"node_modules/.pnpm/prism-code-editor@3.4.0/node_modules/prism-code-editor/dist/extensions/commands.js"(){init_index_BltwYS88();init_utils();init_local_VpqO7_GV();ignoreTab=!1,clipboard=navigator.clipboard,mod=isMac?4:2,setIgnoreTab=newState=>ignoreTab=newState,whitespaceEnd=str=>str.search(/\S|$/),defaultCommands=(selfClosePairs=['""',"''","``","()","[]","{}"],selfCloseRegex=/([^$\w'"`]["'`]|.[[({])[.,:;\])}>\s]|.[[({]`/s)=>(editor,options)=>{let prevCopy,{keyCommandMap,inputCommandMap,getSelection,scrollContainer}=editor,getIndent=({insertSpaces=!0,tabSize}=options)=>[insertSpaces?" ":"	",insertSpaces?tabSize||2:1],scroll=()=>!options.readOnly&&!editor.extensions.cursor?.scrollIntoView(),selfClose=([start,end],[open,close],value,wrapOnly)=>(start<end||!wrapOnly&&selfCloseRegex.test((value[end-1]||" ")+open+(value[end]||" ")))&&!insertText(editor,open+value.slice(start,end)+close,null,null,start+1,end+1),skipIfEqual=([start,end],char,value)=>start==end&&value[end]==char&&!editor.setSelection(start+1),insertLines=(old,newL,start,end,selectionStart,selectionEnd)=>{let newLines=newL.join(`
`);if(newLines!=old.join(`
`)){let last=old.length-1,lastLine=newL[last],oldLastLine=old[last],lastDiff=oldLastLine.length-lastLine.length,firstDiff=newL[0].length-old[0].length,firstInsersion=start+whitespaceEnd((firstDiff<0?newL:old)[0]),lastInsersion=end-oldLastLine.length+whitespaceEnd(lastDiff>0?lastLine:oldLastLine),offset=start-end+newLines.length+lastDiff,newCursorStart=firstInsersion>selectionStart?selectionStart:Math.max(firstInsersion,selectionStart+firstDiff),newCursorEnd=selectionEnd+start-end+newLines.length;insertText(editor,newLines,start,end,newCursorStart,selectionEnd<lastInsersion?newCursorEnd+lastDiff:Math.max(lastInsersion+offset,newCursorEnd))}},indent=(outdent,lines,start1,end1,start,end,indentChar,tabSize)=>{insertLines(lines,lines.map(outdent?str=>str.slice(whitespaceEnd(str)?tabSize-whitespaceEnd(str)%tabSize:0):str=>str&&indentChar.repeat(tabSize-whitespaceEnd(str)%tabSize)+str),start1,end1,start,end)};inputCommandMap["<"]=(_e,selection,value)=>selfClose(selection,"<>",value,!0),selfClosePairs.forEach(([open,close])=>{let isQuote=open==close;inputCommandMap[open]=(_e,selection,value)=>(isQuote&&skipIfEqual(selection,close,value)||selfClose(selection,open+close,value))&&scroll(),isQuote||(inputCommandMap[close]=(_e,selection,value)=>skipIfEqual(selection,close,value)&&scroll())}),inputCommandMap[">"]=(e,selection,value)=>{let closingTag2=languageMap[getLanguage(editor)]?.autoCloseTags?.(selection,value,editor);closingTag2&&(insertText(editor,">"+closingTag2,null,null,selection[0]+1),preventDefault(e))},keyCommandMap.Tab=(e,[start,end],value)=>{if(ignoreTab||options.readOnly||getModifierCode(e)&6)return;let[indentChar,tabSize]=getIndent(options),shiftKey=e.shiftKey,[lines,start1,end1]=getLines(value,start,end);return start<end||shiftKey?indent(shiftKey,lines,start1,end1,start,end,indentChar,tabSize):insertText(editor,indentChar.repeat(tabSize-(start-start1)%tabSize)),scroll()},keyCommandMap.Enter=(e,selection,value)=>{let code=getModifierCode(e)&7;if(!code||code==mod){code&&(selection[0]=selection[1]=getLines(value,selection[1])[2]);let[indentChar,tabSize]=getIndent(),[start,end]=selection,autoIndent=languageMap[getLanguage(editor)]?.autoIndent,indenationCount=Math.floor(whitespaceEnd(getLineBefore(value,start))/tabSize)*tabSize,extraIndent=autoIndent?.[0]?.(selection,value,editor)?tabSize:0,extraLine=autoIndent?.[1]?.(selection,value,editor),newText=`
`+indentChar.repeat(indenationCount+extraIndent)+(extraLine?`
`+indentChar.repeat(indenationCount):"");if(newText[1]||value[end])return insertText(editor,newText,start,end,start+indenationCount+extraIndent+1),scroll()}},keyCommandMap.Backspace=(_e,[start,end],value)=>{if(start==end){let line=getLineBefore(value,start),tabSize=options.tabSize||2,isPair=selfClosePairs.includes(value.slice(start-1,start+1)),indenationCount=/[^ ]/.test(line)?0:(line.length-1)%tabSize+1;if(isPair||indenationCount>1)return insertText(editor,"",start-(isPair?1:indenationCount),start+isPair),scroll()}};for(let i=0;i<2;i++)keyCommandMap[i?"ArrowDown":"ArrowUp"]=(e,[start,end],value)=>{let code=getModifierCode(e);if(code==1){let newStart=i?start:getLineStart(value,start)-1,newEnd=i?value.indexOf(`
`,end)+1:end;if(newStart>-1&&newEnd>0){let[lines,start1,end1]=getLines(value,newStart,newEnd),line=lines[i?"pop":"shift"](),offset=(line.length+1)*(i?1:-1);lines[i?"unshift":"push"](line),insertText(editor,lines.join(`
`),start1,end1,start+offset,end+offset)}return scroll()}else if(code==9){let[lines,start1,end1]=getLines(value,start,end),str=lines.join(`
`),offset=i?str.length+1:0;return insertText(editor,str+`
`+str,start1,end1,start+offset,end+offset),scroll()}else if(code==2&&!isMac)return scrollContainer.scrollBy(0,getStyleValue(scrollContainer,"lineHeight")*(i?1:-1)),!0};addTextareaListener(editor,"keydown",e=>{let code=getModifierCode(e),keyCode=e.keyCode,[start,end,dir]=getSelection();if(code==mod&&(keyCode==221||keyCode==219))indent(keyCode==219,...getLines(editor.value,start,end),start,end,...getIndent()),scroll(),preventDefault(e);else if(code==(isMac?10:2)&&keyCode==77)setIgnoreTab(!ignoreTab),preventDefault(e);else if(keyCode==191&&code==mod||keyCode==65&&code==9){let value=editor.value,isBlock=code==9,position=isBlock?start:getLineStart(value,start),language=languageMap[getLanguage(editor,position)]||{},{line,block}=language.getComments?.(editor,position,value)||language.comments||{},[lines,start1,end1]=getLines(value,start,end),last=lines.length-1;if(isBlock){if(block){let[open,close]=block,text=value.slice(start,end),pos=value.slice(0,start).search(regexEscape(open)+" ?$"),matches=RegExp("^ ?"+regexEscape(close)).test(value.slice(end));pos+1&&matches?insertText(editor,text,pos,end+ +(value[end]==" ")+close.length,pos,pos+end-start):insertText(editor,`${open} ${text} ${close}`,start,end,start+open.length+1,end+open.length+1),scroll(),preventDefault(e)}}else if(line){let escaped=regexEscape(line),regex=RegExp(`^\\s*(${escaped} ?|$)`),regex2=RegExp(escaped+" ?"),allWhiteSpace=!/\S/.test(value.slice(start1,end1)),newLines=lines.map(lines.every(line2=>regex.test(line2))&&!allWhiteSpace?str=>str.replace(regex2,""):str=>allWhiteSpace||/\S/.test(str)?str.replace(/^\s*/,`$&${line} `):str);insertLines(lines,newLines,start1,end1,start,end),scroll(),preventDefault(e)}else if(block){let[open,close]=block,insertionPoint=whitespaceEnd(lines[0]),hasComment=lines[0].startsWith(open,insertionPoint)&&lines[last].endsWith(close),newLines=lines.slice();newLines[0]=lines[0].replace(hasComment?RegExp(regexEscape(open)+" ?"):/(?=\S)|$/,hasComment?"":open+" ");let diff=newLines[0].length-lines[0].length;newLines[last]=hasComment?newLines[last].replace(RegExp(`( ?${regexEscape(close)})?$`),""):newLines[last]+" "+close;let newText=newLines.join(`
`),firstInsersion=insertionPoint+start1,newStart=firstInsersion>start?start:Math.max(start+diff,firstInsersion),newEnd=firstInsersion>end-(start!=end)?end:Math.min(Math.max(firstInsersion,end+diff),start1+newText.length);insertText(editor,newText,start1,end1,newStart,Math.max(newStart,newEnd)),scroll(),preventDefault(e)}}else if(code==8+mod&&keyCode==75){let value=editor.value,[lines,start1,end1]=getLines(value,start,end),column=dir>"f"?end-end1+lines.pop().length:start-start1,newLineLen=getLineEnd(value,end1+1)-end1-1;insertText(editor,"",start1-!!start1,end1+!start1,start1+Math.min(column,newLineLen)),scroll(),preventDefault(e)}}),["copy","cut","paste"].forEach(type=>addTextareaListener(editor,type,e=>{let[start,end]=getSelection();if(start==end&&clipboard){let[[line],start1,end1]=getLines(editor.value,start,end);type=="paste"?e.clipboardData.getData("text/plain")==prevCopy&&(insertText(editor,prevCopy+`
`,start1,start1,start+prevCopy.length+1),scroll(),preventDefault(e)):(clipboard.writeText(prevCopy=line),type=="cut"&&(insertText(editor,"",start1,end1+1),scroll()),preventDefault(e))}}))}}});var insertBefore,toString,init_language_DPYOfXzt=__esm({"node_modules/.pnpm/prism-code-editor@3.4.0/node_modules/prism-code-editor/dist/language-DPYOfXzt.js"(){insertBefore=(grammar,before,insert)=>{var temp={};for(var token in grammar)temp[token]=grammar[token],delete grammar[token];for(var token in temp)token==before&&Object.assign(grammar,insert),insert.hasOwnProperty(token)||(grammar[token]=temp[token])},toString={}.toString}});var string,stringSrc,atruleInside,init_css=__esm({"node_modules/.pnpm/prism-code-editor@3.4.0/node_modules/prism-code-editor/dist/prism/languages/css.js"(){init_index_bkac8M6P();string=/(?:"(?:\\[^]|[^\\\n"])*"|'(?:\\[^]|[^\\\n'])*')/g,stringSrc=string.source,atruleInside={rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^)]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}};atruleInside[rest]=languages.css={comment:/\/\*[^]*?\*\//,atrule:{pattern:RegExp(`@[\\w-](?:[^;{\\s"']|\\s+(?!\\s)|${stringSrc})*?(?:;|(?=\\s*\\{))`),inside:atruleInside},url:{pattern:RegExp(`\\burl\\((?:${stringSrc}|(?:[^\\\\
"')=]|\\\\[^])*)\\)`,"gi"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+stringSrc+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|${stringSrc})*(?=\\s*\\{)`),lookbehind:!0},string:{pattern:string,greedy:!0},property:{pattern:/(^|[^-\w\xa0-\uffff])(?!\d)(?:(?!\s)[-\w\xa0-\uffff])+(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z\d])[-a-z\d]+(?=\()/i,lookbehind:!0},punctuation:/[(){},:;]/}}});var css,unit,number,init_css_extras=__esm({"node_modules/.pnpm/prism-code-editor@3.4.0/node_modules/prism-code-editor/dist/prism/languages/css-extras.js"(){init_index_bkac8M6P();init_language_DPYOfXzt();init_css();css=languages.css,unit={pattern:/(\b\d+)(?:%|[a-z]+(?![\w-]))/,lookbehind:!0},number={pattern:/(^|[^\w.-])-?(?:\d+(?:\.\d+)?|\.\d+)/,lookbehind:!0};css.selector.inside=css.atrule.inside["selector-function-argument"].inside={"pseudo-element":/:(?:after|before|first-letter|first-line|selection)|::[-\w]+/,"pseudo-class":/:[-\w]+/,class:/\.[-\w]+/,id:/#[-\w]+/,attribute:{pattern:/\[(?:[^[\]"']|(["'])(?:\\[^]|(?!\1)[^\\\n])*\1)*\]/g,greedy:!0,inside:{punctuation:/^\[|\]$/,"case-sensitivity":{pattern:/(\s)[si]$/i,lookbehind:!0,alias:"keyword"},namespace:{pattern:/^(\s*)(?:(?!\s)[-*\w\xa0-\uffff])*\|(?!=)/,lookbehind:!0,inside:{punctuation:/\|$/}},"attr-name":{pattern:/^(\s*)(?:(?!\s)[-\w\xa0-\uffff])+/,lookbehind:!0},"attr-value":{pattern:/(=\s*)(?:(?!\s)[-\w\xa0-\uffff])+(?=\s*$)|(["'])(?:\\[^]|(?!\2)[^\\\n])*\2/,lookbehind:!0},operator:/[|~*^$]?=/}},"n-th":[{pattern:/(\(\s*)[+-]?\d*[\dn](?:\s*[+-]\s*\d+)?(?=\s*\))/,lookbehind:!0,inside:{number:/[\dn]+/,operator:/[+-]/}},{pattern:/(\(\s*)(?:even|odd)(?=\s*\))/i,lookbehind:!0}],combinator:/>|\+|~|\|\|/,punctuation:/[(),]/};insertBefore(css,"property",{variable:{pattern:/(^|[^-\w\xa0-\uffff])--(?!\d)(?:(?!\s)[-\w\xa0-\uffff])*/i,lookbehind:!0}});insertBefore(css,"function",{operator:{pattern:/(\s)[/*+-](?!\S)/,lookbehind:!0},hexcode:{pattern:/\B#[a-f\d]{3,8}\b/i,alias:"color"},color:[{pattern:/(^|[^\w-])(?:(?:alice|cadet|cornflower|deepsky|dodger|midnight|powder|royal|sky|steel)blue|antiquewhite|aqua|aquamarine|azure|beige|bisque|black|blanchedalmond|blueviolet|brown|burlywood|chartreuse|chocolate|coral|cornsilk|crimson|(?:dark)?(?:blue|cyan|goldenrod|gr[ae]y|green|khaki|magenta|olivegreen|orange|orchid|red|salmon|seagreen|slateblue|slategr[ae]y|turquoise|violet)|deeppink|dimgr[ae]y|firebrick|floralwhite|(?:forest|lawn|lime|pale|spring)green|fuchsia|gainsboro|ghostwhite|gold|greenyellow|honeydew|hotpink|indianred|indigo|ivory|lavender|lavenderblush|lemonchiffon|light(?:blue|coral|cyan|goldenrodyellow|gr[ae]y|green|pink|salmon|seagreen|skyblue|slategr[ae]y|steelblue|yellow)|lime|linen|maroon|medium(?:aquamarine|blue|orchid|purple|seagreen|slateblue|springgreen|turquoise|violetred)|mintcream|mistyrose|moccasin|navajowhite|navy|oldlace|olive|olivedrab|orangered|palegoldenrod|paleturquoise|palevioletred|papayawhip|peachpuff|peru|pink|plum|purple|rebeccapurple|rosybrown|saddlebrown|sandybrown|seashell|sienna|silver|snow|tan|teal|thistle|tomato|transparent|wheat|white|whitesmoke|yellow|yellowgreen)(?![\w-])/i,lookbehind:!0},{pattern:/\b(?:hsl|rgb)\(\s*\d{1,3}\s*,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*\)\B|\b(?:hsl|rgb)a\(\s*\d{1,3}\s*,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*,\s*(?:0|0?\.\d+|1)\s*\)\B/i,inside:{function:/^[^(]+/,unit,number,punctuation:/[(),]/}}],entity:/\\[a-f\d]{1,8}/i,unit,number})}});var isBracketPair,openBracket,testBracketPair,clikeComment,bracketIndenting,init_index_CHhGi2gg=__esm({"node_modules/.pnpm/prism-code-editor@3.4.0/node_modules/prism-code-editor/dist/index-CHhGi2gg.js"(){init_utils();isBracketPair=/\[]|\(\)|{}/,openBracket=/[([{][^)\]}]*$/,testBracketPair=([start,end],value)=>isBracketPair.test(value[start-1]+value[end]),clikeComment={line:"//",block:["/*","*/"]},bracketIndenting=(comments=clikeComment,indentPattern=openBracket)=>({comments,autoIndent:[([start],value)=>indentPattern.test(getLineBefore(value,start)),testBracketPair]})}});var init_css2=__esm({"node_modules/.pnpm/prism-code-editor@3.4.0/node_modules/prism-code-editor/dist/languages/css.js"(){init_index_BltwYS88();init_index_CHhGi2gg();languageMap.css=bracketIndenting({block:["/*","*/"]});languageMap.less=languageMap.scss=bracketIndenting();languageMap.sass={comments:clikeComment}}});var csseditor_exports={};__export(csseditor_exports,{create:()=>create});var create,init_csseditor=__esm({"src/scripts/features/csseditor.ts"(){"use strict";init_dist();init_commands();init_css_extras();init_css2();create=options=>createEditor("#css-editor",options,defaultCommands())}});var sunrise=420,sunset=1320,dusk=60;function suntime(rise,set2){return rise&&set2&&(sunrise=minutator(new Date(rise)),sunset=minutator(new Date(set2))),dusk=100-(60*24-sunset)/8,{sunrise,sunset,dusk}}async function apiWebSocket(path){try{let socket2=new WebSocket(`wss://services.bonjourr.fr/${path}`);if(await new Promise(resolve2=>{socket2.onopen=()=>resolve2(!0),socket2.onerror=()=>resolve2(!1),socket2.onclose=()=>resolve2(!1)}))return socket2}catch{}}async function apiFetch(path){try{return await fetch(`https://services.bonjourr.fr${path}`)}catch{}}function stringMaxSize(str="",size){return str.length>size?str.slice(0,size):str}function minutator(date){return date.getHours()*60+date.getMinutes()}function randomString(len){let chars="abcdefghijklmnopqr";return Array.from({length:len},()=>chars[Math.floor(Math.random()*chars.length)]).join("")}function periodOfDay(time){let mins=minutator(time?new Date(time):new Date),{sunrise:sunrise2,sunset:sunset2}=suntime();return mins>=0&&mins<=sunrise2-60?"night":mins<=sunrise2+60?"noon":mins<=sunset2-60?"day":mins<=sunset2+60?"evening":mins>=sunset2+60?"night":"day"}var freqControl={set:()=>new Date().getTime(),get:(every,last)=>{let nowDate=new Date,lastDate=new Date(last||0),changed={date:nowDate.getDate()!==lastDate.getDate(),hour:nowDate.getHours()!==lastDate.getHours()};switch(every){case"day":return changed.date;case"hour":return changed.date||changed.hour;case"tabs":return!0;case"pause":return last===0;case"period":return last===0?!0:periodOfDay()!==periodOfDay(+lastDate)||!1;default:return!1}}};function bundleLinks(data){let res=[];return Object.entries(data).map(([key,val])=>{key.length===11&&key.startsWith("links")&&res.push(val)}),res}var inputThrottle=(elem,time=800)=>{let isThrottled=!0;setTimeout(()=>{isThrottled=!1,elem.removeAttribute("disabled")},time),isThrottled&&elem.setAttribute("disabled","")};function turnRefreshButton(button,canTurn){let animationOptions={duration:600,easing:"ease-out"};button.animate(canTurn?[{transform:"rotate(360deg)"}]:[{transform:"rotate(0deg)"},{transform:"rotate(90deg)"},{transform:"rotate(0deg)"}],animationOptions)}function fadeOut(){let dominterface4=document.getElementById("interface");dominterface4.click(),dominterface4.style.transition="opacity .4s",setTimeout(()=>dominterface4.style.opacity="0"),setTimeout(()=>location.reload(),400)}function isEvery(freq=""){return["tabs","hour","day","period","pause"].includes(freq)}function getHTMLTemplate(id,selector){return document.getElementById(id)?.content.cloneNode(!0)?.querySelector(selector)}function getComposedPath(target){if(!target)return[];let path=[],node=target;for(;node;)path.push(node),node=node.parentElement;return path}function rgbToHex(r,g,b){return"#"+componentToHex(r)+componentToHex(g)+componentToHex(b)}function componentToHex(c){let hex=c.toString(16);return hex.length==1?"0"+hex:hex}function equalsCaseInsensitive(a,b){return a.localeCompare(b,void 0,{sensitivity:"accent"})===0}function getSplitRangeData(id){let wrapper=document.querySelector(`#${id.replace("#","")}`),range=wrapper?.querySelector("input"),button=wrapper?.querySelector("button"),span=wrapper?.querySelectorAll("span"),isButtonOn=button?.classList?.contains("on");return{range:range?.value,button:span?.[isButtonOn?1:0].dataset.value}}function hexColorFromSplitRange(id){let{range,button}=getSplitRangeData(id),opacity=parseInt(range??"0"),color=button==="dark"?"#000":"#fff",alpha=opacity.toString(16);return color+alpha}function opacityFromHex(hex){return parseInt(hex.slice(4),16)}function toggleDisabled(element,force){element&&(force===void 0&&(force=typeof element.getAttribute("disabled")=="string"),force?element.setAttribute("disabled",""):element.removeAttribute("disabled"))}function countryCodeToLanguageCode(lang){return lang.includes("ES")&&(lang="es"),lang==="gr"&&(lang="el"),lang==="jp"&&(lang="ja"),lang==="cz"&&(lang="cs"),lang=lang.replace("_","-"),lang}var langs_default={en:"English",fr:"Fran\xE7ais",de:"Deutsch",it:"Italiano",es:"Espa\xF1ol","pt-BR":"Portugu\xEAs (Brasil)","pt-PT":"Portugu\xEAs (Portugal)",nl:"Nederlands",da:"Dansk",sv:"Svenska",nb:"Norsk",fi:"Suomi",pl:"Polski",cs:"\u010Ce\u0161tina",hr:"Hrvatski",sk:"Slovensk\xFD",hu:"Magyar",ro:"Rom\xE2n\u0103",el:"\u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC",hy:"\u0540\u0561\u0575\u0565\u0580\u0565\u0576",sr:"\u0421\u0440\u043F\u0441\u043A\u0438 (\u045B\u0438\u0440\u0438\u043B\u0438\u0446\u0430)","sr-YU":"Srpski (latinica)",uk:"\u0423\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430",ru:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",tr:"T\xFCrk\xE7e",ar:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629",fa:"\u0641\u0627\u0631\u0633\u06CC","zh-CN":"\u7B80\u4F53\u4E2D\u6587","zh-HK":"\u7E41\u9AD4\u4E2D\u6587","zh-TW":"\u6B63\u9AD4\u4E2D\u6587",ja:"\u65E5\u672C\u8A9E",id:"Indonesia",ca:"Catal\xE0",vi:"Ti\u1EBFng Vi\u1EC7t",ko:"\uD55C\uAD6D\uC5B4"},subsets={el:"greek",ar:"arabic",fa:"arabic",ru:"cyrillic",uk:"cyrillic",sr:"cyrillic",sk:"latin-ext",hr:"latin-ext",cs:"latin-ext",pl:"latin-ext",ro:"latin-ext",tr:"latin-ext",hu:"latin-ext",vi:"latin-ext",ja:"japanese",hy:"armenian","zh-CN":"chinese-simplified","zh-HK":"chinese-traditional","zh-TW":"chinese-traditional",ko:"korean"};var CURRENT_VERSION="20.4.2",API_DOMAIN="https://services.bonjourr.fr",ENVIRONNEMENT="PROD",SYSTEM_OS=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document?"ios":window.navigator.appVersion.includes("Macintosh")?"mac":window.navigator.appVersion.includes("Windows")?"windows":window.navigator.userAgent.toLowerCase().includes("Android")?"android":"unknown",PLATFORM=window.location.protocol==="moz-extension:"?"firefox":window.location.protocol==="chrome-extension:"?"chrome":window.location.protocol==="safari-web-extension:"?"safari":"online",BROWSER=window.navigator?.userAgentData?.brands.some(b=>b.brand==="Microsoft Edge")?"edge":window.navigator?.userAgentData?.brands.some(b=>b.brand==="Opera")?"opera":window.navigator?.userAgentData?.brands.some(b=>b.brand==="Chromium")?"chrome":window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1?"firefox":window.navigator.userAgent.toLowerCase().indexOf("safari")>-1?"safari":"other",EXTENSION=PLATFORM==="online"?void 0:PLATFORM==="firefox"?browser:chrome,IS_MOBILE=navigator.userAgentData?navigator.userAgentData.mobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),DEFAULT_LANG=(()=>{for(let code of Object.keys(langs_default))if(navigator.language.replace("-","_").includes(code))return code;return"en"})(),SEARCHBAR_ENGINES=["default","google","ddg","startpage","qwant","yahoo","bing","brave","ecosia","lilo","baidu","custom"],SYNC_DEFAULT={about:{browser:PLATFORM,version:CURRENT_VERSION},showall:!1,lang:DEFAULT_LANG,dark:"system",favicon:"",tabtitle:"",greeting:"",pagegap:1,pagewidth:1600,time:!0,main:!0,dateformat:"auto",background_blur:15,background_bright:.8,background_type:"unsplash",quicklinks:!0,syncbookmarks:void 0,textShadow:.2,announcements:"major",review:0,css:"",hide:{},linkstyle:"medium",linktitles:!0,linkbackgrounds:!0,linknewtab:!1,linksrow:6,linkgroups:{on:!1,selected:"default",groups:["default"],pinned:[],synced:[]},clock:{size:1,ampm:!1,analog:!1,seconds:!1,ampmlabel:!1,worldclocks:!1,timezone:"auto"},analogstyle:{face:"none",hands:"modern",shape:"round",border:"#ffff",background:"#fff2"},worldclocks:[],unsplash:{every:"hour",collection:"",lastCollec:"day",pausedImage:void 0,time:void 0},weather:{city:void 0,unit:"metric",provider:"",moreinfo:"none",forecast:"auto",temperature:"actual",geolocation:"approximate"},notes:{on:!1,width:40,opacity:.1,align:"left"},searchbar:{on:!1,opacity:.1,newtab:!1,suggestions:!0,engine:"default",request:"",placeholder:""},quotes:{on:!1,author:!1,type:DEFAULT_LANG==="zh-CN"?"hitokoto":"classic",frequency:"day",last:void 0},font:{family:"",size:"14",system:!0,weightlist:[],weight:SYSTEM_OS==="windows"?"400":"300"},supporters:{enabled:!0,closed:!1,month:new Date().getMonth()+1},move:{selection:"single",layouts:{}}},LOCAL_DEFAULT={userQuoteSelection:0,translations:void 0,selectedId:"",idsList:[],quotesCache:[],unsplashCache:{noon:[],day:[],evening:[],night:[],user:[]},syncType:PLATFORM==="online"?"off":"browser"};function parse(str=""){try{return JSON.parse(str)}catch(error){str!==""&&console.warn("Issue in parsing: ",error)}}var storage={sync:{get:syncGet,set:syncSet,remove:syncRemove,clear:syncClear},local:{get:localGet,set:localSet,remove:localRemove,clear:localClear},init,clearall,type:storageTypeFn()},storage_default=storage;function storageTypeFn(){let type="webext-sync";function get2(){return type}function init2(){return globalThis.chrome?.storage===void 0?(type="localstorage","localstorage"):globalThis.startupStorage?.local?.syncStorage?(type="webext-local","webext-local"):type}function change(type2,data){globalThis.chrome?.storage!==void 0&&(type2==="local"&&chrome.storage.local.set({syncStorage:data}),type2==="sync"&&chrome.storage.local.remove("syncStorage").then(function(){chrome.storage.sync.set(data)}))}return{init:init2,get:get2,change}}async function syncGet(key){switch(storage.type.get()){case"webext-sync":{let data=await chrome.storage.sync.get(key??null);return verifyDataAsSync(data)}case"webext-local":{let data=(await chrome.storage.local.get("syncStorage")).syncStorage;return verifyDataAsSync(data)}case"localstorage":return verifyDataAsSync(parse(localStorage.bonjourr)??{})}}async function syncSet(keyval,fn=()=>{}){switch(storage.type.get()){case"webext-sync":{chrome.storage.sync.set(keyval,fn);return}case"webext-local":{let data={...(await chrome.storage.local.get("syncStorage")).syncStorage,...keyval};chrome.storage.local.set({syncStorage:data},fn);return}case"localstorage":{if(typeof keyval!="object")return console.warn("Value is not an object: ",keyval);let data=verifyDataAsSync(parse(localStorage.bonjourr)??{});for(let[k,v]of Object.entries(keyval))data[k]=v;localStorage.bonjourr=JSON.stringify(data??{}),window.dispatchEvent(new Event("storage"))}}}async function syncRemove(key){switch(storage.type.get()){case"webext-sync":{chrome.storage.sync.remove(key);return}case"webext-local":{let data=(await chrome.storage.local.get("syncStorage")).syncStorage;await chrome.storage.local.remove("syncStorage"),delete data[key],chrome.storage.local.set({syncStorage:data})}case"localstorage":{localStorage.removeItem(key);return}}}async function syncClear(){switch(storage.type.get()){case"webext-sync":{await chrome.storage.sync.clear();return}case"webext-local":{await chrome.storage.local.remove("syncStorage");return}case"localstorage":{localStorage.removeItem("bonjourr");return}}}function localSet(value){switch(storage.type.get()){case"webext-sync":case"webext-local":{chrome.storage.local.set(value);return}case"localstorage":for(let[key,val]of Object.entries(value))return typeof val=="string"?localStorage.setItem(key,val):localStorage.setItem(key,JSON.stringify(val))}}async function localGet(keys){switch(storage.type.get()){case"webext-sync":case"webext-local":return await chrome.storage.local.get(keys);case"localstorage":{let res={};keys===void 0?keys=[...Object.keys(localStorage).filter(k=>k!=="bonjourr")]:typeof keys=="string"&&(keys=[keys]);for(let key of keys){let item=localStorage.getItem(key)??"",val=item.startsWith("{")||item.startsWith("[")?parse(item):item;val&&(res[key]=val)}return res}}}function localRemove(key){switch(storage.type.get()){case"webext-sync":case"webext-local":return chrome.storage.local.remove(key);case"localstorage":{let data=verifyDataAsSync(parse(localStorage.bonjourr)??{});delete data[key],localStorage.bonjourr=JSON.stringify(data??{})}}}async function localClear(){switch(storage.type.get()){case"webext-sync":{chrome.storage.local.clear();return}case"webext-local":{let sync=(await chrome.storage.local.get("syncStorage")).syncStorage;await chrome.storage.local.clear(),await chrome.storage.local.set({syncStorage:sync});return}case"localstorage":for(let key of Object.keys(LOCAL_DEFAULT))localStorage.removeItem(key)}}async function init(){let store=globalThis.startupStorage??{};switch(PLATFORM!=="online"&&!webextStoreReady()&&(globalThis.pageReady=!0,await new Promise(resolve2=>{document.addEventListener("webextstorage",function(event){event.detail==="sync"&&(store.sync=globalThis.startupStorage.sync),event.detail==="local"&&(store.local=globalThis.startupStorage.local),webextStoreReady()&&resolve2(!0)})})),storage.type.init()){case"webext-local":{store.sync=globalThis.startupStorage.local?.syncStorage,store.local=globalThis.startupStorage.local;break}case"webext-sync":{store.sync=globalThis.startupStorage.sync,store.local=globalThis.startupStorage.local;break}case"localstorage":{store.sync=await syncGet(),store.local=await localGet();break}}Object.keys(store.sync??{})?.length===0&&(store.sync=await getSyncDefaults());let sync=verifyDataAsSync(store.sync??{}),local=verifyDataAsLocal(store.local??{});return{sync,local};function webextStoreReady(){return!!store.sync&&!!store.local}}async function clearall(){switch(sessionStorage.clear(),localStorage.clear(),delete globalThis.startupStorage,storage.type.get()){case"webext-sync":{await chrome.storage.sync.clear(),await chrome.storage.local.clear(),chrome.storage.sync.set(SYNC_DEFAULT),chrome.storage.local.set(LOCAL_DEFAULT);return}case"webext-local":{await chrome.storage.sync.clear(),await chrome.storage.local.clear(),chrome.storage.local.set({...LOCAL_DEFAULT,syncStorage:SYNC_DEFAULT});return}}}async function getSyncDefaults(){try{let json=await(await fetch("config.json")).json();return verifyDataAsSync(json)}catch(error){console.log(error.stack)}return SYNC_DEFAULT}function isStorageDefault(data){let current=structuredClone(data);return current.review=SYNC_DEFAULT.review,current.showall=SYNC_DEFAULT.showall,current.unsplash.time=SYNC_DEFAULT.unsplash.time,current.unsplash.pausedImage=SYNC_DEFAULT.unsplash.pausedImage,current.weather.city=SYNC_DEFAULT.weather.city,current.quotes.last=SYNC_DEFAULT.quotes.last,deepEqual(current,SYNC_DEFAULT);function deepEqual(object1,object2){let keys1=Object.keys(object1),keys2=Object.keys(object2);if(keys1.length!==keys2.length)return!1;for(let key of keys1){let val1=object1[key],val2=object2[key],areObjects=isObject(val1)&&isObject(val2);if(areObjects&&!deepEqual(val1,val2)||!areObjects&&val1!==val2)return console.log(val1,val2),!1}return!0}function isObject(object){return object!=null&&typeof object=="object"}}function verifyDataAsSync(data){data=data??{};for(let key in SYNC_DEFAULT){let notAbout=key!=="about",missingKey=!(key in data);notAbout&&missingKey&&(data[key]=SYNC_DEFAULT[key])}return data}function verifyDataAsLocal(data){data=data??{};for(let key in LOCAL_DEFAULT)key in data||(data[key]=LOCAL_DEFAULT[key]);return data}var trns,currentTrnsLang="en";async function setTranslationCache(lang,local){if(lang=countryCodeToLanguageCode(lang),lang==="en"){storage_default.local.remove("translations"),trns=void 0;return}let cachedLang=local?.translations?.lang;local&&cachedLang===lang?trns=local.translations:(trns=await(await fetch(`../../_locales/${lang}/translations.json`)).json(),storage_default.local.set({translations:trns})),currentTrnsLang=lang}function traduction(scope,lang="en"){if(lang!=="en"){if(trns){let tags=(scope??document.body).querySelectorAll(".trn"),text;for(let tag of tags)text=tag.textContent?.trim()??"",tag.textContent=trns[text]??text}document.documentElement.setAttribute("lang",lang),currentTrnsLang=lang}}async function toggleTraduction(lang){let tags=document.querySelectorAll(".trn"),toggleDict={},currentDict={...trns},newDict,text;await setTranslationCache(lang),newDict=(await storage_default.local.get("translations")).translations,newDict&&currentDict?.lang===void 0&&Object.keys(newDict).forEach(key=>currentDict[key]=key);for(let[key,val]of Object.entries(currentDict))lang==="en"?toggleDict[val]=key:newDict&&(toggleDict[val]=newDict[key]);for(let tag of tags)text=tag.textContent??"",tag.textContent=toggleDict[text]??text;currentTrnsLang=lang}function getLang(){return currentTrnsLang}function tradThis(str){return trns?trns[str]??str:str}function debounce(callback,waitFor){let timeout,debounced=(...args)=>{clearTimeout(timeout),timeout=setTimeout(()=>callback(...args),waitFor)};return debounced.cancel=()=>clearTimeout(timeout),debounced}var eventDebounce=debounce(function(value){storage_default.sync.set(value)},400);var callbackList=[],areSettingsLoaded=!1;function onSettingsLoad(callback){areSettingsLoaded?callback():callbackList.push(callback)}function loadCallbacks(){for(let i=0;i<callbackList.length;i++)callbackList[i]();areSettingsLoaded=!0}function checkModifs(text,mods){for(let[name,str]of Object.entries(mods))if(text.startsWith(str+" "))return name;return""}function toHTML(self,markdown){let fragment=document.createDocumentFragment();markdown=markdown.replaceAll("	","");for(let line of markdown.split(`

`)){if(line.indexOf(`
`)===-1){fragment.appendChild(self.createLine({text:line,modif:checkModifs(line,self.mods)}));continue}for(let subline of line.split(`
`))fragment.appendChild(self.createLine({text:subline,modif:checkModifs(subline,self.mods)}))}return fragment}function toMarkdown(lines){function addModif(line){return line.dataset.list===""?"- ":line.dataset.h1===""?"# ":line.dataset.h2===""?"## ":line.dataset.h3===""?"### ":line.dataset.todoChecked===""?"[x] ":line.dataset.todo===""?"[ ] ":""}let plaintext="",modif="",isList=line=>line?.dataset.list||line?.dataset.todo;return lines.forEach((line,i)=>{modif=addModif(line),plaintext+=modif+line.textContent;let isWithinList=isList(lines[i+1])&&isList(line),isLastLine=lines.length-1===i;plaintext+=isLastLine?"":isWithinList?`
`:`

`}),plaintext}function lastTextNode(line){let lastNode=line;for(;lastNode?.childNodes.length>0;){let childNodes=Object.values(lastNode.childNodes).reverse(),textNodes=childNodes.filter(child=>child.nodeName==="#text");if(textNodes.length>0)return textNodes[0];lastNode=childNodes[0]}return lastNode}function setCaret(elem,atStart){let node=lastTextNode(elem),sel=window.getSelection(),range=document.createRange(),textlen=node.nodeValue?.length||0;range.setStart(node,atStart?0:textlen),range.setEnd(node,atStart?0:textlen),sel?.removeAllRanges(),sel?.addRange(range),sel?.collapseToEnd()}var history=[];function addUndoHistory(self,lastline){let lines=self.lines,markdown=toMarkdown(lines),index=lastline?lines.indexOf(lastline):0;markdown!==history[0]?.markdown&&(history.unshift({markdown,index}),history.length>50&&history.pop())}function initUndo(self){let timeout;new MutationObserver(()=>{timeout&&clearTimeout(timeout)}).observe(self.container,{characterData:!0,subtree:!0}),self.container.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="z"&&(timeout=window.setTimeout(()=>{applyUndo(self)},1))})}function applyUndo(self){let{markdown,index}=history[0]??{};markdown&&(Object.values(self.container.children).forEach(node=>node.remove()),self.container.appendChild(toHTML(self,markdown)),setTimeout(()=>{let editable=self.container.querySelectorAll("[contenteditable]")[index];editable&&(editable.focus(),setCaret(editable,!1))},0),history.shift(),self.container.dispatchEvent(new InputEvent("input",{inputType:"insertText",bubbles:!0,data:""})))}function copyEvent(self,ev){let selected=self.getSelectedLines();selected.length>0&&(ev.clipboardData?.setData("text/plain",toMarkdown(selected)),ev.preventDefault())}function cutEvent(self,ev){let selected=self.getSelectedLines();selected.length>0&&(ev.clipboardData?.setData("text/plain",toMarkdown(selected)),ev.preventDefault(),self.removeLines(selected),addUndoHistory(self,selected[selected.length-1]))}function pasteEvent(self,ev){ev.preventDefault();let selection=window.getSelection(),range=selection?.getRangeAt(0),text=ev.clipboardData?.getData("text")||"";if(checkModifs(text,self.mods)!==""){let editable=ev.target,newHTML=toHTML(self,text),linesInNew=newHTML.childElementCount-1,line=self.getLineFromEditable(editable),selected=self.getSelectedLines();if(selected.length>0&&(line=selected[selected.length-1]),!line?.parentElement?.dataset.pocketEditor)return;self.container.insertBefore(newHTML,self.getNextLine(line));let lastline=line.nextSibling;for(let ii=0;ii<linesInNew;ii++)lastline&&(lastline=lastline.nextSibling);if(lastline&&setCaret(lastline),line&&line.textContent===""){let areSameMods=mod2=>{let currIsMod=line?.dataset[mod2]===mod2,nextIsMod=self.getNextLine(line)?.dataset[mod2]===mod2;return currIsMod===nextIsMod};(line||areSameMods("list")||areSameMods("todo")||areSameMods("todo-checked"))&&line.remove()}self.container.dispatchEvent(new InputEvent("input",{inputType:"insertText",bubbles:!0,data:""}));return}if(selection?.rangeCount&&range){let offset=selection?.anchorOffset??0,value=selection.focusNode?.nodeValue??"";value&&selection.focusNode?(selection.focusNode.nodeValue=value.slice(0,offset)+text+value.slice(offset),selection.collapse(selection.focusNode,offset+text.length)):(range.insertNode(document.createTextNode(text)),setCaret(range.endContainer))}self.container.dispatchEvent(new InputEvent("input",{inputType:"insertText",bubbles:!0,data:""}))}function removeModifier(editable){let content=document.createElement("div"),parent=editable.parentElement;if(parent)return delete parent.dataset.list,delete parent.dataset.todo,delete parent.dataset.h1,delete parent.dataset.h2,delete parent.dataset.h3,delete parent.dataset.todoChecked,content.textContent=parent.textContent,content.setAttribute("contenteditable","true"),Object.values(parent.childNodes).forEach(node=>node.remove()),parent.appendChild(content),content.focus(),content}function lineTransform(self,editable,mod2,focus=!0){if(!mod2)return;let line=self.getLineFromEditable(editable);if(!line||line?.dataset[mod2])return;switch(line.querySelector("span[data-list-marker]")?.remove(),line.querySelector("span[data-todo-marker]")?.remove(),delete line.dataset.h1,delete line.dataset.h2,delete line.dataset.h3,delete line.dataset.list,delete line.dataset.todo,delete line.dataset.todoChecked,mod2){case"h1":case"h2":case"h3":toHeading(mod2);break;case"list":toList();break;case"todo":toTodolist(!1);break;case"todo-checked":toTodolist(!0);break}function toHeading(tag){let heading=document.createElement(tag),mod22=tag==="h1"?"#":tag==="h2"?"##":"###";heading.textContent=editable.textContent?.replace(mod22,"").trimStart()||"",heading.setAttribute("contenteditable","true"),line&&(line.dataset[tag]="",editable.replaceWith(heading)),focus&&setCaret(heading)}function toTodolist(checked){let input=document.createElement("input"),span=document.createElement("span"),p=document.createElement("p"),line2=self.getLineFromEditable(editable),content=(editable.textContent??"").replace(self.ZERO_WIDTH_WHITESPACE,"");!line2||line2.dataset.todo||((content.startsWith("[ ]")||content.startsWith("[x]"))&&(content=content.slice(4,content.length)),input.type="checkbox",input.name="checkbox",input.setAttribute("aria-label","todo list checkbox"),input.addEventListener("input",()=>{input.checked?(line2.setAttribute("data-todo-checked",""),input.setAttribute("checked","")):(line2.removeAttribute("data-todo-checked"),line2.setAttribute("data-todo",""),input.removeAttribute("checked"))}),checked&&(input.setAttribute("checked",""),line2.dataset.todoChecked=""),line2.dataset.todo="",span.dataset.todoMarker="",p.textContent=content,p.setAttribute("contenteditable","true"),editable.replaceWith(p),span.appendChild(input),line2.prepend(span),focus&&setCaret(p))}function toList(){let span=document.createElement("span"),p=document.createElement("p"),content=(editable.textContent??"").replace(self.ZERO_WIDTH_WHITESPACE,"");!line||line.dataset.list===""||(content.startsWith("-")&&(content=content?.replace("-","").trimStart()),line.dataset.list="",span.dataset.content="\u2022",span.dataset.listMarker="",p.textContent=content,p.setAttribute("contenteditable","true"),editable.replaceWith(p),line.prepend(span),focus&&setCaret(p))}}function paragraphControl(self,e){let container2=self.container,editable=e.target,range;try{let isContenteditable=editable?.hasAttribute("contenteditable"),isInput=editable?.tagName==="INPUT";if(range=window.getSelection()?.getRangeAt(0),!range||!isContenteditable||isInput)throw""}catch{return}let line=self.getLineFromEditable(editable),datasets=Object.keys(line?.dataset??{}),insertParagraph=e?.inputType==="insertParagraph",insertText2=e?.inputType==="insertText",modif;if(e.type==="beforeinput"&&insertParagraph&&line){e.preventDefault(),addUndoHistory(self,line);let textContent=(editable.textContent??"").replace(self.ZERO_WIDTH_WHITESPACE,""),cuttext=textContent.slice(0,range.startOffset),nexttext=textContent.slice(range.startOffset);if((range.startOffset===0||textContent===""&&range.startOffset===1)&&datasets.length>0){removeModifier(editable);return}line.dataset.todo===""&&(modif="todo"),line.dataset.list===""&&(modif="list"),line.dataset.todoChecked===""&&(modif="todo");let nextline=self.getNextLine(line),newline=self.createLine({text:nexttext,modif});nextline?container2.insertBefore(newline,nextline):container2?.appendChild(newline),newline.querySelector("[contenteditable]")?.focus(),editable.textContent=cuttext,container2.dispatchEvent(new InputEvent("input",{inputType:"insertText",bubbles:!0,data:""}));return}if(e.type==="input"&&insertText2){let content=(editable?.textContent??"").replace("\u200B","");for(let[mod2,val]of Object.entries(self.mods))(content.startsWith(val+" ")||content.startsWith(val+"\xA0"))&&(modif=mod2,lineTransform(self,editable,modif))}}function detectLineJump(self,ev){if(!ev.key.includes("Arrow")||!window.getSelection()?.anchorNode)return;let editable=ev.target,line=self.getLineFromEditable(editable),range=window?.getSelection()?.getRangeAt(0),txtLen=range?.startContainer?.nodeValue?.length??0;if(!range||!line)return;let prevSibling=self.getPrevLine(line),nextSibling=self.getNextLine(line),isCaretAtZero=Math.min(range?.endOffset,range?.startOffset)===0,isCaretAtEnd=Math.max(range?.endOffset,range?.startOffset)===txtLen;if(ev.key==="ArrowLeft"&&isCaretAtZero&&prevSibling)return{line,dir:"up"};if(ev.key==="ArrowRight"&&isCaretAtEnd&&nextSibling)return{line,dir:"down"};let top=!1,bottom=!1,rr=range?.getBoundingClientRect(),lr=line?.getBoundingClientRect();if(!lr||!rr||rr.y===0?(top=!0,bottom=!0):(top=lr.top-rr.top+rr.height>0,bottom=rr.bottom+rr.height-lr.bottom>0),ev.key==="ArrowUp"&&prevSibling&&top)return{line,dir:"up"};if(ev.key==="ArrowDown"&&nextSibling&&bottom)return{line,dir:"down"}}function lineSelection(self){let lines=self.lines,caretSelTimeout,lineInterval=[-1,-1],currentLine=-1,firstLine=-1;function caretSelectionDebounce(callback){clearTimeout(caretSelTimeout),caretSelTimeout=window.setTimeout(()=>{callback()},200)}function createRange(selected){if(selected||(selected=self.getSelectedLines()),selected.length===0)return;document.querySelector("#pocket-editor-mock-sel")?.remove();let mockSelection=document.createElement("pre");mockSelection.id="pocket-editor-mock-sel",mockSelection.textContent="mock-selection",mockSelection.setAttribute("contenteditable","true"),self.container.appendChild(mockSelection);let sel=window.getSelection(),range=document.createRange(),textlen=mockSelection.childNodes[0].nodeValue?.length||0;range.setStart(mockSelection.childNodes[0],0),range.setEnd(mockSelection.childNodes[0],textlen),sel?.removeAllRanges(),sel?.addRange(range)}function getLineIndex(editable){let line=self.getLineFromEditable(editable);return line?lines.indexOf(line):-1}function resetLineSelection(){let line=lines[currentLine];line?.querySelector("[contenteditable]")&&setCaret(line),currentLine=-1,firstLine=-1,lineInterval=[-1,-1],document.querySelector("#pocket-editor-mock-sel")?.remove(),self.container.removeEventListener("mousemove",mouseMoveEvent)}function addToLineSelection(index){index>firstLine&&(lineInterval[1]=index),index<firstLine&&(lineInterval[0]=index),index===firstLine&&(lineInterval=[index,index])}function changeLineSelection(index){firstLine=index,lineInterval=[index,index]}function applyLineSelection(interval){lines.forEach((line,i)=>{i>=interval[0]&&i<=interval[1]?line.setAttribute("data-selected",""):line.removeAttribute("data-selected")}),caretSelectionDebounce(()=>createRange())}function initLineSelection(index){currentLine=firstLine=index,lineInterval=[index,index]}function keyboardEvent(e){lines=self.lines;let selected=self.getSelectedLines(),isClipboardKey=e.key.match(/([x|c|v])/g),isCtrlKey=e.key==="Control"||e.key==="Meta",noSelection=selected.length>0,ctrl=e.ctrlKey||e.metaKey;if(isCtrlKey||ctrl&&isClipboardKey&&noSelection)return;if(ctrl&&e.key==="a"){window.getSelection()?.removeAllRanges(),currentLine=firstLine=0,lineInterval=[0,lines.length-1],applyLineSelection(lineInterval),e.preventDefault();return}if(noSelection){if(window.getSelection()?.removeAllRanges(),e.key==="Escape"||e.key==="Tab"){resetLineSelection(),applyLineSelection(lineInterval),e.preventDefault();return}if(e.key.includes("Arrow")){e.key.includes("Down")&&(currentLine=Math.min(currentLine+1,lines.length-1)),e.key.includes("Up")&&(currentLine=Math.max(0,currentLine-1)),e.shiftKey&&addToLineSelection(currentLine),e.shiftKey||changeLineSelection(currentLine),applyLineSelection(lineInterval),e.preventDefault();return}e.code.match(/Shift|Alt|Control|Caps/)||(resetLineSelection(),addUndoHistory(self,selected[selected.length- -1]),self.removeLines(selected),e.code==="Enter"&&e.preventDefault())}if(!e.shiftKey)return;let{line}=detectLineJump(self,e)??{};if(line){let index=lines.indexOf(line);initLineSelection(index),applyLineSelection(lineInterval),window.getSelection()?.removeAllRanges()}}function mouseMoveEvent(e){let target=e.target,selected=self.getSelectedLines();selected.length>0&&window.getSelection()?.removeAllRanges();let isCheckbox=target.getAttribute("aria-label")==="todo list checkbox",isListMarker=target.dataset.listMarker,isEditable=!!target.getAttribute("contenteditable");if(isCheckbox||isListMarker||isEditable){if(currentLine=getLineIndex(target),currentLine===firstLine&&selected.length===0)return;addToLineSelection(currentLine),applyLineSelection(lineInterval)}}function mouseDownEvent(event){let target=event.target,rightclick=event.button===2,leftclick=event.button===0,hasSelection=self.getSelectedLines().length>0;lines=self.lines,rightclick&&event.preventDefault(),leftclick&&(hasSelection&&(resetLineSelection(),applyLineSelection(lineInterval)),target.getAttribute("contenteditable")&&(initLineSelection(getLineIndex(target)),self.container.addEventListener("mousemove",mouseMoveEvent)))}function mouseClickEvent(event){!event.composedPath().includes(self.container)&&(lines=self.lines,resetLineSelection(),applyLineSelection(lineInterval)),self.container.removeEventListener("mousemove",mouseMoveEvent)}window.addEventListener("touchend",mouseClickEvent),window.addEventListener("click",mouseClickEvent),self.container.addEventListener("keydown",keyboardEvent),self.container.addEventListener("mousedown",mouseDownEvent)}function removeLineNoText(editable,prevline){setCaret(prevline),editable.parentElement?.remove()}function removeLineWithText(editable,prevLine){let node=lastTextNode(prevLine),isTextNode=node.nodeType===3,charAmount=node.nodeValue?.length||0,targetText=editable?.textContent||"";node[isTextNode?"nodeValue":"textContent"]+=targetText;let selection=window.getSelection(),range=document.createRange();range.setStart(node,isTextNode?charAmount:0),range.setEnd(node,isTextNode?charAmount:0),selection?.removeAllRanges(),selection?.addRange(range),editable.parentElement.remove()}function lineDeletion(self){let isTouchDevice="ontouchstart"in window||navigator.maxTouchPoints>0,userAgent2=navigator.userAgent.toLowerCase(),sel=window.getSelection();function applyLineRemove(ev){let editable=ev.target,line=self.getLineFromEditable(editable),isTouch="ontouchstart"in window||navigator.maxTouchPoints>0,isEditable=!!editable.getAttribute("contenteditable"),isAtStart=sel?.getRangeAt(0)?.endOffset===0,isDelEvent=ev.inputType==="deleteContentBackward";if(ev.type==="beforeinput"&&!isDelEvent||!isAtStart||!isEditable)return;if(ev.preventDefault(),line&&addUndoHistory(self,line),Object.keys(line?.dataset??{}).length>0){let newEditable=removeModifier(editable);isTouch&&newEditable&&newEditable.textContent===""&&(newEditable.textContent=self.ZERO_WIDTH_WHITESPACE,setCaret(newEditable));return}let prevline=self.getPrevLine(line);prevline&&(editable.textContent===""&&removeLineNoText(editable,prevline),editable.textContent!==""&&removeLineWithText(editable,prevline))}if(self.container.addEventListener("beforeinput",applyLineRemove),userAgent2.includes("safari")&&!userAgent2.match(/chrome|chromium/)&&self.container.addEventListener("keydown",e=>{try{let range=sel?.getRangeAt(0),isBackspacing=e.key==="Backspace",isAtContainerStart=range?.startOffset===0;isBackspacing&&isAtContainerStart&&applyLineRemove(e)}catch{}}),isTouchDevice){let triggerDeleteLine=!1;self.container.addEventListener("beforeinput",ev=>{let editable=ev.target,deleteContent=ev.inputType==="deleteContentBackward",whitespaceOnly=editable.textContent===self.ZERO_WIDTH_WHITESPACE;deleteContent&&whitespaceOnly&&(triggerDeleteLine=!0)}),self.container.addEventListener("keyup",ev=>{let editable=ev.target;if(triggerDeleteLine){triggerDeleteLine=!1,applyLineRemove(ev);return}editable.textContent===""&&(editable.textContent=self.ZERO_WIDTH_WHITESPACE,setCaret(editable))})}}function caretControl(self){let averageCharWidth=0;function initAverageCharWidth(){let p=document.createElement("p"),span=document.createElement("span");p.id="pocket-editor-mock-p",span.textContent="abcdefghijklmnopqrstuvwxyz0123456789",p?.appendChild(span),self.container.querySelector(".line [contenteditable]")?.appendChild(p),averageCharWidth=span.offsetWidth/36/2,p.remove()}function rangePosInCharLen(line,str){let sel=window.getSelection(),charCount=-1,x=getHorizontalPosition(sel,line),offset=self.caret_x??x.offset,editable=line?.querySelector("[contenteditable]"),textnode=lastTextNode(editable),range=document.createRange();range.setStart(textnode,0),range.setEnd(textnode,0);let rangeX=0;for(let i=0;i<str.length-1;i++){try{range.setStart(textnode,i),range.setEnd(textnode,i)}catch{break}if(rangeX=range.getBoundingClientRect().x-x.editable,rangeX+averageCharWidth>=offset){charCount=i;break}}return charCount}function getParagraphAsArray(line){let editable=line?.querySelector("[contenteditable]");if(!editable)return console.warn("Couldn't get string[], no contenteditable found"),[];let pos=0,rangeY=0,rangeYlast=0,lines=[""],words=(editable.textContent??"").split(" "),textnode=lastTextNode(editable),range=document.createRange();range.setStart(textnode,0),range.setEnd(textnode,0);let isWebkit=navigator.userAgent.includes("AppleWebKit");rangeYlast=rangeY=range.getBoundingClientRect().y;for(let word of words){word=word+" ",pos+=word.length;try{range.setStart(textnode,pos),range.setEnd(textnode,pos),rangeY=range.getBoundingClientRect().y}catch{}isWebkit&&(lines[0]+=word),rangeY>rangeYlast&&(isWebkit&&(lines[0]=lines[0].trimEnd()),lines.unshift(""),rangeYlast=rangeY),isWebkit===!1&&(lines[0]+=word)}return lines.reverse(),lines}self.container.addEventListener("pointerdown",function(){self.caret_x=void 0}),self.container.addEventListener("keydown",function(ev){if(!ev.key.includes("Arrow"))return;let goesRight=ev.key==="ArrowRight",goesLeft=ev.key==="ArrowLeft",{line,dir}=detectLineJump(self,ev)??{},sel=window.getSelection(),range=document.createRange(),offset=0,node;if(goesLeft||goesRight?self.caret_x=void 0:self.caret_x===void 0&&(self.caret_x=getHorizontalPosition(sel,line).offset),!!line){if(averageCharWidth===0&&initAverageCharWidth(),dir==="down"){let nextline=self.getNextLine(line)??line;node=lastTextNode(nextline);let textlen=node.nodeValue?.length||0;if(!goesRight){let rows=getParagraphAsArray(nextline);offset=rangePosInCharLen(nextline,rows[0])??-1,offset<0&&(offset=textlen)}}if(dir==="up"){let prevline=self.getPrevLine(line)??line;node=lastTextNode(prevline);let textlen=node.nodeValue?.length||0;if(offset=textlen,!goesLeft){let rows=getParagraphAsArray(prevline),lastrow=rows[rows.length-1].trimEnd(),lastrowOffset=rangePosInCharLen(prevline,lastrow)??textlen;offset=textlen-(lastrow.length-lastrowOffset),lastrowOffset<0&&(offset=textlen)}}try{range.setStart(node,offset),range.setEnd(node,offset),sel?.removeAllRanges(),sel?.addRange(range),sel?.collapseToEnd(),ev.preventDefault()}catch{console.warn("Cannot set caret")}}})}function getHorizontalPosition(selection,line){let selectionNotValid=!selection?.anchorNode;if(!line||selectionNotValid)return{editable:0,range:0,offset:0};let editable_x=line.querySelector("[contenteditable]")?.getBoundingClientRect().x??0,range_x=selection?.getRangeAt(0)?.cloneRange()?.getBoundingClientRect().x??0;return{editable:editable_x,range:range_x,offset:range_x-editable_x}}async function keybindings(self,ev){let editable=ev.target,isValid=(ev.ctrlKey||ev.metaKey)&&ev.shiftKey&&ev.code.includes("Digit"),line=self.getLineFromEditable(editable);if(isValid&&editable){let index=parseInt(ev.code.replace("Digit",""))-1,targetMod=Object.keys(self.mods)[index];if(line?.hasAttribute(`data-${targetMod}`)||index===5){ev.preventDefault(),removeModifier(editable);return}targetMod in self.mods&&targetMod!=="todo-checked"&&(ev.preventDefault(),lineTransform(self,editable,targetMod))}}var PocketEditor=class{container;lines;wrapper;caret_x;ZERO_WIDTH_WHITESPACE="\u200B";mods={h1:"#",h2:"##",h3:"###",list:"-",todo:"[ ]","todo-checked":"[x]"};constructor(parent,options){let div=document.createElement("div"),{text,defer,id}=options??{};if(this.wrapper=typeof parent=="string"?document.querySelector(parent):parent,this.container=div,this.lines=[],this.wrapper===null)throw new Error(`Pocket editor: parent "${parent}" was not found`);id&&(div.id=id),div.dataset.pocketEditor="",typeof defer=="number"?setTimeout(()=>this.init(text),defer):defer===!0?setTimeout(()=>this.init(text)):this.init(text)}init(text){let self=this;text?this.container.appendChild(toHTML(this,text)):this.container.appendChild(this.createLine({text:""})),this.wrapper&&this.wrapper.appendChild(this.container),this.container.addEventListener("beforeinput",ev=>paragraphControl(self,ev)),this.container.addEventListener("input",ev=>paragraphControl(self,ev)),this.container.addEventListener("keydown",ev=>keybindings(self,ev)),this.container.addEventListener("paste",ev=>pasteEvent(self,ev)),this.container.addEventListener("copy",ev=>copyEvent(self,ev)),this.container.addEventListener("cut",ev=>cutEvent(self,ev)),lineSelection(self),caretControl(self),lineDeletion(self),initUndo(self);let lineObserverCallback=()=>{this.lines=Object.values(this.container.children)};new MutationObserver(lineObserverCallback).observe(this.container,{childList:!0}),this.lines=Object.values(this.container.children)}get value(){return toMarkdown(this.lines)}set value(text){Object.values(this.container.children).forEach(node=>node.remove()),this.container.appendChild(toHTML(this,text))}oninput(listener){let self=this;return this.container.addEventListener("cut",cb),this.container.addEventListener("paste",cb),this.container.addEventListener("input",cb),this.container.addEventListener("beforeinput",cb),()=>{this.container.removeEventListener("cut",cb),this.container.removeEventListener("paste",cb),this.container.removeEventListener("input",cb),this.container.removeEventListener("beforeinput",cb)};function cb(e){e.type==="beforeinput"&&!e.inputType.match(/(deleteContentBackward|insertParagraph)/g)||listener(self.value)}}addEventListener(type,listener){return this.oninput(listener)}getSelectedLines(){return this.lines.filter(line=>line.dataset.selected!==void 0)??[]}getPrevLine(line){return this.lines[this.lines.indexOf(line)-1]}getNextLine(line){return this.lines[this.lines.indexOf(line)+1]}getLineFromEditable(elem){for(;elem?.parentElement;){let parent=elem.parentElement;if(parent.tagName==="DIV")return parent;elem=parent}return null}removeLines(lines){let emptyLine=this.createLine(),prevline=this.getPrevLine(lines[0]);lines.forEach(line=>line.remove()),prevline?this.insertAfter(emptyLine,prevline):this.container.prepend(emptyLine),setCaret(emptyLine),this.container.dispatchEvent(new InputEvent("input",{inputType:"deleteContent",bubbles:!0,data:""}))}createLine(props){let notesline=document.createElement("div"),editable=document.createElement("p"),mod2=props?.modif??"",mods=this.mods;return editable.setAttribute("contenteditable","true"),notesline.appendChild(editable),typeof props?.text=="string"&&(editable.textContent=props.text),mod2 in mods&&lineTransform(this,editable,mod2,!1),notesline}insertAfter(newNode,existingNode){existingNode?.parentNode?.insertBefore(newNode,existingNode.nextSibling)}},src_default=PocketEditor;globalThis.PocketEditor=PocketEditor;var container=document.getElementById("notes_container");function notes(init2,event){if(event){updateNotes(event);return}init2&&(init2.on?initNotes(init2):onSettingsLoad(()=>initNotes(init2)))}async function updateNotes(event){let notes2=(await storage_default.sync.get("notes"))?.notes;notes2&&(event?.text!==void 0&&(notes2.text=event.text),event?.align!==void 0&&(notes2.align=event.align,handleAlign(notes2.align)),event?.width!==void 0&&(notes2.width=parseInt(event.width),handleWidth(notes2.width)),event?.background&&(notes2.background=hexColorFromSplitRange("notes-background-range"),handleBackground(notes2.background)),eventDebounce({notes:notes2}))}function initNotes(init2){document.getElementById("pocket-editor")?.remove(),handleAlign(init2.align),handleWidth(init2.width),handleBackground(init2.background),handleToggle(init2.on),init2.text=init2.text??translateNotesText(),new src_default("#notes_container",{text:init2.text,id:"pocket-editor"}).oninput(content=>{updateNotes({text:content})})}function handleToggle(state){container?.classList.toggle("hidden",!state)}function handleAlign(value){container?.classList.toggle("center-align",value==="center"),container?.classList.toggle("right-align",value==="right")}function handleWidth(value){value&&document.documentElement.style.setProperty("--notes-width",value.toString()+"em")}function handleBackground(hex="#fff2"){container&&(container?.classList.toggle("opaque",hex.includes("#fff")&&opacityFromHex(hex)>7),document.documentElement.style.setProperty("--notes-background",hex))}function translateNotesText(){let lang=getLang();lang&&lang in langs_default||(lang="en");let line1=tradThis("Edit this note"),line2=tradThis("With markdown titles, lists, and checkboxes"),line3=tradThis("Learn more on <url>");return`## ${line1}!

[ ] ${line2}

[ ] ${line3.replace("<url>","https://bonjourr.fr/docs/overview")}`}function INT(d){return Math.floor(d)}function jdFromDate(dd,mm,yy){let a,y,m,jd;return a=INT((14-mm)/12),y=yy+4800-a,m=mm+12*a-3,jd=dd+INT((153*m+2)/5)+365*y+INT(y/4)-INT(y/100)+INT(y/400)-32045,jd<2299161&&(jd=dd+INT((153*m+2)/5)+365*y+INT(y/4)-32083),jd}function NewMoon(k){let T,T2,T3,dr,Jd1,M,Mpr,F,C1,deltat,JdNew;return T=k/1236.85,T2=T*T,T3=T2*T,dr=Math.PI/180,Jd1=241502075933e-5+29.53058868*k+1178e-7*T2-155e-9*T3,Jd1=Jd1+33e-5*Math.sin((166.56+132.87*T-.009173*T2)*dr),M=359.2242+29.10535608*k-333e-7*T2-347e-8*T3,Mpr=306.0253+385.81691806*k+.0107306*T2+1236e-8*T3,F=21.2964+390.67050646*k-.0016528*T2-239e-8*T3,C1=(.1734-393e-6*T)*Math.sin(M*dr)+.0021*Math.sin(2*dr*M),C1=C1-.4068*Math.sin(Mpr*dr)+.0161*Math.sin(dr*2*Mpr),C1=C1-4e-4*Math.sin(dr*3*Mpr),C1=C1+.0104*Math.sin(dr*2*F)-.0051*Math.sin(dr*(M+Mpr)),C1=C1-.0074*Math.sin(dr*(M-Mpr))+4e-4*Math.sin(dr*(2*F+M)),C1=C1-4e-4*Math.sin(dr*(2*F-M))-6e-4*Math.sin(dr*(2*F+Mpr)),C1=C1+.001*Math.sin(dr*(2*F-Mpr))+5e-4*Math.sin(dr*(2*Mpr+M)),T<-11?deltat=.001+839e-6*T+2261e-7*T2-845e-8*T3-81e-9*T*T3:deltat=-278e-6+265e-6*T+262e-6*T2,JdNew=Jd1+C1-deltat,JdNew}function SunLongitude(jdn){let T,T2,dr,M,L0,DL,L;return T=(jdn-2451545)/36525,T2=T*T,dr=Math.PI/180,M=357.5291+35999.0503*T-1559e-7*T2-48e-8*T*T2,L0=280.46645+36000.76983*T+3032e-7*T2,DL=(1.9146-.004817*T-14e-6*T2)*Math.sin(dr*M),DL=DL+(.019993-101e-6*T)*Math.sin(dr*2*M)+29e-5*Math.sin(dr*3*M),L=L0+DL,L=L*dr,L=L-Math.PI*2*INT(L/(Math.PI*2)),L}function getSunLongitude(dayNumber,timeZone){return INT(SunLongitude(dayNumber-.5-timeZone/24)/Math.PI*6)}function getNewMoonDay(k,timeZone){return INT(NewMoon(k)+.5+timeZone/24)}function getLunarMonth11(yy,timeZone){let k,off,nm,sunLong;return off=jdFromDate(31,12,yy)-2415021,k=INT(off/29.530588853),nm=getNewMoonDay(k,timeZone),sunLong=getSunLongitude(nm,timeZone),sunLong>=9&&(nm=getNewMoonDay(k-1,timeZone)),nm}function getLeapMonthOffset(a11,timeZone){let k,last,arc,i;k=INT((a11-2415021076998695e-9)/29.530588853+.5),last=0,i=1,arc=getSunLongitude(getNewMoonDay(k+i,timeZone),timeZone);do last=arc,i++,arc=getSunLongitude(getNewMoonDay(k+i,timeZone),timeZone);while(arc!=last&&i<14);return i-1}function convertSolar2Lunar(dd,mm,yy,timeZone){let k,dayNumber,monthStart,a11,b11,lunarDay,lunarMonth,lunarYear,lunarLeap;dayNumber=jdFromDate(dd,mm,yy),k=INT((dayNumber-2415021076998695e-9)/29.530588853),monthStart=getNewMoonDay(k+1,timeZone),monthStart>dayNumber&&(monthStart=getNewMoonDay(k,timeZone)),a11=getLunarMonth11(yy,timeZone),b11=a11,a11>=monthStart?(lunarYear=yy,a11=getLunarMonth11(yy-1,timeZone)):(lunarYear=yy+1,b11=getLunarMonth11(yy+1,timeZone)),lunarDay=dayNumber-monthStart+1;let diff=INT((monthStart-a11)/29);if(lunarLeap=0,lunarMonth=diff+11,b11-a11>365){let leapMonthDiff=getLeapMonthOffset(a11,timeZone);diff>=leapMonthDiff&&(lunarMonth=diff+10,diff==leapMonthDiff&&(lunarLeap=1))}return lunarMonth>12&&(lunarMonth=lunarMonth-12),lunarMonth>=11&&diff<4&&(lunarYear-=1),new Array(lunarDay,lunarMonth,lunarYear,lunarLeap)}function getVnCalendar(date){let CAN=["Gi\xE1p","\u1EA4t","B\xEDnh","\u0110inh","M\u1EADu","K\u1EF7","Canh","T\xE2n","Nh\xE2m","Qu\xFD"],CHI=["T\xFD","S\u1EEDu","D\u1EA7n","M\xE3o","Th\xECn","T\u1EF5","Ng\u1ECD","M\xF9i","Th\xE2n","D\u1EADu","Tu\u1EA5t","H\u1EE3i"],ld=convertSolar2Lunar(date.getDate(),date.getMonth()+1,date.getFullYear(),7),yearCanChi=CAN[(ld[2]+6)%10]+" "+CHI[(ld[2]+8)%12],leapText=ld[3]?" (nhu\u1EADn)":"";return`\xC2m l\u1ECBch: ${ld[0]} th\xE1ng ${ld[1]}${leapText} n\u0103m ${yearCanChi}`}async function errorMessage(error){let dominterface4=document.getElementById("interface");console.error(error);function reduceErrorStack(){try{let lines=(error.stack||"").split(`
`);return lines.forEach((line,i)=>{let start=line.indexOf(" ("),end=line.indexOf("main.js");start>0&&end>0&&(lines[i]=line.replace(line.substring(start+1,end),"").replace(")",""))}),lines.join(`
`)}catch{return"No error stack found"}}function displayMessage(dataStr){let warning=document.createElement("div"),title=document.createElement("h1"),subtitle=document.createElement("p"),errorpre=document.createElement("pre"),storagetext=document.createElement("textarea"),explain=document.createElement("p"),resetButton2=document.createElement("button"),closeError=document.createElement("button"),buttonWrap=document.createElement("div");title.textContent="Oops Bonjourr failed \u{1F616}",subtitle.textContent="Copy the error and your settings below and contact us !",explain.textContent="Sharing your settings with us helps a lot in debugging. You can also reset Bonjourr, or close this window for now if you think it is a false alert.",explain.className="error-explain",errorpre.textContent=reduceErrorStack(),storagetext.textContent=dataStr,storagetext.setAttribute("spellcheck","false"),resetButton2.textContent="Reset Bonjourr",resetButton2.addEventListener("click",()=>{warning.style.opacity="0",storage_default.sync.clear(),localStorage.clear()}),closeError.className="error-buttons-close",closeError.textContent="Close this window",closeError.addEventListener("click",()=>{sessionStorage.errorMessage="removed",warning.style.opacity="0",setTimeout(()=>warning.style.display="none",400)}),buttonWrap.className="error-buttons",buttonWrap.appendChild(resetButton2),buttonWrap.appendChild(closeError),warning.appendChild(title),warning.appendChild(subtitle),warning.appendChild(errorpre),warning.appendChild(storagetext),warning.appendChild(explain),warning.appendChild(buttonWrap),warning.id="error",document.body.prepend(warning),dominterface4&&(dominterface4.style.opacity="1"),setTimeout(()=>warning.style.opacity="1",20)}if(sessionStorage.errorMessage==="removed"&&dominterface4)return dominterface4.style.opacity="1",!1;try{let data=await storage_default.sync.get();document.querySelector("#error")?.remove(),displayMessage(JSON.stringify(data,null,4))}catch{displayMessage("")}}var defaultAnalogStyle={face:"none",hands:"modern",shape:"round",border:"#ffff",background:"#fff2"},defaultTimezones=["Europe/Paris","America/Sao_Paulo","America/Los_Angeles","Asia/Tokyo","Asia/Kolkata"],defaultRegions=["Paris","New York","Tokyo","Lisbon","Los Angeles"],oneInFive=Math.random()>.8?1:0,numberWidths=[1],clockInterval;function clock(init2,event){if(event){clockUpdate(event);return}let clock2=init2?.clock??{...SYNC_DEFAULT.clock},world=init2?.worldclocks??{...SYNC_DEFAULT.worldclocks};try{startClock(clock2,world,init2?.greeting||"",init2?.dateformat||"eu"),analogStyle(init2?.analogstyle),clockSize(clock2.size),displayInterface("clock"),onSettingsLoad(toggleWorldClocksOptions)}catch(e){errorMessage(e)}}async function clockUpdate(update2){let data=await storage_default.sync.get(),analogstyle=data.analogstyle??structuredClone(defaultAnalogStyle);if(update2.analog!==void 0&&(document.getElementById("analog_options")?.classList.toggle("shown",update2.analog),document.getElementById("digital_options")?.classList.toggle("shown",!update2.analog)),isDateFormat(update2.dateformat)&&(data.dateformat=update2.dateformat,storage_default.sync.set({dateformat:update2.dateformat})),update2.greeting!==void 0&&(data.greeting=stringMaxSize(update2.greeting,32),greetings(zonedDate(data.clock.timezone),data.greeting),storage_default.sync.set({greeting:data.greeting})),update2.timezone!==void 0&&greetings(zonedDate(update2.timezone),data.greeting),isHands(update2.hands)&&(analogstyle.hands=update2.hands),isShape(update2.shape)&&(analogstyle.shape=update2.shape),isFace(update2.face)&&(analogstyle.face=update2.face),update2.background||update2.border){let option=update2.background?"background":"border";analogstyle[option]=hexColorFromSplitRange(`#analog-${option}-range`),analogStyle(analogstyle),update2?.[option]==="opacity"&&eventDebounce({analogstyle}),update2?.[option]==="shade"&&storage_default.sync.set({analogstyle});return}if(update2.world!==void 0){let index=update2.world.index,baseclock={region:defaultRegions[index],timezone:defaultTimezones[index]},worldclock=data.worldclocks?.[index]??baseclock,{region,timezone}=update2.world;region!==void 0&&(worldclock.region=region),timezone!==void 0&&(worldclock.timezone=timezone),data.worldclocks[index]=worldclock,toggleWorldClocksOptions()}data.clock={ampm:update2.ampm??data.clock.ampm,size:update2.size??data.clock.size,analog:update2.analog??data.clock.analog,seconds:update2.seconds??data.clock.seconds,timezone:update2.timezone??data.clock.timezone,ampmlabel:update2.ampmlabel??data.clock.ampmlabel,worldclocks:update2.worldclocks??data.clock.worldclocks},storage_default.sync.set({clock:data.clock,worldclocks:data.worldclocks,analogstyle,dateformat:data.dateformat}),startClock(data.clock,data.worldclocks,data.greeting,data.dateformat),analogStyle(data.analogstyle),clockSize(data.clock.size)}function analogStyle(style){style=style??structuredClone(defaultAnalogStyle);let{face,shape,hands}=style,time=document.getElementById("time"),spans=document.querySelectorAll(".analog .analog-face span"),backgroundAlpha=parseInt(style.background.slice(4),16),isWhiteOpaque=style.background?.includes("fff")&&backgroundAlpha>7,isTransparent=backgroundAlpha===0,faceNumbers=["12","3","6","9"],lang=getLang();lang==="am"?faceNumbers=["\u0533","\u0536","\u0539","\u053A\u0532"]:lang==="ar"?faceNumbers=["\u0663","\u0666","\u0669","\u0661\u0662"]:lang==="fa"?faceNumbers=["\u06F3","\u06F6","\u06F9","\u06F1\u06F2"]:lang.match(/zh-CN|zh-HK|ja/)&&(faceNumbers=["\u4E09","\u516D","\u4E5D","\u5341\u4E8C"]),spans.forEach((span,i)=>{face==="roman"?span.textContent=["XII","III","VI","IX"][i%4]:face==="marks"?span.textContent=["\u2502","\u2015","\u2502","\u2015"][i%4]:face==="number"?span.textContent=faceNumbers[i%4]:span.textContent=""}),time.dataset.face=face==="swiss"||face==="braun"?face:"",time.dataset.shape=shape||"",time.dataset.hands=hands||"",time.classList.toggle("transparent",isTransparent),time.classList.toggle("white-opaque",isWhiteOpaque),time.style.setProperty("--analog-border",style.border),time.style.setProperty("--analog-background",style.background)}function clockSize(size=1){document.documentElement.style.setProperty("--clock-size",size.toString()+"em")}function startClock(clock2,world,greeting,dateformat){document.getElementById("time")?.classList.toggle("is-analog",clock2.analog),document.getElementById("time")?.classList.toggle("seconds",clock2.seconds),document.querySelectorAll(".clock-wrapper").forEach((node,index)=>{index>0&&node.remove()});let clocks=[];clock2.seconds&&!clock2.analog&&setSecondsWidthInCh(),clock2.worldclocks&&clocks.push(...world.filter(({region})=>region)),clocks.length===0&&clocks.push({region:"",timezone:clock2.timezone}),clearInterval(clockInterval),start(!0),clockInterval=setInterval(start,1e3);function start(firstStart){for(let index=0;index<clocks.length;index++){let{region,timezone}=clocks[index],domclock=getClock(index),domregion=domclock.querySelector(".clock-region"),date=zonedDate(timezone),isNextHour=date.getMinutes()===0;clock2.analog?analog(domclock,date,clock2):digital(domclock,date,clock2),(isNextHour||firstStart)&&clockDate(domclock,date,dateformat,timezone),domregion&&(domregion.textContent=region)}greetings(zonedDate(clock2.timezone),greeting)}}function getClock(index){let container2=document.getElementById("time-container"),wrapper=document.querySelector(`.clock-wrapper[data-index="${index}"]`);if(wrapper)return wrapper;let clone=document.getElementById("clock-wrapper")?.cloneNode(!0);return clone.removeAttribute("id"),clone.dataset.index=index.toString(),container2?.appendChild(clone),clone}function digital(wrapper,date,clock2){let domclock=wrapper.querySelector(".digital"),hh=wrapper.querySelector(".digital-hh"),mm=wrapper.querySelector(".digital-mm"),ss=wrapper.querySelector(".digital-ss"),m=fixunits(date.getMinutes()),s=fixunits(date.getSeconds()),h=clock2.ampm?date.getHours()%12:date.getHours();if(domclock){if(clock2.ampmlabel?domclock.dataset.ampmLabel="":delete domclock.dataset.ampmLabel,clock2.ampm?domclock.dataset.ampm=date.getHours()<13?"am":"pm":delete domclock.dataset.ampm,clock2.ampm&&h===0&&(h=12),clock2.seconds){let second=date.getSeconds()<10?0:Math.floor(date.getSeconds()/10),width=getSecondsWidthInCh(second).toFixed(1);domclock.style.setProperty("--seconds-width",`${width}ch`)}domclock.classList.toggle("zero",!clock2.ampm&&h<10),hh.textContent=h.toString(),mm.textContent=m.toString(),ss.textContent=s.toString()}}function analog(wrapper,date,clock2){let m=((date.getMinutes()+date.getSeconds()/60)*6).toFixed(1),h=((date.getHours()%12+date.getMinutes()/60)*30).toFixed(1),s=(date.getSeconds()*6).toFixed(1);wrapper.querySelector(".analog-hours")?.style.setProperty("--deg",`${h}deg`),wrapper.querySelector(".analog-minutes")?.style.setProperty("--deg",`${m}deg`),clock2.seconds&&wrapper.querySelector(".analog-seconds")?.style.setProperty("--deg",`${s}deg`)}function clockDate(wrapper,date,dateformat,timezone){let datedom=wrapper.querySelector(".clock-date"),aa=wrapper.querySelector(".clock-date-aa"),bb=wrapper.querySelector(".clock-date-bb"),cc=wrapper.querySelector(".clock-date-cc"),secondary=wrapper.querySelector(".clock-date-secondary"),lang=getLang().replaceAll("_","-"),day=new Intl.DateTimeFormat(lang,{day:"numeric"}).format(date),month=new Intl.DateTimeFormat(lang,{month:"long"}).format(date),weekday=new Intl.DateTimeFormat(lang,{weekday:"long"}).format(date);if(datedom.classList.remove("eu","us","cn"),datedom.classList.add(dateformat),dateformat==="auto"){let intl=new Intl.DateTimeFormat(lang,{weekday:"long",month:"long",day:"numeric"});aa.textContent=intl.format(date),bb.textContent="",cc.textContent=""}dateformat==="eu"&&(aa.textContent=weekday,bb.textContent=day,cc.textContent=month),dateformat==="us"&&(aa.textContent=weekday,bb.textContent=month,cc.textContent=day),dateformat==="cn"&&(aa.textContent=month,bb.textContent=day,cc.textContent=weekday),lang==="vi"&&(timezone==="auto"||timezone==="Asia/Ho_Chi_Minh")?secondary.textContent=getVnCalendar(date):secondary.textContent=""}function greetings(date,name){let domgreetings=document.getElementById("greetings"),domgreeting=document.getElementById("greeting"),domname=document.getElementById("greeting-name"),rare=oneInFive,hour=date.getHours(),period;hour<3?period="evening":hour<5?period="night":hour<12?period="morning":hour<18?period="afternoon":period="evening";let greet={morning:"Good morning",afternoon:"Good afternoon",evening:"Good evening",night:["Good night","Sweet dreams"][rare]}[period];domgreetings.style.textTransform=name||rare&&period==="night"?"none":"capitalize",domgreeting.textContent=tradThis(greet)+(name?", ":""),domname.textContent=name??""}function toggleWorldClocksOptions(){let parents=document.querySelectorAll(".worldclocks-item"),inputs=document.querySelectorAll('.worldclocks-item [name="worldclock-city"]');parents.forEach((parent,i)=>{let currHasText=!!inputs[i]?.value,nextHasText=!!inputs[i-1]?.value;parent?.classList.toggle("shown",i===0||currHasText||nextHasText)})}function setSecondsWidthInCh(){let span=document.querySelector(".digital-number-width");if(!span)return;let zero=span.offsetWidth;numberWidths=[1];for(let i=1;i<6;i++)span.textContent=i.toString(),numberWidths.push(Math.round(span.offsetWidth/zero*10)/10)}function getSecondsWidthInCh(second){return Math.min(...numberWidths)+numberWidths[second]}function zonedDate(timezone="auto"){let isUTC=(timezone.includes("+")||timezone.includes("-"))&&timezone.length<6,date=new Date;if(timezone==="auto")return date;if(isUTC){let offset=date.getTimezoneOffset()/60,utcHour=date.getHours()+offset,utcMinutes=date.getMinutes()+date.getTimezoneOffset(),minutes;return timezone.split(".")[1]?(minutes=utcMinutes+parseInt(timezone.split(".")[1]),minutes>-30&&utcHour++):minutes=date.getMinutes(),date.setHours(utcHour+parseInt(timezone),minutes),date}let intl=new Intl.DateTimeFormat("en",{timeZone:timezone,dateStyle:"medium",timeStyle:"medium"});return new Date(intl.format(date))}function fixunits(val){return(val<10?"0":"")+val.toString()}function isFace(str){return["none","number","roman","marks","swiss","braun"].includes(str??"")}function isHands(str){return["modern","swiss","classic","braun","apple"].includes(str??"")}function isShape(str){return["round","square","rectangle"].includes(str??"")}function isDateFormat(str=""){return["auto","eu","us","cn"].includes(str)}function networkForm(targetId2){let form,button,message,loadTimeout=0;onSettingsLoad(()=>{form=document.getElementById(targetId2),button=form?.querySelector("button:last-of-type"),message=form?.querySelector("small"),form.querySelectorAll("input").forEach(input=>{input?.addEventListener("input",()=>{let isSame=input.getAttribute("placeholder")===input.value,isEmpty=input.value==="",isValid=form.checkValidity();form.classList.toggle("valid",isValid),form.classList.toggle("remove",isValid&&(isSame||isEmpty))})}),form?.addEventListener("input",()=>{form.classList.contains("warn")&&(form.classList.remove("warn"),button.removeAttribute("disabled"))})});function reset(){form.classList.remove("load","warn","valid","remove"),button.removeAttribute("disabled"),clearTimeout(loadTimeout)}function load(){loadTimeout=setTimeout(()=>{form.classList.remove("warn"),form.classList.add("valid","load"),button.setAttribute("disabled","disabled")},50)}function warn(err){form.classList.add("warn"),form.classList.remove("load"),button.setAttribute("disabled",""),message.textContent=err,clearTimeout(loadTimeout)}function accept(inputId,value){if(inputId&&form.checkValidity()){form.classList.remove("valid");let input=document.getElementById(inputId);input&&value&&input.setAttribute("placeholder",value)}clearTimeout(loadTimeout),setTimeout(()=>reset(),200)}return{load,warn,reset,accept}}var quotesTypeForm=networkForm("f_qttype"),quotesUrlForm=networkForm("f_qturl");async function quotes(init2,update2){if(update2){updateQuotes(update2);return}if(!init2)return;let{lang,quotes:quotes2}=init2.sync,needsNewQuote=freqControl.get(quotes2.frequency,quotes2.last??0),selection=init2.local?.userQuoteSelection??0,list=init2.local?.quotesCache??[],quote=list[0];quotes2.type==="user"?(list=csvUserInputToQuotes(quotes2.userlist),quote=list[selection]):(!list||list?.length===0)&&(list=await tryFetchQuotes(lang,quotes2.type,quotes2.url),quote=list[0],storage_default.local.set({quotesCache:list})),needsNewQuote&&(quotes2.last=freqControl.set(),quote=controlCacheList(list,lang,quotes2.type,quotes2.url),storage_default.sync.set({quotes:quotes2})),insertToDom(quote),toggleAuthorAlwaysOn(quotes2.author),document.getElementById("quotes_container")?.classList.toggle("hidden",!quotes2.on),displayInterface("quotes")}async function updateQuotes({author,frequency,type,userlist,url,refresh}){let data=await storage_default.sync.get(["lang","quotes"]),local=await storage_default.local.get("quotesCache");author!==void 0&&(data.quotes.author=author,toggleAuthorAlwaysOn(author)),userlist&&(data.quotes.userlist=handleUserListChange(userlist));let updateData=!1;canStoreUrl(url)&&(data.quotes.url=url,updateData=!0),refresh&&(data.quotes.last=freqControl.set(),refreshQuotes(data,local?.quotesCache)),isEvery(frequency)&&(data.quotes.frequency=frequency),isQuotesType(type)&&(data.quotes.type=type,updateData=!0),updateData&&updateQuotesData(data),storage_default.sync.set({quotes:data.quotes})}async function updateQuotesData(data){let isUser=data.quotes.type==="user",list=[],selection=0;if(isUser&&data.quotes.userlist&&(selection=(await storage_default.local.get("userQuoteSelection"))?.userQuoteSelection??0,list=csvUserInputToQuotes(data.quotes.userlist)),!isUser){let form=data.quotes.type==="url"?quotesUrlForm:quotesTypeForm;try{form.load(),list=await fetchQuotes(data.lang,data.quotes.type,data.quotes.url),form.accept()}catch(error){form.warn(tradThis("Fetch failed, please check console for more information")),console.warn(error)}storage_default.local.set({quotesCache:list})}list.length>0&&insertToDom(list[selection]),document.getElementById("quotes_userlist")?.classList.toggle("shown",isUser),document.getElementById("quotes_url")?.classList.toggle("shown",data.quotes.type==="url")}function handleUserListChange(input){let array=[];return input.length===0?"":(input.startsWith("[[")&&(input=oldJSONToCSV(parse(input)??[])),array=csvUserInputToQuotes(input),array.length>0&&(insertToDom({author:array[0].author,content:array[0].content}),document.getElementById("i_qtlist")?.blur(),storage_default.local.set({userQuoteSelection:0})),input)}function refreshQuotes(data,list=[]){data.quotes.type==="user"&&data.quotes.userlist&&(list=csvUserInputToQuotes(data.quotes.userlist)),insertToDom(controlCacheList(list,data.lang,data.quotes.type,data.quotes.url))}async function fetchQuotes(lang,type,url){if(!navigator.onLine||type==="user")return[];let response;if(type==="url"){if(!url)return[];response=await fetch(url),validateResponse(response);let responseType=determineUrlApiResponseType(response);return responseType==="json"?await response.json():responseType==="csv"?csvToQuotes(await response.text()):[]}let query=`/quotes/${type}`+(type==="classic"?`/${lang}`:"");return response=await apiFetch(query),validateResponse(response),await response.json()}function validateResponse(response){if(!response)throw new Error("No response");if(!response.ok)throw new Error(`Response not ok: ${response.status} ${response.statusText}`)}async function tryFetchQuotes(lang,type,url){try{return await fetchQuotes(lang,type,url)}catch(error){console.warn(error)}return[]}function controlCacheList(list,lang,type,url){if(type==="user"){let randIndex=Math.round(Math.random()*(list.length-1));return storage_default.local.set({userQuoteSelection:randIndex}),list[randIndex]}return list.length>1&&(list.shift(),storage_default.local.set({quotesCache:list})),list.length<2&&tryFetchQuotes(lang,type,url).then(list2=>{storage_default.local.set({quotesCache:list2})}),list[0]}function toggleAuthorAlwaysOn(state){document.getElementById("author")?.classList.toggle("always-on",state)}function insertToDom(quote){let quoteDOM=document.getElementById("quote"),authorDOM=document.getElementById("author");!quote||!quoteDOM||!authorDOM||(quoteDOM.textContent=quote.content,authorDOM.textContent=quote.author)}function csvUserInputToQuotes(csv){return csv?(Array.isArray(csv)&&(csv=oldJSONToCSV(csv)),csvToQuotes(csv)):[]}function oldJSONToCSV(input){return input.map(val=>val.join(",")).join(`
`)}function csvToQuotes(csv){let rows=csv.split(`
`),quotes2=[];for(let row of rows){let[author,...rest2]=row.split(","),content=rest2.join(",").trimStart();quotes2.push({author,content})}return quotes2}function isQuotesType(type=""){return["classic","kaamelott","inspirobot","stoic","hitokoto","user","url"].includes(type)}var urlRegEx=/^https?:\/\//i;function canStoreUrl(url){return url===void 0?!1:url===""||urlRegEx.test(url)}function determineUrlApiResponseType(response){let contentType=response.headers.get("content-type")?.split(";",2)[0];if(contentType==="application/json")return"json";if(contentType==="text/csv")return"csv";let parts=new URL(response.url).pathname.split("."),extension=parts[parts.length-1];return equalsCaseInsensitive(extension,"json")?"json":"csv"}var weatherFirstStart=!0;function displayWeather(data,lastWeather){let useSinograms=getLang().includes("zh")||getLang().includes("ja"),currentDesc=document.getElementById("current-desc"),currentTemp=document.getElementById("current-temp"),tempContainer=document.getElementById("tempContainer"),weatherdom=document.getElementById("weather"),dot=useSinograms?"\u3002":". ",date=new Date,handleDescription=()=>{let feels=Math.floor(lastWeather.feels_like),actual=Math.floor(lastWeather.temp),maintemp=data.temperature==="feelslike"?feels:actual,tempReport="";data.temperature==="actual"&&(tempReport=tradThis("It is currently <temp1>\xB0")),data.temperature==="feelslike"&&(tempReport=tradThis("It currently feels like <temp2>\xB0")),data.temperature==="both"&&(tempReport=tradThis("It is currently <temp1>\xB0 and feels like <temp2>\xB0"));let iconText=tempContainer?.querySelector("p"),weatherReport=lastWeather.description[0].toUpperCase()+lastWeather.description.slice(1);tempReport=tempReport.replace("<temp1>",actual.toString()),tempReport=tempReport.replace("<temp2>",feels.toString()),currentDesc&&currentTemp&&iconText&&(currentDesc.textContent=weatherReport+dot,currentTemp.textContent=tempReport,iconText.textContent=`${maintemp}\xB0`)},handleWidget=()=>{let condition=lastWeather.icon_id;if(!tempContainer)return;let now=minutator(new Date),{sunrise:sunrise2,sunset:sunset2,dusk:dusk2}=suntime(),daytime=now<sunrise2||now>sunset2+dusk2?"night":"day",icon=document.getElementById("weather-icon");icon.dataset.daytime=daytime,icon.dataset.condition=condition},handleForecastData=()=>{let forecastdom=document.getElementById("forecast"),day=date.getHours()>getSunsetHour()?"tomorrow":"today",string2="";day==="today"&&(string2=tradThis("with a high of <temp1>\xB0 today")),day==="tomorrow"&&(string2=tradThis("with a high of <temp1>\xB0 tomorrow")),string2=string2.replace("<temp1>",lastWeather.forecasted_high.toString()),string2=string2+dot,forecastdom&&(forecastdom.textContent=string2)},handleMoreInfo=()=>{let noDetails=!data.moreinfo||data.moreinfo==="none",emptyCustom=data.moreinfo==="custom"&&!data.provider;if(noDetails||emptyCustom){weatherdom?.removeAttribute("href");return}let URLs={accu:lastWeather.link??"https://www.accuweather.com/",msnw:tradThis("https://www.msn.com/en-xl/weather/forecast/"),yhw:"https://www.yahoo.com/news/weather/",windy:"https://www.windy.com/",custom:data.provider??""};(data.moreinfo||"")in URLs&&weatherdom?.setAttribute("href",URLs[data.moreinfo])};handleForecastDisplay(data.forecast),handleWidget(),handleMoreInfo(),handleDescription(),handleForecastData(),weatherFirstStart&&(weatherFirstStart=!1,weatherdom?.classList.remove("wait"),setTimeout(()=>weatherdom?.classList.remove("init"),900))}function handleForecastDisplay(forecast){let date=new Date,morningOrLateDay=date.getHours()<12||date.getHours()>getSunsetHour(),isTimeForForecast=forecast==="auto"?morningOrLateDay:forecast==="always";if(isTimeForForecast&&!document.getElementById("forecast")){let p=document.createElement("p");p.id="forecast",document.getElementById("description")?.appendChild(p)}isTimeForForecast||document.querySelector("#forecast")?.remove()}var locationForm=networkForm("f_location"),unitForm=networkForm("f_units"),geolForm=networkForm("f_geol"),suggestionsDebounce=debounce(fillLocationSuggestions,600);async function weatherUpdate(update2){let{weather:weather2,hide}=await storage_default.sync.get(["weather","hide"]),lastWeather=(await storage_default.local.get("lastWeather")).lastWeather;if(!(!weather2||!hide)){if(isUnits(update2.units)&&(unitForm.load(),weather2.unit=update2.units,lastWeather=await requestNewWeather(weather2,lastWeather)??lastWeather,unitForm.accept()),isForecast(update2.forecast)&&(weather2.forecast=update2.forecast),isTemperature(update2.temp)&&(weather2.temperature=update2.temp),isMoreinfo(update2.moreinfo)&&(document.getElementById("weather_provider")?.classList.toggle("shown",update2.moreinfo==="custom"),weather2.moreinfo=update2.moreinfo),update2.provider&&(weather2.provider=update2.provider),update2.unhide){let{weatherdesc,weathericon}=hide||{};weatherdesc&&weathericon&&weatherCacheControl(weather2)}if(update2.suggestions){updateSuggestions(update2.suggestions);return}if(update2.city){updateManualLocation(weather2,lastWeather);return}if(update2.geol){updateGeolocation(update2.geol,weather2,lastWeather);return}storage_default.sync.set({weather:weather2}),onSettingsLoad(()=>handleGeolOption(weather2)),lastWeather&&(storage_default.local.set({lastWeather}),displayWeather(weather2,lastWeather))}}async function updateManualLocation(weather2,lastWeather){let city=document.getElementById("i_city").value;if(removeLocationSuggestions(),!navigator.onLine){locationForm.warn(tradThis("No internet connection"));return}if(city===weather2.city)return;city=stringMaxSize(city,64),locationForm.load();let currentWeather={...weather2,city},newWeather;try{newWeather=await requestNewWeather(currentWeather,lastWeather)}catch(error){locationForm.warn(tradThis(error));return}if(!newWeather){locationForm.warn(tradThis("Cannot reach weather service"));return}newWeather&&(lastWeather=newWeather,weather2.city=city??"Paris",locationForm.accept("i_city",weather2.city),storage_default.sync.set({weather:weather2}),storage_default.local.set({lastWeather}),displayWeather(weather2,lastWeather))}async function updateGeolocation(geol,weather2,lastWeather){if(geolForm.load(),geol==="precise"&&!await getGeolocation("precise")){geolForm.warn("Cannot get precise location");return}isGeolocation(geol)&&(weather2.geolocation=geol),lastWeather=await requestNewWeather(weather2,lastWeather)??lastWeather,geolForm.accept(),handleGeolOption(weather2),storage_default.sync.set({weather:weather2}),lastWeather&&(storage_default.local.set({lastWeather}),displayWeather(weather2,lastWeather))}function handleGeolOption(data){let i_city=document.querySelector("#i_city"),i_geol=document.querySelector("#i_geol");i_city&&i_geol&&(i_geol.value=data?.geolocation??!1,i_city.setAttribute("placeholder",data.city??"Paris"),document.getElementById("location_options")?.classList.toggle("shown",data.geolocation==="off"))}function updateSuggestions(updateEvent){let f_location=document.querySelector("#f_location"),i_city=document.querySelector("#i_city"),event=updateEvent;!f_location||!i_city||event.data!==void 0&&(f_location?.classList.toggle("valid",i_city.value.length>2),removeLocationSuggestions(),suggestionsDebounce())}function removeLocationSuggestions(){document.querySelector("#dl_cityfound")?.childNodes.forEach(node=>node.remove())}async function fillLocationSuggestions(){let dl_cityfound=document.querySelector("#dl_cityfound"),city=document.getElementById("i_city").value;if(city===""){removeLocationSuggestions();return}let url=new URL("https://weather.bonjourr.fr/");url.searchParams.set("provider","accuweather"),url.searchParams.set("data","simple"),url.searchParams.set("geo","true"),url.searchParams.set("query",encodeURIComponent(city));try{let resp=await fetch(url);if(removeLocationSuggestions(),resp.status!==200)return;for(let{detail}of await resp.json()){let option=document.createElement("option");option.value=detail,option.textContent=detail,dl_cityfound?.appendChild(option)}}catch{}}function isUnits(str=""){return["metric","imperial"].includes(str)}function isForecast(str=""){return["auto","always","never"].includes(str)}function isMoreinfo(str=""){return["none","msnw","yhw","windy","accu","custom"].includes(str)}function isTemperature(str=""){return["actual","feelslike","both"].includes(str)}function isGeolocation(str=""){return["precise","approximate","off"].includes(str)}async function weatherCacheControl(data,lastWeather){if(handleForecastDisplay(data.forecast),!lastWeather){firstStartWeather(data);return}let now=new Date().getTime(),last=lastWeather?.timestamp??0,isAnHourLater=now>last+36e5;if(navigator.onLine&&isAnHourLater){let newWeather=await requestNewWeather(data,lastWeather);newWeather&&(lastWeather=newWeather,storage_default.local.set({lastWeather}))}displayWeather(data,lastWeather)}async function requestNewWeather(data,lastWeather){if(!navigator.onLine)return lastWeather;let coords2=await getGeolocation(data.geolocation),url=new URL("https://weather.bonjourr.fr/");if(url.searchParams.set("provider","auto"),url.searchParams.set("data","simple"),url.searchParams.set("lang",getLang()),url.searchParams.set("unit",data.unit==="metric"?"C":"F"),coords2&&coords2.lat&&coords2.lon&&(url.searchParams.set("lat",coords2.lat.toString()),url.searchParams.set("lon",coords2.lon.toString())),data.geolocation==="off"&&!coords2){let city=data.city??"Paris",q=encodeURIComponent(city);url.searchParams.set("query",q)}let response=await fetch(url);if(response.status!==200)throw new Error("Cannot get weather");let json=await response?.json(),[sunset2,sunrise2]=[0,0],{temp,feels}=json.now,{description,icon}=json.now,forecasted_high=lastWeather?.forecasted_high??-273.15,forecasted_timestamp=lastWeather?.forecasted_timestamp??0;if(json.daily){let[today,tomorrow]=json.daily;new Date().getHours()>getSunsetHour()?(forecasted_high=tomorrow.high,forecasted_timestamp=new Date(tomorrow.time).getTime()):(forecasted_high=today.high,forecasted_timestamp=new Date(today.time).getTime())}if(json.sun){let[rh,rm]=json.sun.rise,[sh,sm]=json.sun.set,date=new Date;date.setHours(rh,rm,0,0),sunrise2=date.getTime(),date.setHours(sh,sm,0,0),sunset2=date.getTime(),suntime(sunrise2,sunset2)}return{timestamp:new Date().getTime(),forecasted_timestamp,forecasted_high,description,feels_like:feels,icon_id:icon,sunrise:sunrise2,sunset:sunset2,temp,link:json.meta.url??"",approximation:{ccode:json?.geo?.country,city:json?.geo?.city,lat:json?.geo?.lat,lon:json?.geo?.lon}}}async function firstStartWeather(data){let currentWeather=await requestNewWeather(data);currentWeather&&(data.city=currentWeather.approximation?.city??tradThis("City"),storage_default.sync.set({weather:data}),storage_default.local.set({lastWeather:currentWeather}),displayWeather(data,currentWeather),setTimeout(()=>handleGeolOption(data),400))}async function getGeolocation(type){let location2={lat:0,lon:0};return type==="precise"&&await new Promise(resolve2=>navigator.geolocation.getCurrentPosition(geo=>{location2.lat=geo.coords.latitude,location2.lon=geo.coords.longitude,resolve2(!0)},()=>{resolve2(!1)})),location2.lat!==0&&location2.lon!==0?location2:void 0}var pollingInterval=0;function weather(init2,update2){if(update2){weatherUpdate(update2);return}init2&&!(init2.sync?.weatherdesc&&init2.sync?.weathericon)&&weatherCacheControl(init2.sync.weather,init2.lastWeather),init2&&(onSettingsLoad(()=>{handleGeolOption(init2.sync.weather)}),queueMicrotask(()=>{clearInterval(pollingInterval),pollingInterval=setInterval(async()=>{let sync=await storage_default.sync.get(["weather","hide"]),local=await storage_default.local.get("lastWeather");weatherCacheControl(sync.weather,local.lastWeather)},12e5)}))}function getSunsetHour(){let d=new Date;return d.setHours(Math.round(suntime().sunset/60)),d.getHours()}function customCss(init2,event){let stylelink=document.getElementById("styles");if(event){if(event?.styling!==void 0){let val=stringMaxSize(event.styling,8080);stylelink.textContent=val,eventDebounce({css:val})}return}init2&&(stylelink.textContent=init2),onSettingsLoad(async()=>{let{create:create2}=await Promise.resolve().then(()=>(init_csseditor(),csseditor_exports)),editor=create2({language:"css",lineNumbers:!1,wordWrap:!0,insertSpaces:!1,value:init2||""}),tabCommand=editor.keyCommandMap.Tab;editor.textarea.id="css-editor-textarea",editor.textarea.maxLength=8080,editor.textarea.setAttribute("aria-labelledby","lbl-css"),editor.textarea.placeholder=tradThis("Type in your custom CSS"),editor.addListener("update",value=>{value=stringMaxSize(value,8080),eventDebounce({css:value}),stylelink.textContent=value}),editor.keyCommandMap.Tab=(e,selection,value)=>document.body.matches(".tabbing")?!1:tabCommand?.(e,selection,value)})}var socket,domsuggestions=document.getElementById("sb-suggestions"),domcontainer=document.getElementById("sb_container"),domsearchbar=document.getElementById("searchbar"),dombuttons=document.getElementById("sb-buttons"),emptyButton=document.getElementById("sb_empty"),display=(shown=!1)=>domcontainer?.classList.toggle("hidden",!shown),setEngine=(value="google")=>domcontainer?.setAttribute("data-engine",value),setRequest=(value="")=>domcontainer?.setAttribute("data-request",stringMaxSize(value,512)),setNewtab=(value=!1)=>domcontainer?.setAttribute("data-newtab",value.toString()),setSuggestions=(value=!0)=>domcontainer?.setAttribute("data-suggestions",value.toString()),setPlaceholder=(value="")=>domsearchbar?.setAttribute("placeholder",value),setWidth=(value=30)=>document.documentElement.style.setProperty("--searchbar-width",value.toString()+"em"),setBackground=(value="#fff2")=>{document.documentElement.style.setProperty("--searchbar-background",value),document.getElementById("sb_container")?.classList.toggle("opaque",value.includes("#fff")&&opacityFromHex(value)>7)};function searchbar(init2,update2){if(update2){updateSearchbar(update2);return}try{display(init2?.on),setWidth(init2?.width),setEngine(init2?.engine),setRequest(init2?.request),setNewtab(init2?.newtab),setPlaceholder(init2?.placeholder),setSuggestions(init2?.suggestions),setBackground(init2?.background),dombuttons?.addEventListener("click",focusSearchbar),emptyButton?.addEventListener("click",removeInputText),domcontainer?.addEventListener("submit",submitSearch),domsearchbar?.addEventListener("input",handleUserInput),document.addEventListener("keydown",searchbarShortcut)}catch(e){errorMessage(e)}}async function updateSearchbar({engine,newtab,background,placeholder,request,suggestions:suggestions2,width}){let{searchbar:searchbar2}=await storage_default.sync.get("searchbar");if(searchbar2){if(isValidEngine(engine)&&(document.getElementById("searchbar_request")?.classList.toggle("shown",engine==="custom"),searchbar2.engine=engine,setEngine(engine)),suggestions2!==void 0&&(searchbar2.suggestions=suggestions2,setSuggestions(suggestions2)),newtab!==void 0&&(searchbar2.newtab=newtab,setNewtab(newtab)),width!==void 0&&(searchbar2.width=parseInt(width),setWidth(searchbar2.width)),placeholder!==void 0&&(searchbar2.placeholder=placeholder,setPlaceholder(placeholder)),background&&(searchbar2.background=hexColorFromSplitRange("sb-background-range"),setBackground(searchbar2.background)),request){if(!request.value.includes("%s"))return;searchbar2.request=stringMaxSize(request.value,512),setRequest(searchbar2.request),request.blur()}eventDebounce({searchbar:searchbar2})}}function isValidURL(string2){try{let url=new URL(string2.startsWith("http")?string2:"https://"+string2);return/^(?:\w(?:[\w-]*\.)+[\w-]+)(?::\d+)?(?:\/[^/?#]+)?\/?$/.test(url.host)}catch{return!1}}function createSearchURL(val,engine){let URLs={default:"",google:"https://www.google.com/search?udm=14&q=%s",ddg:"https://duckduckgo.com/?q=%s",startpage:"https://www.startpage.com/do/search?query=%s",qwant:"https://www.qwant.com/?q=%s",yahoo:"https://search.yahoo.com/search?q=%s",bing:"https://www.bing.com/search?q=%s",brave:"https://search.brave.com/search?q=%s",ecosia:"https://www.ecosia.org/search?q=%s",lilo:"https://search.lilo.org/?q=%s",baidu:"https://www.baidu.com/s?wd=%s",custom:domcontainer?.dataset.request||""},searchURL="";if(isValidEngine(engine)){let trad=tradThis(engine);searchURL=trad.includes("%s")?trad:URLs[engine]}return searchURL.replace("%s",encodeURIComponent(val??""))}function submitSearch(e){e.preventDefault();let canUseDefault=!IS_MOBILE&&(PLATFORM==="chrome"||PLATFORM==="firefox"),newtab=domcontainer?.dataset.newtab==="true",val=domsearchbar?.value,engine=domcontainer?.dataset.engine??"default";if(!val)return;if(socket&&socket.close(),canUseDefault&&engine==="default"){EXTENSION?.search.query({disposition:newtab?"NEW_TAB":"CURRENT_TAB",text:val});return}engine=engine.replace("default","google");let domainURL=val.startsWith("http")?val:"https://"+val,searchURL=createSearchURL(val,engine),url=isValidURL(val)?domainURL:searchURL,target=newtab?"_blank":"_self";window.open(url,target)}function initSuggestions(){function selectShownResult(next){return next?.classList.contains("shown")?next:null}function applyResultContentToInput(elem){!elem||!domsearchbar||(domsearchbar.value=elem?.querySelector(".suggest-result")?.textContent??"")}for(let ii=0;ii<10;ii++){let li=document.createElement("li"),image=document.createElement("img"),wrapper=document.createElement("div"),result=document.createElement("p"),description=document.createElement("p");li.setAttribute("tabindex","0"),image.setAttribute("draggable","false"),image.setAttribute("width","16"),image.setAttribute("height","16"),result.classList.add("suggest-result"),description.classList.add("suggest-desc"),wrapper.appendChild(result),wrapper.appendChild(description),li.appendChild(image),li.appendChild(wrapper),li.addEventListener("mouseenter",()=>{domcontainer?.querySelector('li[aria-selected="true"]')?.removeAttribute("aria-selected"),li?.setAttribute("aria-selected","true")}),li.addEventListener("mouseleave",()=>{li?.removeAttribute("aria-selected")}),li.addEventListener("click",e=>{applyResultContentToInput(li),submitSearch(e)}),domsuggestions?.appendChild(li)}function toggleSuggestions(e){let targetIsResult=e?.relatedTarget?.parentElement?.id==="sb-suggestions",hasResults=document.querySelectorAll("#sb-suggestions li.shown")?.length>0,isFocus=e.type==="focus";targetIsResult||domsuggestions?.classList.toggle("shown",isFocus&&hasResults)}function navigateSuggestions(e){let isArrowDown=e.code==="ArrowDown",isArrowUp=e.code==="ArrowUp",isEnter=e.code==="Enter",isEscape=e.code==="Escape",lastSelected=domsuggestions?.querySelector('li[aria-selected="true"]');lastSelected?.removeAttribute("aria-selected"),!isEscape&&(isArrowDown&&(lastSelected=selectShownResult(lastSelected?.nextElementSibling)??domsuggestions?.querySelector("li.shown"),applyResultContentToInput(lastSelected)),isArrowUp&&(lastSelected=selectShownResult(lastSelected?.previousElementSibling),applyResultContentToInput(lastSelected),e.preventDefault()),isEnter&&lastSelected&&(applyResultContentToInput(lastSelected),submitSearch(e)),lastSelected?.setAttribute("aria-selected","true"))}function hideResultsAndSuggestions(){Object.values(domsuggestions?.children??[]).forEach(child=>child.classList.remove("shown")),domsuggestions?.classList.remove("shown")}async function createSuggestionSocket(){socket=await apiWebSocket("suggestions"),socket?.addEventListener("message",function(event){let data=parse(event.data);Array.isArray(data)?suggestions(data):data?.error&&createSuggestionSocket()})}domcontainer?.addEventListener("keydown",navigateSuggestions),domsearchbar?.addEventListener("focus",toggleSuggestions),domsearchbar?.addEventListener("blur",toggleSuggestions),emptyButton?.addEventListener("click",hideResultsAndSuggestions),createSuggestionSocket()}function suggestions(results){let input=domsearchbar,liList=domsuggestions?.querySelectorAll("li")??[];domsuggestions?.classList.toggle("shown",results.length>0),domsuggestions?.querySelector('li[aria-selected="true"]')?.removeAttribute("aria-selected"),liList.forEach((li,i)=>{let result=results[i];if(!result)return;let searchIcon="src/assets/interface/magnifying-glass.svg",image=result.image??searchIcon,desc=result.desc??"",resultdom=li.querySelector(".suggest-result");if(resultdom.textContent=result.text,result.text.includes(input.value)){let queryIndex=result.text.indexOf(input.value),startdom=document.createElement("span"),querydom=document.createElement("b"),enddom=document.createElement("span");startdom.textContent=result.text.slice(0,queryIndex),querydom.textContent=result.text.slice(queryIndex,input.value.length),enddom.textContent=result.text.slice(input.value.length),resultdom.textContent="",resultdom?.appendChild(startdom),resultdom?.appendChild(querydom),resultdom?.appendChild(enddom)}let imgdom=li.querySelector("img");imgdom.classList.toggle("default-search-icon",image===searchIcon),imgdom.src=image,li.querySelector(".suggest-desc").textContent=desc,li.classList.toggle("shown",!!result);let rect=li.getBoundingClientRect();rect.y+rect.height+40>document.body.offsetHeight&&li.classList.remove("shown")}),domsuggestions?.querySelectorAll("li.shown")?.length===0&&domsuggestions?.classList.remove("shown")}function handleUserInput(e){let value=e.target.value??"",startsTypingProtocol="https://".startsWith(value)||value.match(/https?:\/?\/?/i);if(domsearchbar&&toggleInputButton(value.length>0),value===""){document.querySelectorAll("#sb-suggestions li.shown")?.forEach(li=>li.classList.remove("shown")),domsuggestions?.classList.remove("shown");return}if(startsTypingProtocol||isValidURL(value)){domsuggestions?.classList.remove("shown");return}if(domcontainer?.dataset.suggestions==="true"&&domsuggestions?.childElementCount===0&&initSuggestions(),domcontainer?.dataset.suggestions==="true"&&socket&&socket.readyState===socket.OPEN){let engine=(domcontainer?.dataset.engine??"ddg").replace("custom","ddg").replace("default","google"),query=encodeURIComponent(value??"");socket.send(JSON.stringify({q:query,with:engine,lang:getLang()}))}}function toggleInputButton(enabled){document.getElementById("sb-buttons")?.classList.toggle("shown",enabled),document.getElementById("sb_empty")?.toggleAttribute("disabled",!enabled),document.getElementById("sb_submit")?.toggleAttribute("disabled",!enabled)}function removeInputText(){domsearchbar&&(domsearchbar.focus(),domsearchbar.value="",toggleInputButton(!1))}function focusSearchbar(){dombuttons?.classList.contains("shown")===!1&&domsearchbar?.focus()}function searchbarShortcut(event){event.target.tagName==="BODY"&&event.key==="/"&&(domsearchbar?.focus(),domsearchbar?.select(),event.preventDefault())}function isValidEngine(str=""){return SEARCHBAR_ENGINES.includes(str)}var familyForm=networkForm("f_customfont"),systemfont=function(){let fonts={fallback:{placeholder:"Arial",weights:["500","600","800"]},windows:{placeholder:"Segoe UI",weights:["300","400","600","700","800"]},android:{placeholder:"Roboto",weights:["100","300","400","500","700","900"]},linux:{placeholder:"Fira Sans",weights:["100","200","300","400","500","600","700","800","900"]},apple:{placeholder:"SF Pro Display",weights:["100","200","300","400","500","600","700","800","900"]}};return SYSTEM_OS==="windows"?fonts.windows:SYSTEM_OS==="android"?fonts.android:SYSTEM_OS==="mac"||SYSTEM_OS==="ios"?fonts.apple:fonts.linux}();function customFont(init2,event){if(event){updateCustomFont(event);return}if(init2)try{init2=migrateToNewFormat(init2),displayFont(init2),displayInterface("fonts"),onSettingsLoad(()=>{initFontSettings(init2)})}catch(e){errorMessage(e)}}async function updateCustomFont({family,weight,size,lang,autocomplete}){if(autocomplete){setAutocompleteSettings();return}let data=await storage_default.sync.get("font");if(family!==void 0&&(data.font=await updateFontFamily(data,family)),weight&&(data.font.weight=weight||"400",displayFont(data.font)),size&&(data.font.size=size,setFontSize(size)),lang){handleLangSwitch(data.font);return}eventDebounce({font:data.font})}async function updateFontFamily(data,family){let i_weight=document.getElementById("i_weight"),familyType=family.length==0?"none":systemFontChecker(family)?"system":"fontsource",font={family:"",system:!0,size:data.font.size,weight:SYSTEM_OS==="windows"?"400":"300",weightlist:systemfont.weights};switch(familyType){case"none":{displayFont(font),familyForm.accept("i_customfont",systemfont.placeholder);break}case"system":{font.family=family,displayFont(font),familyForm.accept("i_customfont",family);break}case"fontsource":{familyForm.load();let newfont=await getNewFont(font,family);if(newfont&&navigator.onLine&&(font={...font,...newfont},displayFont(font),await waitForFontLoad(family),familyForm.accept("i_customfont",family),clock(void 0,{})),font.family==="")return familyForm.warn(tradThis("Cannot load this font")),data.font;break}}return clock(void 0,{}),setWeightSettings(font.weightlist),i_weight.value=font.weight,font}async function handleLangSwitch(font){if(!font.family||font?.system)return;let newfont=await getNewFont(font,font.family);if(newfont===void 0){updateCustomFont({family:""});return}font.family=newfont.family,font.weight=newfont.weight,font.weightlist=newfont.weightlist,displayFont(font),setAutocompleteSettings(!0)}async function getNewFont(font,newfamily){let fontlist=await(await apiFetch("/fonts"))?.json()??[],newfont;for(let item of fontlist){let hasCorrectSubset=item.subsets.includes(getRequiredSubset()),isFamily=item.family.toLowerCase()===newfamily.toLowerCase();hasCorrectSubset&&isFamily&&(newfont=item)}if(newfont)return font.weight="400",font.system=!1,font.family=newfamily,font.weightlist=newfont.weights.map(w=>w.toString()),font}function displayFont({family,size,weight,system}){let clockWeight=parseInt(weight)>100?systemfont.weights[systemfont.weights.indexOf(weight)-1]:weight,subset=getRequiredSubset(),id=family.toLocaleLowerCase().replaceAll(" ","-");if(!system){let fontface=`
			@font-face {font-family: "${family}";
				src: url(https://cdn.jsdelivr.net/fontsource/fonts/${id}@latest/latin-${weight}-normal.woff2) format('woff2');
			}
		`;subset!=="latin"&&(fontface+=fontface.replace("latin",subset)),document.getElementById("fontface").textContent+=fontface}document.documentElement.style.setProperty("--font-family",family?`"${family}"`:null),document.documentElement.style.setProperty("--font-weight",weight),document.documentElement.style.setProperty("--font-weight-clock",family?weight:clockWeight),setFontSize(size)}function setFontSize(size){document.documentElement.style.setProperty("--font-size",parseInt(size)/16+"em")}function initFontSettings(font){let settings=document.getElementById("settings"),weights=font&&font.weightlist.length>0?font.weightlist:systemfont.weights,family=font?.family||systemfont.placeholder;setWeightSettings(weights)}async function setAutocompleteSettings(isLangSwitch){let dl_fontfamily=document.querySelector("#dl_fontfamily");if(isLangSwitch&&dl_fontfamily?.childNodes.forEach(node=>node.remove()),dl_fontfamily?.childElementCount===0){let fontlist=await(await apiFetch("/fonts"))?.json()??[],fragment=new DocumentFragment,requiredSubset=getRequiredSubset();for(let item of fontlist)if(item.subsets.includes(requiredSubset)){let option=document.createElement("option");option.textContent=item.family,option.value=item.family,fragment.appendChild(option)}dl_fontfamily?.appendChild(fragment)}}function setWeightSettings(weights){let options=document.querySelectorAll("#i_weight option");for(let option of options)option.classList.toggle("hidden",weights.includes(option.value)===!1)}async function fontIsAvailableInSubset(lang,family){let font=(await(await apiFetch("/fonts"))?.json())?.find(item=>item.family===family),subset=getRequiredSubset(lang);return font&&font.subsets.includes(subset)}function systemFontChecker(family){let p=document.createElement("p");p.setAttribute("style","position: absolute; opacity: 0; font-family: invalid font;"),p.textContent="mqlskdjfhgpaozieurytwnxbcv?./,;:1234567890"+tradThis("New tab"),document.getElementById("interface")?.prepend(p);let first_w=p.getBoundingClientRect().width;p.style.fontFamily=`'${family}'`;let second_w=p.getBoundingClientRect().width,hasLoadedFont=first_w!==second_w;return p.remove(),hasLoadedFont}function waitForFontLoad(family){return new Promise(resolve2=>{let limitcounter=0,hasLoadedFont=systemFontChecker(family),interval=setInterval(()=>{if(hasLoadedFont||limitcounter===100)return clearInterval(interval),resolve2(!0);hasLoadedFont=systemFontChecker(family),limitcounter++},100)})}function getRequiredSubset(lang){let subset="latin";return lang=lang??getLang(),lang in subsets&&(subset=subsets[lang]),subset}function migrateToNewFormat(font){return font?.weightlist||(font.availWeights&&(font.weightlist=font.availWeights),font.system=systemFontChecker(font.family),delete font.availWeights,delete font.url,storage_default.local.remove("fontface"),storage_default.local.remove("fonts"),storage_default.sync.remove("font"),setTimeout(()=>storage_default.sync.set({font}))),font}function getDefaultIcon(url,refresh){return refresh?`${API_DOMAIN}/favicon/blob/${url}?r=${refresh}`:`${API_DOMAIN}/favicon/blob/${url}`}function getSelectedIds(){let selected=document.querySelectorAll("li.selected");return Object.values(selected).map(li=>li.id)}function getLiFromEvent(event){let li=event.composedPath().find(el=>el.tagName==="LI"&&el.className?.includes("link"));if(li)return li}function getTitleFromEvent(event){let title=event.composedPath().find(el=>el.className?.includes("link-title"));if(title)return title}function createTitle(link){let isInline=document.getElementById("linkblocks")?.className.includes("inline"),isText=document.getElementById("linkblocks")?.className.includes("text");if(!isInline&&!isText||link.title!=="")return stringMaxSize(link.title,64);try{isElem(link)?link.title=new URL(link.url)?.hostname.replace("www.",""):link.title=tradThis("folder")}catch{}return link.title}function getLink(data,id){let val=data[id];if(isLink(val))return val}function getLinksInGroup(data,group){let links=[];group=group??data.linkgroups.selected;for(let value of Object.values(data))isLink(value)&&(value?.parent??0)===group&&links.push(value);return links.sort((a,b)=>a.order-b.order),links}function getLinksInFolder(data,id){let links=[];for(let value of Object.values(data))isElem(value)&&value?.parent===id&&links.push(value);return links.sort((a,b)=>a.order-b.order),links}function isLink(link){return(link?._id??"").startsWith("links")}function isElem(link){return link?.folder!==!0}function transitioner(){let waitTimeout,steps={};return{first:cb=>steps.first=cb,finally:cb=>steps.finally=cb,then:cb=>steps.then=cb,cancel:()=>clearTimeout(waitTimeout),transition:async timeout=>{steps.first&&steps.first(...arguments),await new Promise(r=>{waitTimeout=setTimeout(()=>r(!0),Math.min(timeout,2e3))}),steps.then&&await steps.then(...arguments),steps.finally&&steps.finally(...arguments),delete steps.first,delete steps.then,delete steps.finally}}}var domlinkblocks=document.getElementById("linkblocks"),domeditlink=document.getElementById("editlink"),domtitle=document.getElementById("e-title"),domurl=document.getElementById("e-url"),domicon=document.getElementById("e-icon"),editStates;async function openEditDialog(event){let path=getComposedPath(event.target),classNames=path.map(element=>element.className??""),linkelem=path.find(el=>el?.className?.includes("link")&&el?.tagName==="LI"),linkgroup=path.find(el=>el?.className?.includes("link-group")),linktitle=path.find(el=>el?.className?.includes("link-title")),pointer=event,ctrlRightClick=pointer.button===2&&!!pointer.ctrlKey&&event.type==="contextmenu",pressingE=event.type==="keyup"&&event.code!=="KeyE";if(ctrlRightClick||pressingE)return;let container2={mini:path.some(element=>element?.id?.includes("link-mini")),group:classNames.some(cl=>cl.includes("link-group")&&!cl.includes("in-folder")),folder:classNames.some(cl=>cl.includes("link-group")&&cl.includes("in-folder"))},target={link:classNames.some(cl=>cl.includes("link-elem")),folder:classNames.some(cl=>cl.includes("link-folder")),title:classNames.some(cl=>cl.includes("link-title")),synced:classNames.some(cl=>cl.includes("synced")),addgroup:classNames.some(cl=>cl.includes("add-group"))},selectall=classNames.some(cl=>cl.includes("select-all")),dragging=classNames.some(cl=>cl.includes("dragging")||cl.includes("dropping"));editStates={group:(container2.mini?linktitle:linkgroup)?.dataset.group??"",selectall,container:container2,dragging,target,selected:getSelectedIds()};let inputs=toggleEditInputs(),folderTitle=container2.folder&&target.title,noSelection=selectall&&editStates.selected.length===0;if(inputs.length===0||folderTitle||noSelection||dragging){closeEditDialog();return}document.dispatchEvent(new Event("stop-select-all")),event.preventDefault();let data=await storage_default.sync.get();if(target.title){let{groups:groups2,pinned}=data.linkgroups,title=editStates.target.addgroup?"":editStates.group;domeditlink.dataset.group=title,domtitle.value=title;let onlyOneTitleUnpinned=groups2.length-pinned.length<2,onlyOneTitleLeft=groups2.length<2;onlyOneTitleUnpinned&&document.getElementById("edit-pin")?.setAttribute("disabled",""),onlyOneTitleLeft&&document.getElementById("edit-delete")?.setAttribute("disabled","")}if(target.folder||target.link){let id=path.filter(el=>el.tagName==="LI")[0]?.id,link=getLink(data,id);if(domtitle.value=link?.title??"",link&&!link.folder){let icon=link.icon??"";domurl.value=link.url??"",domicon.value=Number.isNaN(parseInt(icon))?icon:""}}selectall||(document.querySelectorAll(".link-title.selected, .link.selected")?.forEach(node=>node.classList.remove("selected")),(target.title?linktitle:linkelem)?.classList.add("selected")),editStates.selected=getSelectedIds();let contextmenuTransition=transitioner();contextmenuTransition.first(()=>domeditlink?.show()),contextmenuTransition.then(async()=>domeditlink?.classList?.add("shown")),contextmenuTransition.transition(10);let{x,y}=newEditDialogPosition(event);domeditlink.style.transform=`translate(${Math.floor(x)}px, ${Math.floor(y)}px)`,domtitle?.focus()}function toggleEditInputs(){let deleteButtonTxt=document.querySelector("#edit-delete span"),addButtonTxt=document.querySelector("#edit-add span"),{container:container2,target,selectall}=editStates,inputs=[];domeditlink.querySelectorAll("label, button, hr").forEach(node=>{node.classList.remove("on")}),document.querySelector("#edit-delete")?.removeAttribute("disabled"),document.querySelector("#edit-pin")?.removeAttribute("disabled"),domurl.value="",domicon.value="",domtitle.value="",container2.mini&&(target.synced?inputs=["pin","delete"]:target.addgroup?inputs=["title","add"]:target.title&&(inputs=["title","delete","pin","apply"])),container2.group&&(target.synced&&!target.title?inputs=["synced"]:target.synced&&target.title?inputs=["unpin","delete"]:selectall?inputs=["delete","refresh","add"]:target.title?inputs=["title","delete","unpin","apply"]:target.folder?inputs=["title","delete","apply"]:target.link?inputs=["title","url","icon","delete","refresh","apply"]:inputs=["title","url","add"]),container2.folder&&(target.title?inputs=[]:selectall?inputs=["delete","unfolder"]:target.link?inputs=["title","url","icon","delete","apply","unfolder"]:inputs=["title","url","add"]);for(let id of inputs)domeditlink.querySelector(`#edit-${id}`)?.classList.add("on");let hasLabels=inputs.includes("title")||inputs.includes("url")||inputs.includes("icon");return domeditlink.querySelector("hr")?.classList.toggle("on",hasLabels),deleteButtonTxt&&(selectall?deleteButtonTxt.textContent=tradThis("Delete selected"):target.folder?deleteButtonTxt.textContent=tradThis("Delete folder"):target.link?deleteButtonTxt.textContent=tradThis("Delete link"):target.title&&(deleteButtonTxt.textContent=tradThis("Delete group"))),addButtonTxt&&(selectall?addButtonTxt.textContent=tradThis("Create new folder"):target.title?addButtonTxt.textContent=tradThis("Add new group"):addButtonTxt.textContent=tradThis("Add new link")),inputs}function newEditDialogPosition(event){let editRects=domeditlink.getBoundingClientRect(),withPointer=event.type==="contextmenu"||event.type==="click"||event.type==="touchstart",withKeyboard=event.type==="keyup"&&event?.key==="e",{innerHeight,innerWidth}=window,isMobileSized=innerWidth<600,rightToLeft=document.documentElement.lang.match(/ar|fa/),x=0,y=0;withPointer&&isMobileSized?(x=(innerWidth-editRects.width)/2,y=(event.type==="touchstart"?event.touches[0].clientY:event.y)-60-editRects.height):withPointer?(x=(event.type==="touchstart"?event.touches[0].clientX:event.x)+20,y=(event.type==="touchstart"?event.touches[0].clientY:event.y)+20):withKeyboard&&(x=event.target.offsetLeft,y=event.target.offsetTop);let w=editRects.width+30,h=editRects.height+30;return x+w>innerWidth&&(x-=x+w-innerWidth),y+h>innerHeight&&(y-=h),rightToLeft&&(x*=-1),{x,y}}queueMicrotask(()=>{if(document.addEventListener("close-edit",closeEditDialog),document.getElementById("editlink-form")?.addEventListener("submit",submitChanges),domlinkblocks?.addEventListener("contextmenu",openEditDialog),SYSTEM_OS==="ios"||!IS_MOBILE){let handleLongPress=debounce(function(event){openEditDialog(event)},500);domlinkblocks?.addEventListener("touchstart",function(event){handleLongPress(event)}),domlinkblocks?.addEventListener("touchend",function(){handleLongPress.cancel()}),window.addEventListener("resize",closeEditDialog)}});function submitChanges(event){let change=event.submitter?.id,{container:container2,target,group,selected,selectall}=editStates;if(change==="edit-apply"&&applyLinkChanges("button"),change==="edit-refresh"&&quickLinks(void 0,{refreshIcons:selected}),change==="edit-inputs"){applyLinkChanges("inputs"),event.preventDefault();return}change==="edit-delete"&&(target.title?quickLinks(void 0,{deleteGroup:group}):quickLinks(void 0,{deleteLinks:selected})),change==="edit-add"&&(target.title?quickLinks(void 0,{addGroups:[{title:domtitle.value}]}):selectall?(quickLinks(void 0,{addFolder:{ids:selected,group}}),document.dispatchEvent(new Event("remove-select-all"))):container2.group&&quickLinks(void 0,{addLinks:[{group,title:domtitle.value,url:domurl.value}]})),change==="edit-unfolder"&&(quickLinks(void 0,{moveOutFolder:{ids:editStates.selected,group:editStates.group}}),document.dispatchEvent(new Event("remove-select-all"))),change==="edit-pin"&&togglePinGroup(group,"pin"),change==="edit-unpin"&&togglePinGroup(group,"unpin"),event.preventDefault(),setTimeout(closeEditDialog)}function applyLinkChanges(origin){let id=editStates.selected[0],li=document.querySelector(`#${id}`),inputs=document.querySelectorAll("#editlink input");if(editStates.target.addgroup){quickLinks(void 0,{addGroups:[{title:domtitle.value}]}),closeEditDialog();return}else if(editStates.target.title){quickLinks(void 0,{groupTitle:{old:domeditlink.dataset.group??"",new:domtitle.value}}),closeEditDialog();return}else if(editStates.container.group&&!editStates.target.link&&!editStates.target.folder){quickLinks(void 0,{addLinks:[{group:editStates.group,title:domtitle.value,url:domurl.value}]}),closeEditDialog();return}!id||!li||(origin==="inputs"&&inputs.forEach(node=>node.blur()),quickLinks(void 0,{updateLink:{id,title:document.querySelector("#e-title")?.value??"",icon:document.querySelector("#e-icon")?.value,url:document.querySelector("#e-url")?.value}}))}function closeEditDialog(){domeditlink.open&&(document.querySelectorAll(".link-title.selected, .link.selected").forEach(node=>node?.classList.remove("selected")),domeditlink.removeAttribute("data-tab"),domeditlink.classList.remove("shown"),domeditlink.close())}var blocks=new Map,groups=new Map,dropzones={group:new Map,link:new Map,mini:new Map},[dx,dy,cox,coy,lastIndex]=[0,0,0,0,0,0],lastdropAreas=[""],draggedGroup="",draggedId="",targetId="",targetGroup="",ids=[],initids=[],coords=[],dragContainers,dragChangeParentTimeout=0,dragAnimationFrame=0,domlinkblocks2=document.getElementById("linkblocks"),domlinklinks,domlinktitles,domlinkgroups,domlinkgroup;function startDrag(event){let path=event.composedPath(),type=path.some(element=>element?.className?.includes("link-title"))?"mini":"link",isMini=type==="mini";if(event.button>0)return;if(event.type==="pointerdown"){beforeStartDrag(event,type);return}ids=[],coords=[],initids=[],lastdropAreas=[],blocks.clear(),dropzones.group.clear(),dropzones.link.clear(),dropzones.mini.clear(),domlinkgroup=path.find(node=>node?.classList?.contains("link-group")),domlinkgroups=document.querySelectorAll("#linkblocks .link-group"),domlinklinks=document.querySelectorAll("#linkblocks li"),domlinktitles=document.querySelectorAll("#link-mini button"),dragContainers=document.querySelectorAll(isMini?"#link-mini":".link-group");let tagName=isMini?"BUTTON":"LI",target=path.find(node=>node.tagName===tagName),pos=getPosFromEvent(event);draggedId=findIdFromElement(target),draggedGroup=findIdFromElement(isMini?target:domlinkgroup),targetGroup=draggedGroup;let groupSizeOffsets=new Map;if(isMini){let beforeMap=new Map;for(let group of domlinktitles)beforeMap.set(group.dataset.group??"",group.getBoundingClientRect().x),group.style.width="12ch";for(let group of domlinktitles){let id=group.dataset.group??"",before=beforeMap.get(id)??0,after=group.getBoundingClientRect().x;groupSizeOffsets.set(id,after-before)}}for(let element of[...domlinkgroups,...domlinktitles,...domlinklinks]){let type2=findTypeFromElement(element),rect=element.getBoundingClientRect(),id=findIdFromElement(element);type2!=="group"?blocks.set(id,element):groups.set(id,element),dropzones[type2].set(id,{x:rect.x,y:rect.y,h:rect.height,w:rect.width})}for(let container2 of Object.values(dragContainers)){let elements2=container2.querySelectorAll(tagName),rect=(isMini?container2:container2.querySelector(".link-list"))?.getBoundingClientRect();for(let element of elements2){let type2=findTypeFromElement(element),id=findIdFromElement(element,type2),{x,y,w,h}=dropzones[type2].get(id)??{x:0,y:0,w:0,h:0};x=x-rect?.x,y=y-rect?.y,ids.push(id),initids.push(id),coords.push({x,y,w,h}),element.style.transition="none",setTimeout(()=>element.style.removeProperty("transition"),10),deplaceElem(element,x,y),id===draggedId&&(cox=pos.x-x+(groupSizeOffsets.get(id)??0),coy=pos.y-y,dx=pos.x,dy=pos.y,element.classList.add("on"))}container2.style.setProperty("--drag-width",Math.floor(rect?.width??0)+"px"),container2.style.setProperty("--drag-height",Math.floor(rect?.height??0)+"px"),container2.classList.add("in-drag","dragging")}document.dispatchEvent(new Event("remove-select-all")),dragAnimationFrame=window.requestAnimationFrame(deplaceDraggedElem),event.pointerType==="touch"?(document.documentElement.addEventListener("touchmove",moveDrag,{passive:!1}),document.documentElement.addEventListener("touchend",endDrag,{passive:!1})):(document.documentElement.addEventListener("pointermove",moveDrag),document.documentElement.addEventListener("pointerup",endDrag),document.documentElement.addEventListener("pointerleave",endDrag))}function beforeStartDrag(event,type){let target=type==="mini"?getTitleFromEvent(event):getLiFromEvent(event);if(cox=event.offsetX,coy=event.offsetY,!target)return;target?.addEventListener("pointermove",pointerDeadzone),target?.addEventListener("pointerup",pointerDeadzone);function pointerDeadzone(event2){let precision=event2.pointerType==="touch"?7:14,ox=Math.abs(cox-event2.offsetX),oy=Math.abs(coy-event2.offsetY),isEndEvents=event2.type.match(/pointerup|touchend/),isHalfOutside=ox>precision/2||oy>precision/2,isOutside=ox>precision||oy>precision;isHalfOutside&&document.dispatchEvent(new Event("stop-select-all")),isOutside&&startDrag(event2),(isOutside||isEndEvents)&&(target?.removeEventListener("pointermove",pointerDeadzone),target?.removeEventListener("pointerup",pointerDeadzone))}}function moveDrag(event){let{x,y}=getPosFromEvent(event);dx=x-cox,dy=y-coy;let[curr,id,type]=isDraggingOver({x,y})??["",""],last=lastdropAreas[lastdropAreas.length-1],secondlast=lastdropAreas[lastdropAreas.length-2],staysOutsideCenter=curr===last&&curr!=="center",isDifferentGroup=targetGroup!==draggedGroup;if(type==="group"){targetGroup=id,isDifferentGroup&&applyDragChangeParent(id,"group"),targetGroup===draggedGroup&&(blocks.forEach(block=>block.classList.remove("drop-target","drop-source")),groups.forEach(block=>block.classList.remove("drop-target","drop-source")));return}if(staysOutsideCenter||isDifferentGroup)return;if(curr===""){lastdropAreas.push(""),clearTimeout(dragChangeParentTimeout),blocks.forEach(block=>block.classList.remove("drop-target","drop-source"));return}let movesFromCenter=last==="center"&&(curr==="left"||curr==="right"),movesAcrossArea=curr!==secondlast,staysInCenter=last===curr&&curr==="center",idAtCurrentArea=ids[initids.indexOf(id)];staysInCenter&&applyDragChangeParent(type==="mini"?id:idAtCurrentArea,type),movesFromCenter&&movesAcrossArea&&applyDragMoveBlocks(id),last!==curr&&lastdropAreas.push(curr)}function applyDragMoveBlocks(id){let targetIndex=initids.indexOf(id);if(lastIndex!==targetIndex){clearTimeout(dragChangeParentTimeout),lastIndex=targetIndex,ids.splice(ids.indexOf(draggedId),1),ids.splice(targetIndex,0,draggedId);for(let i=0;i<ids.length;i++)ids[i]!==draggedId&&deplaceElem(blocks.get(ids[i]),coords[i].x,coords[i].y)}}function applyDragChangeParent(id,type){let propertyValue=getComputedStyle(domlinkblocks2).getPropertyValue("--drop-delay"),dropDelay=type==="group"?0:parseInt(propertyValue||"120");clearTimeout(dragChangeParentTimeout),dragChangeParentTimeout=setTimeout(()=>{let isDraggedId=id===draggedId,inFolder=domlinkgroup?.classList.contains("in-folder");isDraggedId||inFolder||type==="mini"&&(document.querySelector("#link-mini .link-title.selected-group")?.dataset.group??id)===id||(targetId=id,groups.forEach(block=>block.classList.remove("drop-target","drop-source")),blocks.forEach(block=>block.classList.remove("drop-target","drop-source")),blocks.get(draggedId)?.classList.toggle("drop-source",!0),type==="group"?groups.get(id)?.classList.toggle("drop-target",!0):blocks.get(id)?.classList.toggle("drop-target",!0))},dropDelay)}function endDrag(event){event.preventDefault(),document.documentElement.removeEventListener("pointermove",moveDrag),document.documentElement.removeEventListener("pointerup",endDrag),document.documentElement.removeEventListener("pointerleave",endDrag),document.documentElement.removeEventListener("touchmove",moveDrag),document.documentElement.removeEventListener("touchend",endDrag);let path=event.composedPath(),type=findTypeFromElement(blocks.get(draggedId)),group=domlinkgroup?.dataset.group??"",newIndex=ids.indexOf(draggedId),block=blocks.get(draggedId),coord=coords[newIndex],isDroppable=!!document.querySelector(".drop-source"),outOfFolder=!path[0]?.classList.contains("link-list")&&domlinkgroup?.classList.contains("in-folder"),targetIdIsLink=targetId.startsWith("links")&&targetId.length===11,toFolder=isDroppable&&targetIdIsLink,toTab=isDroppable&&!targetIdIsLink;window.cancelAnimationFrame(dragAnimationFrame),blocks.get(draggedId)?.classList.remove("on"),dragContainers.forEach(container2=>{container2?.classList.replace("dragging","dropping")}),outOfFolder||toFolder||toTab?blocks.get(draggedId)?.classList.add("removed"):deplaceElem(block,coord.x,coord.y),groups.forEach(block2=>block2.classList.remove("drop-target","drop-source")),setTimeout(()=>{let targetIsFolder=blocks.get(targetId)?.classList.contains("link-folder"),draggedIsFolder=blocks.get(draggedId)?.classList.contains("link-folder");type==="mini"?linksUpdate({moveGroups:ids}):toFolder&&!targetIsFolder&&!draggedIsFolder?linksUpdate({addFolder:{ids:[targetId,draggedId],group}}):toFolder&&targetIsFolder&&!draggedIsFolder?linksUpdate({moveToFolder:{source:draggedId,target:targetId}}):toFolder&&targetIsFolder&&draggedIsFolder?linksUpdate({concatFolders:{source:draggedId,target:targetId}}):toTab?linksUpdate({moveToGroup:{ids:[draggedId],target:targetId}}):outOfFolder?linksUpdate({moveOutFolder:{ids:[draggedId],group}}):linksUpdate({moveLinks:ids}),setTimeout(()=>{dragContainers.forEach(container2=>{container2?.removeAttribute("style"),container2?.classList.remove("in-drag","dropping"),container2.querySelectorAll("li, button").forEach(element=>{element.removeAttribute("style")})})},1)},200)}function deplaceElem(dom,x=0,y=0){dom&&(dom.style.transform=`translate(${Math.floor(x)}px, ${Math.floor(y)}px)`)}function deplaceDraggedElem(){let block=blocks.get(draggedId);block&&(block.style.transform=`translate(${dx}px, ${dy}px)`,dragAnimationFrame=window.requestAnimationFrame(deplaceDraggedElem))}function isDraggingOver({x,y}){let findArea=zones=>{for(let[id,zone]of zones){let ll=zone.x,lr=zone.x+zone.w*.2,lt=zone.y,lb=zone.y+zone.h,isInLeftEdge=x>ll&&x<lr&&y>lt&&y<lb,rl=zone.x+zone.w*.8,rr=zone.x+zone.w,rt=zone.y+0,rb=zone.y+zone.h,isInRightEdge=x>rl&&x<rr&&y>rt&&y<rb,cl=zone.x+zone.w*.2,cr=zone.x+zone.w*.8,ct=zone.y,cb=zone.y+zone.h,isInCenter=x>cl&&x<cr&&y>ct&&y<cb,area="";if(isInLeftEdge&&(area="left"),isInRightEdge&&(area="right"),isInCenter&&(area="center"),area)return{area,id}}},linkarea=findArea(dropzones.link);if(linkarea)return[linkarea.area,linkarea.id,"link"];let miniarea=findArea(dropzones.mini);if(miniarea)return[miniarea.area,miniarea.id,"mini"];let grouparea=findArea(dropzones.group);if(grouparea)return[grouparea.area,grouparea.id,"group"]}function getPosFromEvent(event){switch(event.type){case"touchmove":{let touch=event.touches[0];return{x:touch.clientX,y:touch.clientY}}case"pointermove":{let{x,y}=event;return{x,y}}}return{x:0,y:0}}function findTypeFromElement(element){if(element?.classList.contains("link"))return"link";if(element?.classList.contains("link-title"))return"mini";if(element?.classList.contains("link-group"))return"group";throw"No valid type found for specified element"}function findIdFromElement(element,type){if(type=type??findTypeFromElement(element),type==="link")return element?.id??"";if(type==="mini"||type==="group")return element?.dataset.group??"";throw"No valid type found for specified element"}var domlinkblocks3=document.getElementById("linkblocks");function initGroups(data,init2){init2||document.querySelectorAll("#link-mini button")?.forEach(node=>{node.remove()}),createGroups(data.linkgroups)}function createGroups(linkgroups){let{groups:groups2,pinned,synced,selected}=linkgroups;for(let group of[...groups2,"+"]){let button=document.createElement("button"),isTopSite=group==="topsites",isDefault=group==="default",isAddMore=group==="+";pinned.includes(group)||(button.textContent=group,button.dataset.group=group,button.classList.add("link-title"),button.classList.toggle("selected-group",group===selected),button.classList.toggle("synced",synced.includes(group)),isTopSite&&(button.textContent=tradThis("Most visited"),button.classList.add("topsites-title")),isDefault&&(button.textContent=tradThis("Default group")),isAddMore?(button.classList.add("add-group"),button.addEventListener("click",openEditDialog)):(button.addEventListener("click",changeGroup),button.addEventListener("pointerdown",startDrag)),document.querySelector("#link-mini div")?.appendChild(button))}domlinkblocks3?.classList.toggle("with-groups",linkgroups.on)}function changeGroup(event){let button=event.currentTarget,transition=transitioner();if(domlinkblocks3.dataset.folderid||button.classList.contains("selected-group"))return;transition.first(hideCurrentGroup),transition.then(recreateLinksFromNewGroup),transition.finally(showNewGroup),transition.transition(100);async function recreateLinksFromNewGroup(){let buttons=document.querySelectorAll("#link-mini button"),data=await storage_default.sync.get(),group=button.dataset.group??data.linkgroups.groups[0];buttons?.forEach(div=>div.classList.remove("selected-group")),button.classList.add("selected-group"),data.linkgroups.selected=group,storage_default.sync.set(data),await initblocks(data)}function hideCurrentGroup(){domlinkblocks3.classList.remove("in-folder"),domlinkblocks3.classList.add("hiding")}function showNewGroup(){domlinkblocks3.classList.remove("hiding")}}function toggleGroups(on,data){return domlinkblocks3?.classList.toggle("with-groups",on),data.linkgroups.on=on,data}function changeGroupTitle(title,data){let index=data.linkgroups.groups.indexOf(title.old);for(let link of getLinksInGroup(data,title.old))data[link._id]={...link,parent:title.new};return data.linkgroups.groups[index]=title.new,data.linkgroups.selected=title.new,initGroups(data),data}function addGroup(groups2,data){for(let{title,sync}of groups2){let isReserved=title==="default"||title==="+",isAlreadyUsed=data.linkgroups.groups.includes(title);if(isReserved||isAlreadyUsed)return data;for(let link of getLinksInGroup(data,"+"))data[link._id]={...link,parent:title};data.linkgroups.selected=title,data.linkgroups.groups.push(title),sync&&data.linkgroups.synced.push(title)}return initGroups(data),initblocks(data),data}function deleteGroup(group,data){let{groups:groups2,pinned,synced,selected}=data.linkgroups,isBroken=groups2.indexOf(group)===-1;if(groups2.length===1||isBroken)return data;for(let link of getLinksInGroup(data,group))delete data[link._id];return data.linkgroups.selected=group===selected||pinned.includes(group)?groups2[0]:selected,data.linkgroups.pinned=pinned.filter(p=>p!==group),data.linkgroups.synced=synced.filter(g=>g!==group),data.linkgroups.groups=groups2.filter(g=>g!==group),storage_default.sync.clear(),initblocks(data),initGroups(data),data}function moveGroups(mini,data){return mini=mini.filter(name=>name!=="+"),data.linkgroups.groups=data.linkgroups.pinned.concat(mini),initGroups(data),data}async function togglePinGroup(group,action){let data=await storage_default.sync.get(),{groups:groups2,pinned}=data.linkgroups;if(action==="pin"&&data.linkgroups.pinned.push(group),action==="unpin"&&(data.linkgroups.pinned=pinned.filter(pinned2=>pinned2!==group)),group===data.linkgroups.selected){let unpinned=groups2.filter(id=>pinned.includes(id)===!1);data.linkgroups.selected=unpinned[0]}storage_default.sync.set(data),initblocks(data),initGroups(data)}function settingsNotifications(notifs){onSettingsLoad(()=>{for(let[id,state]of Object.entries(notifs))document.getElementById(id)?.classList?.toggle("shown",state);let wrapper=document.getElementById("settings-notifications"),hasNotifs=document.querySelectorAll("#settings-notifications .param.shown").length>0;wrapper?.classList?.toggle("shown",hasNotifs)})}async function getPermissions(...args){return EXTENSION?await EXTENSION?.permissions.request({permissions:[...args]}):!0}var browserBookmarkFolders=[];async function linksImport(){let data=await storage_default.sync.get();document.querySelectorAll("#bookmarks-container > *")?.forEach(node=>{node.remove()}),await initBookmarkSync(data),createBookmarksDialog()}async function initBookmarkSync(data){let treenode=await getBookmarkTree(),permission=!!treenode;if(!permission)try{permission=await getPermissions("topSites","bookmarks")}catch{settingsNotifications({"accept-permissions":!0})}permission&&(treenode=await getBookmarkTree(),treenode&&(browserBookmarkFolders=bookmarkTreeToFolderList(treenode[0],data)))}function syncBookmarks(group){let folder=browserBookmarkFolders.find(folder2=>folder2.title===group),syncedLinks=[];if(folder)for(let bookmark of folder.bookmarks)syncedLinks.push(validateLink(bookmark.title,bookmark.url,folder.title));return syncedLinks}function createBookmarksDialog(){let bookmarkFolders=browserBookmarkFolders,bookmarksdom=document.querySelector("#bookmarks"),container2=document.querySelector("#bookmarks-container");if(!bookmarksdom){bookmarksdom=getHTMLTemplate("bookmarks-dialog-template","dialog"),container2=bookmarksdom.querySelector("#bookmarks-container");let closebutton=bookmarksdom.querySelector("#bmk_close"),applybutton=bookmarksdom.querySelector("#bmk_apply");bookmarksdom?.addEventListener("click",closeDialog),applybutton?.onclickdown(importSelectedBookmarks),closebutton?.onclickdown(closeDialog),document.body.appendChild(bookmarksdom)}for(let list of bookmarkFolders){let folder=getHTMLTemplate("bookmarks-folder-template","div"),selectButton=folder.querySelector(".b_bookmarks-folder-select"),syncButton=folder.querySelector(".b_bookmarks-folder-sync"),ol=folder.querySelector("ol"),h2=folder.querySelector(".bookmarks-folder-title-content");if(!(!ol||!h2)){h2.textContent=list.title,selectButton?.onclickdown(()=>toggleFolderSelect(folder)),syncButton?.onclickdown(()=>toggleFolderSync(folder)),folder.classList.toggle("used",list.used),folder.dataset.title=list.title,container2?.appendChild(folder),list.title==="topsites"&&syncButton&&(h2.textContent=tradThis("Most visited"),folder.classList.add("synced"),syncButton.setAttribute("disabled",""),syncButton.remove());for(let bookmark of list.bookmarks){let li=getHTMLTemplate("bookmarks-item-template","li"),li_button=li.querySelector("button"),li_title=li.querySelector(".bookmark-title"),li_url=li.querySelector(".bookmark-url"),li_img=li.querySelector("img");if(!li_title||!li_button||!li_url||!li_img||!bookmark.url.startsWith("http"))continue;let url=new URL(bookmark.url);li_img.src=`${API_DOMAIN}/favicon/blob/${url.origin}`,li_title.textContent=bookmark.title,li_url.textContent=url.href.replace(url.protocol,"").replace("//","").replace("www.","").slice(0,-1).replace("/",""),li_button?.onclickdown(()=>li.classList.toggle("selected")),li_button?.onclickdown(handleApplyButtonText),bookmark.used&&li_button.setAttribute("disabled",""),li.id=bookmark.id,ol?.appendChild(li)}}}document.getElementById("bmk_apply")?.setAttribute("disabled",""),document.dispatchEvent(new Event("toggle-settings")),traduction(bookmarksdom,getLang()),bookmarksdom.showModal(),setTimeout(()=>bookmarksdom.classList.add("shown"))}function importSelectedBookmarks(){let folders=browserBookmarkFolders,bookmarksdom=document.getElementById("bookmarks"),selectedLinks=bookmarksdom.querySelectorAll(".bookmarks-folder li.selected"),selectedFolders=bookmarksdom.querySelectorAll(".bookmarks-folder.selected"),syncedFolders=bookmarksdom.querySelectorAll(".bookmarks-folder.synced"),linksIds=Object.values(selectedLinks).map(element=>element.id),folderIds=Object.values(selectedFolders).map(element=>element.dataset.title),syncedIds=Object.values(syncedFolders).map(element=>element.dataset.title),links=[],groups2=[];folders.forEach(folder=>{let isFolderSelected=folderIds.includes(folder.title),isFolderSynced=syncedIds.includes(folder.title);isFolderSelected&&groups2.push({title:folder.title,sync:isFolderSynced}),!(isFolderSynced&&folder.title!=="topsites")&&folder.bookmarks.forEach(bookmark=>{let isBookmarkSelected=linksIds.includes(bookmark.id),group=isFolderSelected?folder.title:void 0,title=bookmark.title,url=bookmark.url;(isFolderSelected||isBookmarkSelected)&&links.push({title,url,group})})}),quickLinks(void 0,{groups:groups2.length>1?!0:void 0,addLinks:links,addGroups:groups2}),bookmarksdom?.classList.remove("shown"),bookmarksdom?.close(),closeDialog()}function handleApplyButtonText(){let applybutton=document.getElementById("bmk_apply"),links=document.querySelectorAll("#bookmarks li.selected"),folders=document.querySelectorAll("#bookmarks .bookmarks-folder.selected"),emptySelection=links.length===0&&folders.length===0;toggleDisabled(applybutton,emptySelection)}function closeDialog(event){let id=(event?.composedPath()??[])[0]?.id??"";if(!event||id==="bookmarks"||id==="bmk_close"){let bookmarksdom=document.querySelector("#bookmarks");bookmarksdom?.close(),bookmarksdom?.classList.remove("shown"),bookmarksdom?.querySelectorAll(".selected")?.forEach(node=>node.classList.remove("selected"))}}function toggleFolderSelect(folder){let selectButton=folder.querySelector(".b_bookmarks-folder-select"),syncButton=folder.querySelector(".b_bookmarks-folder-sync");selectButton&&(folder.classList.contains("selected")?(folder.classList.remove("selected"),syncButton?.classList.remove("selected"),syncButton?.setAttribute("disabled","")):(folder.classList.add("selected"),folder.querySelectorAll("li").forEach(li=>li?.classList.remove("selected")),syncButton?.removeAttribute("disabled")),handleApplyButtonText())}function toggleFolderSync(folder){folder.classList.contains("synced")?folder.classList.remove("synced"):folder.classList.add("synced")}async function getBookmarkTree(){let treenode=window.startupBookmarks??await EXTENSION?.bookmarks?.getTree(),topsites=window.startupTopsites??await EXTENSION?.topSites?.get();if(!(!treenode||!topsites))return PLATFORM==="chrome"&&treenode[0].children?.push({id:"",title:"Google Apps",children:[{id:"",title:"Youtube",url:"https://youtube.com"},{id:"",title:"Account",url:"https://myaccount.google.com"},{id:"",title:"Gmail",url:"https://mail.google.com"},{id:"",title:"Meet",url:"https://meet.google.com"},{id:"",title:"Maps",url:"https://maps.google.com"},{id:"",title:"Drive",url:"https://drive.google.com"},{id:"",title:"Photos",url:"https://photos.google.com"},{id:"",title:"Calendar",url:"https://calendar.google.com"},{id:"",title:"Translate",url:"https://translate.google.com"},{id:"",title:"News",url:"https://news.google.com"}]}),treenode[0].children?.unshift({id:"",title:"topsites",children:topsites.map(site=>({id:"",title:site.title,url:site.url}))}),treenode}function bookmarkTreeToFolderList(treenode,data){function createMapFromTree(treenode2){if(treenode2.children)for(let child of treenode2.children)child.children&&createMapFromTree(child),!(!child.url||(folders[treenode2.title]||(folders[treenode2.title]={title:treenode2.title,used:!1,bookmarks:[]}),folders[treenode2.title].bookmarks.map(b=>b.url).includes(child.url)))&&folders[treenode2.title].bookmarks.push({id:randomString(6),title:child.title,url:child.url,used:linksURLs.includes(child.url),dateAdded:child.dateAdded??0})}let linksURLs=bundleLinks(data).map(link=>isLink(link)&&link.url),folders={};createMapFromTree(treenode);for(let[folder,{bookmarks}]of Object.entries(folders)){let allUsed=bookmarks.every(b=>b.used),isGroup=data.linkgroups.groups.includes(folder);(data.linkgroups.synced.includes(folder)||isGroup&&allUsed)&&(folders[folder].used=!0)}return Object.values(folders)}var domlinkblocks4=document.getElementById("linkblocks");queueMicrotask(()=>{document.addEventListener("close-folder",closeFolder)});async function folderClick(event){let li=getLiFromEvent(event),rightClick=event.button===2,inFolder=li?.classList.contains("link-folder"),isSelectAll=domlinkblocks4.className.includes("select-all");if(!li||!inFolder||rightClick||isSelectAll)return;document.dispatchEvent(new Event("stop-select-all"));let data=await storage_default.sync.get(),ctrlClick=event.button===0&&(event.ctrlKey||event.metaKey),middleClick=event.button===1;ctrlClick||middleClick?openAllLinks(data,li):openFolder(data,li)}function openFolder(data,li){let linkgroup=li.parentNode.parentNode,linktitle=linkgroup.querySelector(".link-title"),folder=data[li.id],transition=transitioner();transition.first(hide),transition.then(changeToFolder),transition.finally(show),transition.transition(40);function hide(){linkgroup.dataset.folder=li?.id,linkgroup.classList.add("hiding"),linkgroup.classList.remove("in-folder")}async function changeToFolder(){await initblocks(data),linktitle&&(linktitle.textContent=folder?.title||tradThis("Folder"))}function show(){linkgroup.classList.replace("hiding","in-folder")}}async function closeFolder(){if(document.querySelector(".link-group.dropping"))return;let data=await storage_default.sync.get(),transition=transitioner();transition.first(hide),transition.then(changeToTab),transition.finally(show),transition.transition(40);function hide(){document.querySelectorAll(".link-group.in-folder")?.forEach(group=>{group.classList.add("hiding"),group.dataset.folder=""})}async function changeToTab(){domlinkblocks4.classList.toggle("with-groups",data.linkgroups.on),await initblocks(data)}function show(){document.querySelectorAll(".link-group")?.forEach(group=>{group.classList.remove("in-folder"),group.classList.remove("hiding")})}}function openAllLinks(data,li){getLinksInFolder(data,li.id).forEach(link=>window.open(link.url,"_blank")?.focus()),window.open(window.location.href,"_blank")?.focus(),window.close()}var domlinkblocks5=document.getElementById("linkblocks"),initIconList=[],selectallTimer=0;async function quickLinks(init2,event){if(event){linksUpdate(event);return}if(!init2){errorMessage("No data for quick links !");return}domlinkblocks5.classList.add(init2.linkstyle??"large"),domlinkblocks5.classList.toggle("titles",init2.linktitles),domlinkblocks5.classList.toggle("backgrounds",init2.linkbackgrounds),domlinkblocks5.classList.toggle("hidden",!init2.quicklinks),init2.linkgroups.synced.length>0&&await initBookmarkSync(init2),initGroups(init2,!!init2),initRows(init2.linksrow,init2.linkstyle),initblocks(init2,!0)}function initblocks(data,isInit){let allLinks=Object.values(data).filter(val=>isLink(val)),{pinned,synced,selected}=data.linkgroups,activeGroups=[];for(let group of[...pinned,selected]){let div=document.querySelector(`.link-group[data-group="${group}"]`),folder=div?.dataset.folder,lis=[],links=folder?getLinksInFolder(data,folder):getLinksInGroup(data,group);activeGroups.push({lis,div,links,title:group,pinned:group!==selected,synced:synced?.includes(group)})}activeGroups.reverse();let divs=activeGroups.map(g=>g.div),usedLis=activeGroups.map(group=>group.lis).flat();document.querySelectorAll("#linkblocks .link-group").forEach(div=>{div.querySelectorAll("li").forEach(li=>{usedLis.includes(li)===!1&&li.remove()}),divs.includes(div)===!1&&div.remove()});for(let group of activeGroups){let linkgroup=group.div??getHTMLTemplate("link-group-template",".link-group"),linksInFolders=allLinks.filter(link=>!link.folder&&typeof link.parent=="string"),linklist=linkgroup.querySelector("ul"),linktitle=linkgroup.querySelector("button"),fragment=document.createDocumentFragment(),folderid=linkgroup.dataset.folder;group.synced&&(group.links=syncBookmarks(group.title));for(let link of group.links){let li=group.lis.find(li2=>li2.id===link._id);if(li){li.removeAttribute("style"),linklist?.appendChild(li);continue}li=isElem(link)?createElem(link,data.linknewtab,data.linkstyle):createFolder(link,linksInFolders,data.linkstyle),fragment.appendChild(li),li.addEventListener("keyup",openEditDialog),group.synced||(li.addEventListener("click",selectAll),li.addEventListener("pointerdown",selectAll),li.addEventListener("pointerdown",startDrag))}folderid?linktitle.textContent=data[folderid].title:linktitle.textContent=group.title,linkgroup.dataset.group=group.title,linkgroup.classList.toggle("pinned",group.pinned),linkgroup.classList.toggle("synced",group.synced),linklist.appendChild(fragment),domlinkblocks5.prepend(linkgroup),group.title==="topsites"&&(linktitle.textContent=tradThis("Most visited"),linktitle.classList.add("topsites-title"),linkgroup.classList.add("topsites-group")),group.title==="default"&&(linktitle.textContent=tradThis("Default group"))}return createIcons(isInit),displayInterface("links"),!0}function createFolder(link,folderChildren,style){let li=getHTMLTemplate("link-folder-template","li"),imgs=li.querySelectorAll("img"),span=li.querySelector("span"),linksInThisFolder=folderChildren.filter(l=>!l.folder&&l.parent===link._id).toSorted((a,b)=>a.order-b.order);li.id=link._id,span.textContent=createTitle(link),li.addEventListener("mouseup",folderClick);for(let i=0;i<linksInThisFolder.length;i++){let img=imgs[i],elem=linksInThisFolder[i];img&&isElem(elem)&&style!=="text"&&initIconList.push([img,elem.icon??getDefaultIcon(elem.url)])}return li}function createElem(link,openInNewtab,style){let li=getHTMLTemplate("link-elem-template","li"),span=li.querySelector("span"),anchor=li.querySelector("a"),img=li.querySelector("img");if(li.id=link._id,anchor.href=stringMaxSize(link.url,512),span.textContent=createTitle(link),style!=="text"){let iconurl=link.icon??"",refresh=new Date(parseInt(iconurl))?.getTime(),icon=!Number.isInteger(refresh)&&!!link.icon?link.icon:getDefaultIcon(link.url,refresh);initIconList.push([img,icon])}return openInNewtab&&(anchor.target="_blank"),li}function createIcons(isInit){let loadingTimeout=isInit?400:0;for(let[img,url]of initIconList)img.src=url;setTimeout(()=>{let incomplete=initIconList.filter(([img])=>!img.complete);for(let[img,url]of incomplete){img.src="src/assets/interface/loading.svg";let newimg=document.createElement("img");newimg.addEventListener("load",()=>img.src=url),newimg.src=url}initIconList=[]},loadingTimeout)}function initRows(row,style){let sizes={large:{width:4.8,gap:2.3},medium:{width:3.5,gap:2},small:{width:2.5,gap:2},inline:{width:11,gap:2},text:{width:5,gap:2}};if(style in sizes){let{width,gap}=sizes[style];document.documentElement.style.setProperty("--links-width",Math.ceil((width+gap)*row)+"em")}}queueMicrotask(()=>{document.addEventListener("stop-select-all",()=>clearTimeout(selectallTimer)),document.addEventListener("remove-select-all",removeSelectAll)});function selectAll(event){clearTimeout(selectallTimer);let selectAllActive=domlinkblocks5.className.includes("select-all"),primaryButton=!event.button||event.button===0,li=getLiFromEvent(event);if(selectAllActive&&event.type.match(/pointerup|click/)){primaryButton&&li?.classList.toggle("selected"),event.preventDefault();return}if(!selectAllActive&&primaryButton&&event.type==="pointerdown"){if(event?.pointerType==="touch")return;selectallTimer=setTimeout(()=>{domlinkblocks5.classList.add("select-all")},600)}}function removeSelectAll(){clearTimeout(selectallTimer),domlinkblocks5.classList.remove("select-all"),domlinkblocks5.querySelectorAll(".link").forEach(li=>li.classList.remove("selected"))}async function linksUpdate(update2){let data=await storage_default.sync.get();update2.addLinks&&(data=linkSubmission({type:"link",links:update2.addLinks},data)),update2.addFolder&&(data=linkSubmission({type:"folder",...update2.addFolder},data)),update2.addGroups&&(data=addGroup(update2.addGroups,data)),update2.moveLinks&&(data=moveLinks(update2.moveLinks,data)),update2.moveGroups&&(data=moveGroups(update2.moveGroups,data)),update2.moveToGroup&&(data=moveToGroup(update2.moveToGroup,data)),update2.moveToFolder&&(data=moveToFolder(update2.moveToFolder,data)),update2.concatFolders&&(data=concatFolders(update2.concatFolders,data)),update2.moveOutFolder&&(data=moveOutFolder(update2.moveOutFolder,data)),update2.updateLink&&(data=updateLink(update2.updateLink,data)),update2.deleteLinks&&(data=deleteLinks(update2.deleteLinks,data)),update2.groupTitle&&(data=changeGroupTitle(update2.groupTitle,data)),update2.deleteGroup!==void 0&&(data=deleteGroup(update2.deleteGroup,data)),update2.groups!==void 0&&(data=toggleGroups(update2.groups,data)),update2.newtab!==void 0&&(data=setOpenInNewTab(update2.newtab,data)),update2.refreshIcons&&(data=refreshIcons(update2.refreshIcons,data)),update2.styles&&setLinkStyle(update2.styles),update2.row&&setRows(update2.row),!(update2.styles||update2.row)&&storage_default.sync.set(data)}function linkSubmission(args,data){let folderid=domlinkblocks5.dataset.folderid,type=args.type,newlinks=[];if(type==="link"&&args.links.forEach(link=>{newlinks.push(validateLink(link.title,link.url,link.group))}),type==="folder"){let{ids:ids2,title,group}=args;newlinks=addLinkFolder(ids2,title,group);for(let id of ids2){let elem=data[id];elem&&!elem.folder&&(elem.parent=newlinks[0]._id)}}for(let link of newlinks){let addsFromFolder=folderid&&!link.folder,noParents=link.parent===void 0,{selected,synced}=data.linkgroups;addsFromFolder?link.parent=folderid:noParents&&synced.includes(selected)?(link.parent="",data.linkgroups.selected="",initGroups(data)):noParents&&(link.parent=selected),data[link._id]=link}return data=correctLinksOrder(data),initblocks(data),data}function addLinkFolder(ids2,title,group){let titledom=document.getElementById("e-title");title=title??titledom.value,titledom.value="";let order=[...document.querySelectorAll(".link")].map(block=>block.id).indexOf(ids2[0]);for(let i=0;i<ids2.length;i++)document.getElementById(ids2[i])?.classList.contains("link-folder")&&ids2.splice(i,1);return[{_id:"links"+randomString(6),folder:!0,order,parent:group??"",title}]}function updateLink({id,title,icon,url},data){let titledom=document.querySelector(`#${id} span`),icondom=document.querySelector(`#${id} img`),urldom=document.querySelector(`#${id} a`),link=data[id];if(titledom&&title!==void 0&&(link.title=stringMaxSize(title,64),titledom.textContent=link.title),!link.folder){if(icondom){let url2=(icon?stringMaxSize(icon,7500):void 0)??getDefaultIcon(link.url),img=document.createElement("img");link.icon=url2||void 0,icondom.src="src/assets/interface/loading.svg",img.onload=()=>icondom.src=url2,img.src=url2}titledom&&urldom&&url!==void 0&&(link.url=stringMaxSize(url,512),urldom.href=link.url,titledom.textContent=createTitle(link))}return data[id]=link,data}function concatFolders({target,source},data){let linktarget=data[target],linksource=data[source];if(!linktarget.folder||!linksource.folder)return data;let sourceIds=getLinksInFolder(data,source).map(({_id})=>_id),ids2=[...getLinksInFolder(data,target).map(({_id})=>_id),...sourceIds];for(let[key,val]of Object.entries(data))isLink(val)!==!1&&ids2.includes(val._id)&&!val.folder&&(data[key].parent=target,data[key].order=Date.now());return delete data[source],initblocks(data),setTimeout(()=>storage_default.sync.remove(source)),data}function moveToFolder({target,source},data){let isSourceElem=typeof data[source]?.url=="string",isTargetFolder=data[target]?.folder===!0;return isSourceElem&&isTargetFolder&&(data[source].parent=target,data[source].order=Date.now(),initblocks(data)),data}function moveOutFolder({ids:ids2,group},data){for(let id of ids2)data[id].parent=group,data[id].order=Date.now();return data=correctLinksOrder(data),initblocks(data),data}function deleteLinks(ids2,data){for(let id of ids2){let link=data[id];link.folder&&getLinksInFolder(data,link._id).forEach(child=>{delete data[child._id]}),delete data[id]}return storage_default.sync.clear(),data=correctLinksOrder(data),animateLinksRemove(ids2),data}function moveLinks(ids2,data){return ids2.forEach((id,i)=>{data[id].order=i}),initblocks(data),data}function moveToGroup({ids:ids2,target},data){for(let id of ids2)data[id].parent=target,data[id].order=Date.now();return data=correctLinksOrder(data),initblocks(data),data}function refreshIcons(ids2,data){for(let id of ids2){let link=data[id];link._id&&(link.icon=Date.now().toString(),data[id]=link)}return initblocks(data),data}function setOpenInNewTab(newtab,data){let anchors=document.querySelectorAll(".link a");for(let anchor of anchors)newtab?anchor.setAttribute("target","_blank"):anchor.removeAttribute("target");return data.linknewtab=newtab,data}async function setLinkStyle(styles){let data=await storage_default.sync.get(),style=styles.style??"large",{titles}=styles,{backgrounds}=styles;if(styles.style&&isLinkStyle(style)){let wasText=domlinkblocks5?.className.includes("text");domlinkblocks5.classList.remove("large","medium","small","inline","text"),domlinkblocks5.classList.add(style),data.linkstyle=style,storage_default.sync.set({linkstyle:style}),wasText&&document.querySelectorAll("#link-list li")?.forEach(el=>{el.remove()}),initRows(data.linksrow,style),initblocks(data)}typeof titles=="boolean"&&(data.linktitles=titles,storage_default.sync.set({linktitles:titles}),document.getElementById("b_showtitles")?.classList?.toggle("on",titles),domlinkblocks5.classList.toggle("titles",titles)),typeof backgrounds=="boolean"&&(data.linkbackgrounds=backgrounds,storage_default.sync.set({linkbackgrounds:backgrounds}),document.getElementById("b_showbackgrounds")?.classList?.toggle("on",backgrounds),domlinkblocks5.classList.toggle("backgrounds",backgrounds))}function setRows(row){let style=[...domlinkblocks5.classList].filter(isLinkStyle)[0]??"large",val=parseInt(row??"6");initRows(val,style),eventDebounce({linksrow:row})}function validateLink(title,url,parent){let startsWithEither=strs=>strs.some(str=>url.startsWith(str));url=stringMaxSize(url,512);let isConfig=startsWithEither(["about:","chrome://","edge://"]),noProtocol=!startsWithEither(["https://","http://"]),isLocalhost=url.startsWith("localhost")||url.startsWith("127.0.0.1");return url=(isConfig?"#":isLocalhost?"http://":noProtocol?"https://":"")+url,{_id:"links"+randomString(6),parent,order:Date.now(),title:stringMaxSize(title,64),url}}function animateLinksRemove(ids2){for(let id of ids2)document.getElementById(id)?.classList.add("removed"),setTimeout(()=>document.getElementById(id)?.remove(),600)}function correctLinksOrder(data){let folderIds=Object.values(data).filter(val=>isLink(val)).filter(link=>link.folder).map(({_id})=>_id);for(let folderId of folderIds)getLinksInFolder(data,folderId).forEach((link,i)=>{link.order=i,data[link._id]});for(let group of data.linkgroups.groups)getLinksInGroup(data,group).forEach((link,i)=>{link.order=i,data[link._id]});return data}function isLinkStyle(s){return["large","medium","small","inline","text"].includes(s)}var MOVE_WIDGETS=["time","main","quicklinks","notes","quotes","searchbar"],elements={time:document.getElementById("time"),main:document.getElementById("main"),quicklinks:document.getElementById("linkblocks"),searchbar:document.getElementById("sb_container"),notes:document.getElementById("notes_container"),quotes:document.getElementById("quotes_container")},defaultLayouts={single:{grid:[["time"],["main"],["quicklinks"]],items:{}},double:{grid:[["time","."],["main","."],["quicklinks","."]],items:{}},triple:{grid:[["time",".","."],["main",".","."],["quicklinks",".","."]],items:{}}};function isEditing(){return document.getElementById("interface")?.classList.contains("move-edit")||!1}function hasDuplicateInArray(arr,id){return arr.filter(a=>a===id).length>1}function getLayout(move,selection){return move=move?.move?move.move:move,selection=selection??move.selection,move.layouts?.[selection]??defaultLayouts[selection]}function gridValidate(grid){return grid.flat().every(val=>val==="."||MOVE_WIDGETS.includes(val))}function gridParse(area=""){let stringToGrid=split=>area.split(split).filter(a=>a.length>1).map(r=>r.split(" ")),result=stringToGrid("'");return gridValidate(result)?result:stringToGrid('"')}function gridStringify(grid){let areas="",itemListToString=row=>row.reduce((a,b)=>`${a} ${b}`);return grid.forEach(row=>areas+=`'${itemListToString(row)}' `),areas.trimEnd()}function gridFind(grid,id){let positions=[];return grid.flat().forEach((a,i)=>{if(a!==id)return;let column=i%grid[0].length,row=Math.floor(i/grid[0].length);positions.push([column,row])}),positions}function getSpanDirection(grid,id){let poses=gridFind(grid,id),rows=Object.values(poses).map(([_,row])=>row);return poses.length<2?"none":rows[0]!==rows[1]?"columns":"rows"}function isRowEmpty(grid,index){if(grid[index]===void 0)return!1;let row=grid[index],empty=!0;return row.forEach(cell=>{cell!=="."&&getSpanDirection(grid,cell)!=="columns"&&(empty=!1)}),empty}function spansInGridArea(grid,id,{toggle,remove}){function addSpans(arr){let target=arr.indexOf(id),stopper=[!1,!1];function replaceWithId(a,i,lim){return!stopper[lim]&&a[i]&&(a[i]==="."?a[i]=id:a[i]!==id&&(stopper[lim]=!0)),a}for(let ii=1;ii<arr.length;ii++)arr=replaceWithId(arr,target+ii,0),arr=replaceWithId(arr,target-ii,1);return arr}function removeSpans(arr){let keepfirst=!0;return arr.map(a=>{if(a===id)if(keepfirst)keepfirst=!1;else return".";return a})}let[x,y]=gridFind(grid,id)[0],col=grid.map(g=>g[x]),row=[...grid[y]];return remove&&(col=removeSpans(col),row=removeSpans(row)),toggle&&(toggle==="col"&&(col=hasDuplicateInArray(col,id)?removeSpans(col):addSpans(col)),toggle==="row"&&(row=hasDuplicateInArray(row,id)?removeSpans(row):addSpans(row))),grid.forEach((_,i)=>grid[i][x]=col[i]),grid[y].forEach((_,i)=>grid[y][i]=row[i]),grid}function getWidgetsStorage(data){let displayed={time:data.time,main:data.main,notes:!!data.notes?.on,searchbar:!!data.searchbar?.on,quicklinks:data.quicklinks,quotes:!!data.quotes?.on};return Object.entries(displayed).filter(([_,val])=>val).map(([key,_])=>key)}function updateWidgetsStorage(states,data){for(let[id,on]of states)id==="time"&&(data.time=on),id==="main"&&(data.main=on),id==="quicklinks"&&(data.quicklinks=on),id==="quotes"&&(data.quotes={...data.quotes,on}),id==="searchbar"&&(data.searchbar={...data.searchbar,on}),id==="notes"&&data.notes&&(data.notes={...data.notes,on});return data}function getGridWidgets(area){let list=area.replaceAll("'","").replaceAll(".","").split(" ");return list.filter((str,i)=>str&&list.indexOf(str)===i)}function addGridWidget(grid,id,selection){let newrow=addGridRow(selection,id),rows=grid.split("'").filter(row=>!(row===" "||row==="")),position=0;if(grid==="")return`'${newrow}'`;let isFirstWidgetTime=rows[0].includes("time"),isLastWidgetQuotes=rows.at(-1)?.includes("quotes");return id==="time"&&(position=0),id==="main"&&(position=isFirstWidgetTime?1:0),id==="notes"&&(position=rows.length===1?1:2),id==="searchbar"&&(position=rows.length===1?1:2),id==="quicklinks"&&(position=rows.length-(isLastWidgetQuotes?1:0)),id==="quotes"&&(position=rows.length),rows.splice(position,0,newrow),rows=rows.map(row=>`'${row}'`),grid=rows.join(" "),grid}function removeGridWidget(grid,id,_){let rows=grid.split("'").filter(row=>!(row===" "||row===""));return rows=rows.filter(row=>!row.includes(id)),rows=rows.map(row=>`'${row}'`),grid=rows.join(" "),grid}function addGridRow(selection,id){return`${selection==="triple"?". ":""}${id}${selection==="triple"||selection==="double"?" .":""}`}var moverdom=document.querySelector("#element-mover"),resetTimeout,firstPos={x:0,y:0},moverPos={x:0,y:0};function toolboxEvents(){let elementEntries=Object.entries(elements),moverBtns=document.querySelectorAll("#grid-mover button"),boxAlignBtns=document.querySelectorAll("#box-alignment-mover button"),textAlignBtns=document.querySelectorAll("#text-alignment-mover button"),spanColsBtn=document.querySelector("#grid-span-cols"),spanRowsBtn=document.querySelector("#grid-span-rows"),resetBtn=document.querySelector("#b_resetlayout"),closeBtn=document.querySelector("#close-mover");elementEntries.forEach(([key,element])=>{element?.onclickdown(()=>updateMoveElement({select:key}),{propagate:!1})}),moverBtns.forEach(button=>{button.onclickdown(()=>{updateMoveElement({grid:{x:button.dataset.col,y:button.dataset.row}})})}),boxAlignBtns.forEach(button=>{button.onclickdown(()=>{updateMoveElement({box:button.dataset.align})})}),textAlignBtns.forEach(button=>{button.onclickdown(()=>{updateMoveElement({text:button.dataset.align})})}),spanColsBtn?.onclickdown(()=>updateMoveElement({span:"col"})),spanRowsBtn?.onclickdown(()=>updateMoveElement({span:"row"})),closeBtn?.addEventListener("click",()=>updateMoveElement({toggle:!1})),resetBtn?.addEventListener("click",()=>updateMoveElement({reset:!0})),moverdom?.addEventListener("mousedown",startDrag2),moverdom?.addEventListener("mouseup",removeDrag),moverdom?.addEventListener("mouseleave",removeDrag),moverdom?.addEventListener("touchstart",startDrag2,{passive:!1}),moverdom?.addEventListener("touchend",removeDrag);function startDrag2(event){let target=event.target,validTags=target?.tagName==="HR"||target?.tagName==="P",validIds=target?.id==="element-mover"||target?.id==="close-mover-wrapper";(validTags||validIds)&&moverdom?.addEventListener(event.type.includes("touch")?"touchmove":"mousemove",moverDrag)}function moverDrag(event){let pos=event.touches?event.touches[0]:event,x=pos.clientX,y=pos.clientY;if(firstPos.x===0&&firstPos.y===0){firstPos={x:x-moverPos.x,y:y-moverPos.y};return}moverPos={x:x-firstPos.x,y:y-firstPos.y},moverdom&&(document.documentElement.style.overscrollBehavior="none",moverdom.style.transform=`translate(${moverPos.x}px, ${moverPos.y}px)`)}function removeDrag(){firstPos={x:0,y:0},moverdom.style.removeProperty("cursor"),document.documentElement.style.removeProperty("overscroll-behavior"),moverdom?.removeEventListener("mousemove",moverDrag),moverdom?.removeEventListener("touchmove",moverDrag)}}function layoutButtons(selection){document.querySelectorAll("#grid-layout button").forEach(button=>{button.classList.toggle("selected",button.dataset.layout===selection)})}function gridButtons(id){let property=document.documentElement?.style.getPropertyValue("--grid")||"",grid=gridParse(property);if(grid.length===0)return;let top=!1,bottom=!1,left=!1,right=!1,positions=gridFind(grid,id),widgetBottomLimit=getGridWidgets(gridStringify(grid)).length-1,rightLimit=grid[0].length-1;positions.forEach(([col,row])=>{if(row===0&&(top=!0),col===0&&(left=!0),col===rightLimit&&(right=!0),row===widgetBottomLimit&&(bottom=!0),row===grid.length-1){let idOnlyRow=grid.at(row)?.filter(id2=>id2!==".");new Set(idOnlyRow).size===1&&(bottom=!0)}}),document.querySelectorAll("#grid-mover button").forEach(button=>{let c=parseInt(button.dataset.col||"0"),r=parseInt(button.dataset.row||"0"),limit=!1;r===-1&&(limit=top),r===1&&(limit=bottom),c===-1&&(limit=left),c===1&&(limit=right),toggleDisabled(button,limit)})}function spanButtons(id){let gridstring=document.documentElement?.style.getPropertyValue("--grid")||"",grid=gridParse(gridstring);if(grid.length===0)return;let applyStates=(dir,state)=>{let dirButton=document.querySelector(`#grid-span-${dir}s`),otherButton=document.querySelector(`#grid-span-${dir==="col"?"rows":"cols"}`);toggleDisabled(otherButton,state),dirButton?.classList.toggle("selected",state)},[posCol,posRow]=gridFind(grid,id)[0],col=grid.map(g=>g[posCol]),row=[...grid[posRow]],hasColumnDuplicates=hasDuplicateInArray(col,id),hasRowDuplicates=hasDuplicateInArray(row,id);applyStates("col",hasColumnDuplicates),applyStates("row",hasRowDuplicates)}function alignButtons(align){let{box,text}=align??{box:"",text:""},boxBtns=document.querySelectorAll("#box-alignment-mover button"),textBtns=document.querySelectorAll("#text-alignment-mover button");boxBtns.forEach(b=>b.classList.toggle("selected",b.dataset.align===(box||"center"))),textBtns.forEach(b=>b.classList.toggle("selected",b.dataset.align===(text||"center")))}function resetButton(){let b_resetlayout=document.getElementById("b_resetlayout"),confirm=!!b_resetlayout.dataset.confirm;return clearTimeout(resetTimeout),confirm===!1?(b_resetlayout.textContent=tradThis("Are you sure?"),b_resetlayout.dataset.confirm="true",resetTimeout=setTimeout(()=>{b_resetlayout.textContent=tradThis("Reset layout"),b_resetlayout.dataset.confirm=""},1e3)):(b_resetlayout.textContent=tradThis("Reset layout"),b_resetlayout.dataset.confirm=""),confirm}function showSpanButtons(column){column!=="single"?document.getElementById("grid-spanner-container")?.classList.add("active"):document.getElementById("grid-spanner-container")?.classList.remove("active")}var dominterface=document.querySelector("#interface");function setGridAreas(grid){let property=typeof grid=="string"?grid:gridStringify(grid);document.documentElement.style.setProperty("--grid",property)}function setAlign(id,align){let{box,text}=align??{box:"",text:""},elem=elements[id];elem&&(elem.style.placeSelf=box,id==="quicklinks"?(document.getElementById("linkblocks")?.classList.remove("text-left","text-right"),text=="left"&&document.getElementById("linkblocks")?.classList.add("text-left"),text=="right"&&document.getElementById("linkblocks")?.classList.add("text-right")):elem.style.textAlign=text||"")}function setAllAligns(items){for(let[widget2,align]of Object.entries(items))setAlign(widget2,align)}function addOverlay(id){let button=document.createElement("button");button.id="move-overlay-"+id,button.className="move-overlay",dominterface?.appendChild(button),button.onclickdown(()=>{moveElements(void 0,{select:id})})}function removeOverlay(id){id?document.querySelector("#move-overlay-"+id)?.remove():document.querySelectorAll(".move-overlay").forEach(d=>d.remove())}function removeSelection(){let toolbox=document.getElementById("element-mover");document.querySelectorAll(".move-overlay, #grid-mover button, .grid-spanner, #element-mover button").forEach(elem=>{elem.classList.remove("selected"),elem.removeAttribute("disabled")}),toolbox?.classList.remove("active")}function interfaceFade(fade){if(fade==="in"){let dominterface4=document.getElementById("interface");dominterface4.style.removeProperty("opacity"),setTimeout(()=>dominterface4.style.transition="",200)}if(fade=="out"){let dominterface4=document.getElementById("interface");dominterface4.style.opacity="0",dominterface4.style.transition="opacity 200ms cubic-bezier(.215,.61,.355,1)"}}function toggleWidget(data,widget2){if(!widget2)return;let[id,on]=widget2,gridToggle=on?addGridWidget:removeGridWidget,interfaceTransition=transitioner(),selection=data.move.selection,layout=getLayout(data),grid=gridParse(gridToggle(gridStringify(layout.grid),id,selection));data.move.layouts[selection]={items:layout.items,grid},data=updateWidgetsStorage([widget2],data),storage_default.sync.set(data),interfaceTransition.first(()=>{toggleWidgetInSettings([[id,on]]),interfaceFade("out")}),interfaceTransition.then(async()=>{let layout2=getLayout(data);setGridAreas(layout2.grid),setAllAligns(layout2.items),toggleWidgetOnInterface([[id,on]]),removeSelection(),isEditing()&&(on?addOverlay(id):removeOverlay(id))}),interfaceTransition.finally(()=>{interfaceFade("in")}),interfaceTransition.transition(200)}function toggleWidgetInSettings(states){let inputids={time:"i_time",main:"i_main",quicklinks:"i_quicklinks",notes:"i_notes",quotes:"i_quotes",searchbar:"i_sb"};for(let[widget2,on]of states){let input=document.getElementById(inputids[widget2]);document.getElementById(widget2+"_options")?.classList.toggle("shown",on),input.checked=on}}function toggleWidgetOnInterface(states){let domids={time:"time",main:"main",quicklinks:"linkblocks",notes:"notes_container",quotes:"quotes_container",searchbar:"sb_container"};for(let[widget2,on]of states)document.getElementById(domids[widget2])?.classList.toggle("hidden",!on)}var dominterface2=document.querySelector("#interface"),widget;function moveElements(init2,events){if(!init2&&!events){updateMoveElement({reset:!0});return}if(events){updateMoveElement(events);return}if(init2){let{grid,items}=getLayout(init2);setAllAligns(items),setGridAreas(gridStringify(grid)),onSettingsLoad(()=>{toolboxEvents(),showSpanButtons(init2.selection)})}}async function updateMoveElement(event){let data=await storage_default.sync.get();data.move||(data.move=structuredClone(SYNC_DEFAULT.move)),event.grid&&gridChange(data.move,event.grid),event.span&&toggleGridSpans(data.move,event.span),event.layout&&layoutChange(data,event.layout),event.reset&&layoutReset(data),event.widget&&toggleWidget(data,event.widget),event.select&&elementSelection(data.move,event.select),event.box!==void 0&&alignChange(data.move,event.box,"box"),event.text!==void 0&&alignChange(data.move,event.text,"text"),event.toggle!==void 0&&toggleMoveStatus(data,event.toggle),event.overlay!==void 0&&pageWidthOverlay(data.move,event.overlay)}function gridChange(move,gridpos){if(!widget)return;let y=parseInt(gridpos?.y||"0"),x=parseInt(gridpos?.x||"0"),layout=getLayout(move),positions=gridFind(layout.grid,widget),affectedIds=[],grid=layout.grid;positions.some(([col])=>grid[col+y]===void 0)&&(move.selection==="single"&&grid.push(["."]),move.selection==="double"&&grid.push([".","."]),move.selection==="triple"&&grid.push([".",".","."])),positions.forEach(([col,row])=>{let newposition=grid[row+y][col+x];newposition!=="."&&affectedIds.push(newposition)}),affectedIds.forEach(id=>{gridFind(grid,id).length>1&&(grid=spansInGridArea(grid,id,{remove:!0}))}),positions.forEach(([col,row])=>{let newRow=Math.min(Math.max(row+y,0),grid.length-1),newCol=Math.min(Math.max(col+x,0),grid[0].length-1),tempItem=grid[row][col];grid[row][col]=grid[newRow][newCol],grid[newRow][newCol]=tempItem}),grid.forEach((_,i)=>{isRowEmpty(grid,i)&&grid.splice(i,1)}),layout.grid=grid,move.layouts[move.selection]=layout,storage_default.sync.set({move}),setGridAreas(grid),gridButtons(widget)}function alignChange(move,value,type){if(!widget)return;let layout=getLayout(move),align=layout.items[widget]??{box:"",text:""};type==="box"&&(align.box=value),type==="text"&&(align.text=value),layout.items[widget]=align,move.layouts[move.selection]=layout,storage_default.sync.set({move}),alignButtons(align),setAlign(widget,align)}function layoutChange(data,column){if(column===data.move.selection)return;(column==="single"||column==="double"||column==="triple")&&(data.move.selection=column);let layout=getLayout(data),widgetsInGrid=getGridWidgets(gridStringify(layout.grid)),list=[["time",widgetsInGrid.includes("time")],["main",widgetsInGrid.includes("main")],["notes",widgetsInGrid.includes("notes")],["quotes",widgetsInGrid.includes("quotes")],["searchbar",widgetsInGrid.includes("searchbar")],["quicklinks",widgetsInGrid.includes("quicklinks")]];data=updateWidgetsStorage(list,data),storage_default.sync.set(data);let interfaceTransition=transitioner();interfaceTransition.first(()=>{interfaceFade("out")}),interfaceTransition.then(async()=>{let layout2=getLayout(data);setAllAligns(layout2.items),setGridAreas(layout2.grid),layoutButtons(data.move.selection),showSpanButtons(data.move.selection),removeSelection(),toggleWidgetInSettings(list),toggleWidgetOnInterface(list),widget&&(gridButtons(widget),alignButtons(layout2.items[widget]))}),interfaceTransition.finally(()=>{interfaceFade("in")}),interfaceTransition.transition(200)}function layoutReset(data){let enabledWidgets=getWidgetsStorage(data),grid="";resetButton()!==!1&&(enabledWidgets.forEach(id=>{grid=addGridWidget(grid,id,data.move.selection)}),data.move.layouts[data.move.selection]={grid:gridParse(grid),items:{}},storage_default.sync.set(data),removeSelection(),setGridAreas(grid),setAllAligns({quicklinks:void 0,main:void 0,time:void 0,notes:void 0,searchbar:void 0,quotes:void 0}))}function elementSelection(move,select){removeSelection(),!(!isEditing()||!select)&&(widget=select,alignButtons(getLayout(move).items[widget]),spanButtons(widget),gridButtons(widget),document.getElementById("move-overlay-"+widget).classList.add("selected"),document.getElementById("element-mover")?.classList.add("active"))}function toggleMoveStatus(data,force){let mover=document.getElementById("element-mover"),b_editmove=document.getElementById("b_editmove"),isEditing2=dominterface2?.classList.contains("move-edit"),hasOverlay=document.querySelector(".move-overlay")===null;force??!isEditing2?hasOverlay&&(b_editmove.textContent=tradThis("Close"),dominterface2?.classList.add("move-edit"),mover.classList.remove("hidden"),getWidgetsStorage(data).forEach(id=>addOverlay(id))):(b_editmove.textContent=tradThis("Open"),dominterface2?.classList.remove("move-edit"),mover.classList.add("hidden"),removeOverlay()),mover?.classList.remove("active"),removeSelection()}function toggleGridSpans(move,dir){if(!widget)return;let layout=getLayout(move),gridWithSpan=spansInGridArea(layout.grid,widget,{toggle:dir});move.layouts[move.selection]={items:layout.items,grid:gridWithSpan},storage_default.sync.set({move}),setGridAreas(gridWithSpan),gridButtons(widget),spanButtons(widget)}function pageWidthOverlay(move,overlay){let isEditing2=document.getElementById("interface")?.classList?.contains("move-edit"),hasOverlays=document.querySelector(".move-overlay");if(!isEditing2&&overlay===!1){removeOverlay();return}if(!hasOverlays){let layout=getLayout(move),grid=gridStringify(layout.grid),ids2=getGridWidgets(grid);for(let id of ids2)addOverlay(id)}}async function hideElements(hide={},options){options?.isEvent&&(hide={...(await storage_default.sync.get("hide")).hide,...hide},storage_default.sync.set({hide}));for(let[key,val]of Object.entries(hide))document.querySelectorAll(`[data-hide="${key}"]`).forEach(element=>{element?.classList.toggle("he_hidden",val)})}var ANNOUNCEMENT_URL="https://github.com/victrme/Bonjourr/releases/tag/v20.4.0",ANNOUNCEMENT_VERSION="20.4.0",ANNOUNCEMENT_TRNS={en:"<b>Version 20.4 \u2728</b> New supporters notification, Gist synchronisation improvements and small interaction fixes!",fr:"<b>Version 20.4 \u2728</b> Nouvelle notification pour les supporters, am\xE9liorations de la synchronisation Gist et petites corrections d'interaction !",de:"<b>Version 20.4 \u2728</b> Neue Unterst\xFCtzer-Benachrichtigung, Gist-Synchronisationsverbesserungen und kleine Interaktionskorrekturen!",it:"<b>Versione 20.4 \u2728</b> Nuova notifica per i sostenitori, miglioramenti alla sincronizzazione Gist e piccole correzioni di interazione!",es:"<b>Versi\xF3n 20.4 \u2728</b> Nueva notificaci\xF3n para seguidores, mejoras en la sincronizaci\xF3n de Gist y peque\xF1as correcciones de interacci\xF3n!","pt-BR":"<b>Vers\xE3o 20.4 \u2728</b> Nova notifica\xE7\xE3o de apoiadores, melhorias na sincroniza\xE7\xE3o do Gist e pequenas corre\xE7\xF5es de intera\xE7\xE3o!","pt-PT":"<b>Vers\xE3o 20.4 \u2728</b> Nova notifica\xE7\xE3o de apoiantes, melhorias na sincroniza\xE7\xE3o do Gist e pequenas corre\xE7\xF5es de intera\xE7\xE3o!",nl:"<b>Versie 20.4 \u2728</b> Nieuwe ondersteuners-notificatie, Gist-synchronisatie verbeteringen en kleine interactie-fixes!",da:"<b>Version 20.4 \u2728</b> Ny supporter-notifikation, Gist-synkroniseringsforbedringer og sm\xE5 interaktionsrettelser!",sv:"<b>Version 20.4 \u2728</b> Ny supporternotifikation, f\xF6rb\xE4ttringar av Gist-synkronisering och sm\xE5 interaktionskorrigeringar!",nb:"<b>Versjon 20.4 \u2728</b> Ny st\xF8ttespiller-varsling, Gist-synkroniseringsforbedringer og sm\xE5 interaksjonsforbedringer!",fi:"<b>Versio 20.4 \u2728</b> Uusi tukijoiden ilmoitus, Gist-synkronoinnin parannuksia ja pieni\xE4 vuorovaikutuskorjauksia!",pl:"<b>Wersja 20.4 \u2728</b> Nowe powiadomienie dla wspieraj\u0105cych, ulepszenia synchronizacji Gist i drobne poprawki interakcji!",cs:"<b>Verze 20.4 \u2728</b> Nov\xE9 ozn\xE1men\xED pro podporovatele, vylep\u0161en\xED synchronizace Gist a drobn\xE9 opravy interakc\xED!",hr:"<b>Verzija 20.4 \u2728</b> Nova obavijest za podr\u017Eavatelje, pobolj\u0161anja Gist sinkronizacije i male popravke interakcije!",sk:"<b>Verzia 20.4 \u2728</b> Nov\xE9 upozornenie pre podporovate\u013Eov, vylep\u0161enia synchroniz\xE1cie Gist a drobn\xE9 opravy interakci\xED!",hu:"<b>20.4 verzi\xF3 \u2728</b> \xDAj t\xE1mogat\xF3i \xE9rtes\xEDt\xE9s, Gist szinkroniz\xE1ci\xF3s fejleszt\xE9sek \xE9s apr\xF3 interakci\xF3s jav\xEDt\xE1sok!",ro:"<b>Versiunea 20.4 \u2728</b> Notificare nou\u0103 pentru sus\u021Bin\u0103tori, \xEEmbun\u0103t\u0103\u021Biri la sincronizarea Gist \u0219i mici corec\u021Bii de interac\u021Biune!",el:"<b>\u0388\u03BA\u03B4\u03BF\u03C3\u03B7 20.4 \u2728</b> \u039D\u03AD\u03B1 \u03B5\u03B9\u03B4\u03BF\u03C0\u03BF\u03AF\u03B7\u03C3\u03B7 \u03C5\u03C0\u03BF\u03C3\u03C4\u03B7\u03C1\u03B9\u03BA\u03C4\u03CE\u03BD, \u03B2\u03B5\u03BB\u03C4\u03B9\u03CE\u03C3\u03B5\u03B9\u03C2 \u03C3\u03C5\u03B3\u03C7\u03C1\u03BF\u03BD\u03B9\u03C3\u03BC\u03BF\u03CD Gist \u03BA\u03B1\u03B9 \u03BC\u03B9\u03BA\u03C1\u03AD\u03C2 \u03B4\u03B9\u03BF\u03C1\u03B8\u03CE\u03C3\u03B5\u03B9\u03C2 \u03B1\u03BB\u03BB\u03B7\u03BB\u03B5\u03C0\u03AF\u03B4\u03C1\u03B1\u03C3\u03B7\u03C2!",hy:"<b>\u054F\u0561\u0580\u0562\u0565\u0580\u0561\u056F 20.4 \u2728</b> \u0531\u057B\u0561\u056F\u056B\u0581\u0576\u0565\u0580\u056B \u0576\u0578\u0580 \u056E\u0561\u0576\u0578\u0582\u0581\u0578\u0582\u0574, Gist \u057D\u056B\u0576\u0584\u0580\u0578\u0576\u0561\u0581\u0574\u0561\u0576 \u0562\u0561\u0580\u0565\u056C\u0561\u057E\u0578\u0582\u0574\u0576\u0565\u0580 \u0587 \u0583\u0578\u0584\u0580 \u0583\u0578\u056D\u0561\u0566\u0564\u0565\u0581\u0578\u0582\u0569\u0575\u0561\u0576 \u0578\u0582\u0572\u0572\u0578\u0582\u0574\u0576\u0565\u0580!",sr:"<b>\u0412\u0435\u0440\u0437\u0438\u0458\u0430 20.4 \u2728</b> \u041D\u043E\u0432\u043E \u043E\u0431\u0430\u0432\u0435\u0448\u0442\u0435\u045A\u0435 \u0437\u0430 \u043F\u043E\u0434\u0440\u0436\u0430\u0432\u0430\u043E\u0446\u0435, \u043F\u043E\u0431\u043E\u0459\u0448\u0430\u045A\u0430 Gist \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u0458\u0435 \u0438 \u043C\u0430\u043B\u0435 \u0438\u0441\u043F\u0440\u0430\u0432\u043A\u0435 \u0438\u043D\u0442\u0435\u0440\u0430\u043A\u0446\u0438\u0458\u0435!","sr-YU":"<b>Verzija 20.4 \u2728</b> Novo obave\u0161tenje za podr\u017Eavaoce, pobolj\u0161anja Gist sinhronizacije i male ispravke interakcije!",uk:"<b>\u0412\u0435\u0440\u0441\u0456\u044F 20.4 \u2728</b> \u041D\u043E\u0432\u0435 \u0441\u043F\u043E\u0432\u0456\u0449\u0435\u043D\u043D\u044F \u0434\u043B\u044F \u043F\u0440\u0438\u0445\u0438\u043B\u044C\u043D\u0438\u043A\u0456\u0432, \u043F\u043E\u043A\u0440\u0430\u0449\u0435\u043D\u043D\u044F \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0456\u0437\u0430\u0446\u0456\u0457 Gist \u0442\u0430 \u0434\u0440\u0456\u0431\u043D\u0456 \u0432\u0438\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u043D\u044F \u0432\u0437\u0430\u0454\u043C\u043E\u0434\u0456\u0457!",ru:"<b>\u0412\u0435\u0440\u0441\u0438\u044F 20.4 \u2728</b> \u041D\u043E\u0432\u043E\u0435 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0435 \u0434\u043B\u044F \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0449\u0438\u0445, \u0443\u043B\u0443\u0447\u0448\u0435\u043D\u0438\u044F \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u0438 Gist \u0438 \u043C\u0435\u043B\u043A\u0438\u0435 \u0438\u0441\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u044F \u0432\u0437\u0430\u0438\u043C\u043E\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F!",tr:"<b>S\xFCr\xFCm 20.4 \u2728</b> Yeni destek\xE7i bildirimi, Gist senkronizasyon iyile\u015Ftirmeleri ve k\xFC\xE7\xFCk etkile\u015Fim d\xFCzeltmeleri!",ar:"<b>\u0627\u0644\u0625\u0635\u062F\u0627\u0631 20.4 \u2728</b> \u0625\u0634\u0639\u0627\u0631 \u062C\u062F\u064A\u062F \u0644\u0644\u062F\u0627\u0639\u0645\u064A\u0646\u060C \u062A\u062D\u0633\u064A\u0646\u0627\u062A \u0645\u0632\u0627\u0645\u0646\u0629 Gist \u0648\u0625\u0635\u0644\u0627\u062D\u0627\u062A \u0635\u063A\u064A\u0631\u0629 \u0644\u0644\u062A\u0641\u0627\u0639\u0644!",fa:"<b>\u0646\u0633\u062E\u0647 20.4 \u2728</b> \u0627\u0639\u0644\u0627\u0646 \u062C\u062F\u06CC\u062F \u0628\u0631\u0627\u06CC \u062D\u0627\u0645\u06CC\u0627\u0646\u060C \u0628\u0647\u0628\u0648\u062F \u0647\u0645\u06AF\u0627\u0645\u200C\u0633\u0627\u0632\u06CC Gist \u0648 \u0627\u0635\u0644\u0627\u062D\u0627\u062A \u06A9\u0648\u0686\u06A9 \u062A\u0639\u0627\u0645\u0644\u06CC!","zh-CN":"<b>\u7248\u672C 20.4 \u2728</b> \u65B0\u7684\u652F\u6301\u8005\u901A\u77E5\u3001Gist\u540C\u6B65\u6539\u8FDB\u548C\u5C0F\u4E92\u52A8\u4FEE\u590D\uFF01","zh-HK":"<b>\u7248\u672C 20.4 \u2728</b> \u65B0\u7684\u652F\u6301\u8005\u901A\u77E5\u3001Gist\u540C\u6B65\u6539\u9032\u548C\u5C0F\u4E92\u52D5\u4FEE\u5FA9\uFF01","zh-TW":"<b>\u7248\u672C 20.4 \u2728</b> \u65B0\u7684\u652F\u6301\u8005\u901A\u77E5\u3001Gist\u540C\u6B65\u6539\u9032\u548C\u5C0F\u4E92\u52D5\u4FEE\u5FA9\uFF01",ja:"<b>\u30D0\u30FC\u30B8\u30E7\u30F3 20.4 \u2728</b> \u65B0\u3057\u3044\u30B5\u30DD\u30FC\u30BF\u30FC\u901A\u77E5\u3001Gist\u540C\u671F\u306E\u6539\u5584\u3001\u304A\u3088\u3073\u5C0F\u3055\u306A\u5BFE\u8A71\u306E\u4FEE\u6B63\uFF01",id:"<b>Versi 20.4 \u2728</b> Notifikasi pendukung baru, peningkatan sinkronisasi Gist dan perbaikan interaksi kecil!",ca:"<b>Versi\xF3 20.4 \u2728</b> Nova notificaci\xF3 per a seguidors, millores en la sincronitzaci\xF3 de Gist i petites correccions d'interacci\xF3!",vi:"<b>Phi\xEAn b\u1EA3n 20.4 \u2728</b> Th\xF4ng b\xE1o ng\u01B0\u1EDDi \u1EE7ng h\u1ED9 m\u1EDBi, c\u1EA3i ti\u1EBFn \u0111\u1ED3ng b\u1ED9 h\xF3a Gist v\xE0 s\u1EEDa l\u1ED7i t\u01B0\u01A1ng t\xE1c nh\u1ECF!"},REVIEW_TEXT="Love using Bonjourr? Consider giving us a review or donating, that would help a lot! \u{1F607}",REVIEW_URLS={chrome:"https://chrome.google.com/webstore/detail/bonjourr-%C2%B7-minimalist-lig/dlnejlppicbjfcfcedcflplfjajinajd/reviews",opera:"https://chrome.google.com/webstore/detail/bonjourr-%C2%B7-minimalist-lig/dlnejlppicbjfcfcedcflplfjajinajd/reviews",firefox:"https://addons.mozilla.org/en-US/firefox/addon/bonjourr-startpage/",safari:"https://apps.apple.com/fr/app/bonjourr-startpage/id1615431236",edge:"https://microsoftedge.microsoft.com/addons/detail/bonjourr/dehmmlejmefjphdeoagelkpaoolicmid",other:"https://bonjourr.fr/help#%EF%B8%8F-reviews"};function interfacePopup(init2,event){if(event?.announcements){storage_default.sync.set({announcements:event?.announcements});return}if(!(!init2||init2?.announce==="off")){if(init2.old&&(init2.review===-1||init2.review>30)){let major=s=>parseInt(s.split(".")[0]),isMajorUpdate=major(init2.new)>major(init2.old),isNewVersion=init2.new!==init2.old&&init2.new===ANNOUNCEMENT_VERSION,announceMajor=init2.announce==="major"&&isMajorUpdate,announceAny=init2.announce==="all"&&isNewVersion;if(localStorage.hasUpdated==="true"||announceAny||announceMajor){localStorage.hasUpdated="true",displayPopup("announce");return}}init2.review!==-1&&(init2.review>30?displayPopup("review"):storage_default.sync.set({review:init2.review+1}))}}function displayPopup(type){let template=document.getElementById("popup-template"),doc=document.importNode(template.content,!0),popup=doc.getElementById("popup"),desc=doc.getElementById("popup_desc"),close=doc.getElementById("popup_close"),buttons=doc.getElementById("popup_buttons");if(popup){if(type==="review"&&(desc.textContent=tradThis(REVIEW_TEXT),buttons.appendChild(createPopupButton(REVIEW_URLS[BROWSER],tradThis("Review"))),buttons.appendChild(createPopupButton("https://ko-fi.com/bonjourr",tradThis("Donate")))),type==="announce"){let lang=getLang(),description=ANNOUNCEMENT_TRNS[lang]??ANNOUNCEMENT_TRNS.en,buttontext=tradThis("Read the release notes")+" \u{1F4DD}";desc.innerHTML=description,buttons.appendChild(createPopupButton(ANNOUNCEMENT_URL,buttontext))}close?.addEventListener("click",closePopup),document.body.appendChild(popup),popup.classList.add(type),openPopup()}}function createPopupButton(href,text){let anchor=document.createElement("a");return anchor.href=href,anchor.rel="noreferrer",anchor.textContent=text,anchor.addEventListener("pointerdown",removePopupTrigger),anchor}function removePopupTrigger(){storage_default.sync.set({review:-1}),localStorage.removeItem("hasUpdated")}function openPopup(){setTimeout(()=>document.getElementById("popup")?.classList.add("shown"),800),setTimeout(()=>document.getElementById("credit-container")?.setAttribute("style","opacity: 0"),400)}function closePopup(){setTimeout(()=>document.getElementById("popup")?.remove(),200),setTimeout(()=>document.getElementById("credit-container")?.removeAttribute("style"),600),document.getElementById("popup")?.classList.remove("shown"),removePopupTrigger()}var collectionForm=networkForm("f_collection"),bonjourrCollections={noon:"GD4aOSg4yQE",day:"o8uX55RbBPs",evening:"3M2rKTckZaQ",night:"bHDh4Ae7O8o"};function unsplashBackgrounds(init2,event){if(event&&updateUnsplash(event),init2)try{init2.unsplash.time===void 0?initUnsplashBackgrounds(init2.unsplash,init2.cache):cacheControl(init2.unsplash,init2.cache)}catch(e){errorMessage(e)}}async function updateUnsplash({refresh,every,collection}){let{unsplash}=await storage_default.sync.get("unsplash"),unsplashCache=await getCache();if(unsplash){if(refresh){if(sessionStorage.waitingForPreload){turnRefreshButton(refresh,!1);return}unsplash.time=0,storage_default.sync.set({unsplash}),turnRefreshButton(refresh,!0),setTimeout(()=>cacheControl(unsplash),400)}if(isEvery(every)){let currentImage=unsplashCache[unsplash.lastCollec][0];unsplash.pausedImage=every==="pause"?currentImage:void 0,unsplash.every=every,unsplash.time=freqControl.set(),storage_default.sync.set({unsplash})}if(collection===""&&(unsplashCache.user=[],unsplash.collection="",unsplash.lastCollec="day",unsplashBackgrounds({unsplash,cache:unsplashCache}),collectionForm.accept("i_collection",bonjourrCollections[unsplash.lastCollec])),collection!==void 0&&collection.length>0){let isFullURL=collection.includes("https://unsplash.com/")&&collection.includes("/collections/");if(!navigator.onLine)return collectionForm.warn(tradThis("No internet connection"));if(isFullURL){let start=collection.indexOf("/collections/")+13,end=collection.indexOf("/",start);collection=collection.slice(start,end)}unsplash.collection=collection.replaceAll(" ",""),unsplash.lastCollec="user",unsplash.time=freqControl.set(),collectionForm.load();let list=await requestNewList(unsplash.collection);if(!list||list.length===0){collectionForm.warn(`Cannot get "${collection}"`);return}unsplashCache.user=list,await preloadImage(unsplashCache.user[0].url),preloadImage(unsplashCache.user[1].url),loadBackground(unsplashCache.user[0]),collectionForm.accept("i_collection",collection)}storage_default.sync.set({unsplash}),storage_default.local.set({unsplashCache})}}async function cacheControl(unsplash,cache){unsplash={...SYNC_DEFAULT.unsplash,...unsplash},cache=cache??await getCache();let{lastCollec}=unsplash,{every,time,collection,pausedImage}=unsplash,needNewImage=freqControl.get(every,time??Date.now());!every.match(/day|pause/)&&periodOfDay()!==lastCollec&&lastCollec!=="user"&&(lastCollec=periodOfDay());let collectionId=lastCollec==="user"?collection:bonjourrCollections[lastCollec],list=cache[lastCollec];if(list.length===0){let newlist=await requestNewList(collectionId);if(!newlist)return;list=newlist,await preloadImage(list[0].url),cache[lastCollec]=list,storage_default.local.set({unsplashCache:cache}),sessionStorage.setItem("waitingForPreload","true")}if(sessionStorage.waitingForPreload==="true"){loadBackground(list[0]),await preloadImage(list[1].url);return}if(!needNewImage){loadBackground(every==="pause"&&pausedImage?pausedImage:list[0]);return}if(unsplash.lastCollec=lastCollec,unsplash.time=freqControl.set(),list.length>1&&list.shift(),loadBackground(list[0]),every==="pause"&&(unsplash.pausedImage=list[0]),list.length===1&&navigator.onLine){let newList=await requestNewList(collectionId);newList&&(cache[unsplash.lastCollec]=list.concat(newList),await preloadImage(newList[0].url))}else list.length>1&&await preloadImage(list[1].url);storage_default.sync.set({unsplash}),storage_default.local.set({unsplashCache:cache})}async function initUnsplashBackgrounds(unsplash,cache){let lastCollec=periodOfDay(),list=await requestNewList(bonjourrCollections[lastCollec]);if(!list)return;cache[lastCollec]=list,unsplash.lastCollec=lastCollec,unsplash.time=new Date().getTime(),preloadImage(list[0].url),await new Promise(sleep=>setTimeout(sleep,200));let lastCollecAgain=periodOfDay();lastCollec!==lastCollecAgain&&(list=await requestNewList(bonjourrCollections[lastCollecAgain])??[],unsplash.lastCollec=lastCollecAgain,cache[lastCollecAgain]=list),storage_default.sync.set({unsplash}),storage_default.local.set({unsplashCache:cache}),sessionStorage.setItem("waitingForPreload","true"),loadBackground(list[0]),await preloadImage(list[1].url)}async function requestNewList(collection){let json,resp=await apiFetch(`/unsplash/photos/random?collections=${collection}&count=8`);if(resp?.status===404||(json=await resp?.json(),json.length===1))return null;let filteredList=[],{width,height}=screen;(screen.orientation.type==="landscape-primary"&&height>width||screen.orientation.type==="portrait-primary"&&width>height)&&([width,height]=[height,width]);let dpr=window.devicePixelRatio,quality=Math.min(100-dpr*20,75),isExifEmpty=exif=>Object.values(exif).every(val=>!val);for(let img of json)filteredList.push({url:`${img.urls.raw}&w=${width}&h=${height}&dpr=${dpr}&auto=format&q=${quality}&fit=crop`,link:img.links.html,download_link:img.links.download,username:img.user.username,name:img.user.name,city:img.location.city,country:img.location.country,color:img.color,exif:isExifEmpty(img.exif)?void 0:img.exif});return filteredList}function imgCredits(image){let domcontainer2=document.getElementById("credit-container"),domcredit=document.getElementById("credit");if(!domcontainer2||!domcredit)return;let hasLocation=image.city||image.country,exif="",credits="";if(image.exif){let{iso,model,aperture,exposure_time,focal_length}=image.exif;model&&(exif+=`${model} - `),aperture&&(exif+=`f/${aperture} `),exposure_time&&(exif+=`${aperture}s `),iso&&(exif+=`${iso}ISO `),focal_length&&(exif+=`${focal_length}mm`)}if(hasLocation){let city=image.city||"",country=image.country||"";credits=`${city}${city&&country?", ":""}${country} <name>`}else credits=tradThis("Photo by <name>");let[location2,rest2]=credits.split(" <name>"),domlocation=document.createElement("a"),domspacer=document.createElement("span"),domrest=document.createElement("span"),domartist=document.createElement("a"),domexif=document.createElement("p");domexif.className="exif",domexif.textContent=exif,domlocation.textContent=location2,domartist.textContent=image.name.slice(0,1).toUpperCase()+image.name.slice(1),domspacer.textContent=hasLocation?" - ":" ",domrest.textContent=rest2,domlocation.href=`${image.link}?utm_source=Bonjourr&utm_medium=referral`,domartist.href=`https://unsplash.com/@${image.username}?utm_source=Bonjourr&utm_medium=referral`,domcredit.textContent="",domcredit.appendChild(domexif),domcredit.appendChild(domlocation),domcredit.appendChild(domspacer),domcredit.appendChild(domartist),domcredit.appendChild(domrest),image.download_link&&appendSaveLink(domcredit,image),domcontainer2.classList.toggle("shown",!0)}async function getCache(){return(await storage_default.local.get("unsplashCache"))?.unsplashCache??{...LOCAL_DEFAULT.unsplashCache}}function loadBackground(props){imgBackground(props.url,props.color),imgCredits(props)}async function preloadImage(src){let img=new Image;sessionStorage.setItem("waitingForPreload","true");try{img.src=src,await img.decode(),img.remove(),sessionStorage.removeItem("waitingForPreload")}catch{console.warn("Could not decode image: ",src)}}function appendSaveLink(domcredit,image){let domsave=document.createElement("a");domsave.className="save",domsave.title="Download the current background to your computer",domsave.onclick=()=>saveImage(domsave,image),domcredit.appendChild(domsave)}async function saveImage(domsave,image){domsave.classList.add("loading");try{let downloadUrl=new URL(image.download_link),apiDownloadUrl="/unsplash"+downloadUrl.pathname+downloadUrl.search,downloadResponse=await apiFetch(apiDownloadUrl);if(!downloadResponse)return;let data=await downloadResponse.json(),imageResponse=await fetch(data.url);if(!imageResponse.ok)return;let blob=await imageResponse.blob();domsave.onclick=null,domsave.href=URL.createObjectURL(blob),domsave.download=downloadUrl.pathname.split("/")[2],domsave.click()}finally{domsave.classList.remove("loading")}}function promisifyRequest(request){return new Promise((resolve2,reject)=>{request.oncomplete=request.onsuccess=()=>resolve2(request.result),request.onabort=request.onerror=()=>reject(request.error)})}function createStore(dbName,storeName){let request=indexedDB.open(dbName);request.onupgradeneeded=()=>request.result.createObjectStore(storeName);let dbp=promisifyRequest(request);return(txMode,callback)=>dbp.then(db=>callback(db.transaction(storeName,txMode).objectStore(storeName)))}var defaultGetStoreFunc;function defaultGetStore(){return defaultGetStoreFunc||(defaultGetStoreFunc=createStore("keyval-store","keyval")),defaultGetStoreFunc}function get(key,customStore=defaultGetStore()){return customStore("readonly",store=>promisifyRequest(store.get(key)))}function set(key,value,customStore=defaultGetStore()){return customStore("readwrite",store=>(store.put(value,key),promisifyRequest(store.transaction)))}function update(key,updater,customStore=defaultGetStore()){return customStore("readwrite",store=>new Promise((resolve2,reject)=>{store.get(key).onsuccess=function(){try{store.put(updater(this.result),key),resolve2(promisifyRequest(store.transaction))}catch(err){reject(err)}}}))}function del(key,customStore=defaultGetStore()){return customStore("readwrite",store=>(store.delete(key),promisifyRequest(store.transaction)))}var localImages=localImagesStorage(),localIsLoading=!1;async function localBackgrounds(event){if(event){updateLocalBackgrounds(event);return}try{initLocalBackgrounds()}catch(error){errorMessage(error)}}async function initLocalBackgrounds(){let{ids:ids2,selected,freq,last}=await localImages.get(),needNewImage=freqControl.get(freq,last)&&ids2.length>1;if(ids2.length===0){let data=await storage_default.sync.get("unsplash"),local=await storage_default.local.get("unsplashCache");unsplashBackgrounds({unsplash:data.unsplash,cache:local.unsplashCache});return}if(needNewImage){let idsNoSelection=ids2.filter(l=>!l.includes(selected)),randomId=Math.floor(Math.random()*idsNoSelection.length);selected=idsNoSelection[randomId],localImages.update({selected,last:freqControl.set()})}displayCustomBackground(await getBlob(selected,"background")),onSettingsLoad(()=>handleSettingsOptions())}async function handleSettingsOptions(){let loadedThumbIds=[...document.querySelectorAll(".thumbnail")].map(el=>el.id),i_freq=document.getElementById("i_freq"),images=await localImages.get(),ids2=images.ids;i_freq&&(i_freq.value=images.freq),ids2.length>9&&(ids2=ids2.slice(0,9),document.getElementById("thumbnail-show-buttons")?.classList.add("shown")),loadedThumbIds.length>0&&(ids2=ids2.filter(id=>loadedThumbIds.includes(id)===!1)),addThumbnailsToDom(ids2,images.selected)}async function updateLocalBackgrounds(event){event?.newfile&&addNewImage(event.newfile),event?.refresh&&refreshCustom(event.refresh),event?.showing&&updateThumbnailAmount(event.showing),isEvery(event?.freq)&&localImages.update({freq:event?.freq})}async function addNewImage(filelist){let thumbnailsContainer=document.getElementById("thumbnails-container"),{ids:ids2,selected}=await localImages.get(),blobs={},newIds=[];localIsLoading=!0,ids2.length===0&&storage_default.sync.set({background_type:"local"});for(let file of filelist){let id=randomString(8);newIds.push(id),selected=id;let thumbnail=await compressThumbnail(file);blobs[id]={thumbnail,background:file},thumbnailsContainer?.appendChild(createThumbnail(thumbnail,id,!1)),await set(id,blobs[id])}localImages.update({ids:ids2.concat(newIds),selected}),localIsLoading=!1,displayCustomBackground(blobs[selected].background),selectThumbnail(selected)}function refreshCustom(button){localImages.update({last:0}),turnRefreshButton(button,!0),setTimeout(()=>localBackgrounds(),100)}async function updateThumbnailAmount(showing){let thumbsAmount=document.getElementById("thumbnails-container")?.childElementCount||0,images=await localImages.get(),ids2=[];showing==="all"&&ids2.push(...images.ids),showing==="more"&&ids2.push(...images.ids.filter((_,i)=>i<thumbsAmount+9)),ids2.length===images.ids.length&&document.getElementById("thumbnail-show-buttons")?.classList.remove("shown"),addThumbnailsToDom(ids2,images.selected)}async function displayCustomBackground(blob){blob&&(imgBackground(URL.createObjectURL(blob)),document.getElementById("credit-container")?.classList.remove("shown"),localIsLoading=!1)}function selectThumbnail(id){document.querySelector(".thumbnail.selected")?.classList.remove("selected"),document.getElementById(id)?.classList?.add("selected")}async function getBlob(id,which){let blobs=await get(id);return blobs?blobs[which]:void 0}async function compressThumbnail(blob){let blobURL=window.URL.createObjectURL(blob),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),img=new Image;return img.src=blobURL,await new Promise(resolve2=>{img.onload=()=>{let height=140*window.devicePixelRatio,scaleFactor=height/img.height;canvas.width=img.width*scaleFactor,canvas.height=height,ctx?.drawImage(img,0,0,img.width*scaleFactor,height),resolve2(!0)}}),await new Promise(resolve2=>ctx?.canvas.toBlob(resolve2,"image/webp",80))}function createThumbnail(blob,id,isSelected){let thb=document.createElement("button"),rem=document.createElement("button"),thbimg=document.createElement("img"),remspan=document.createElement("span");if(!blob)return thb;thb.id=id,thbimg.src=URL.createObjectURL(blob),thb.className="thumbnail"+(isSelected?" selected":""),rem.classList.toggle("b_removethumb",!0),rem.classList.toggle("hidden",!IS_MOBILE),thb.setAttribute("aria-label","Select this background"),rem.setAttribute("aria-label","Remove this background"),thbimg.setAttribute("alt",""),thbimg.setAttribute("draggable","false"),remspan.textContent="\u2715",rem.appendChild(remspan),thb.appendChild(thbimg),thb.appendChild(rem),thbimg.addEventListener("click",applyThisBackground),rem.addEventListener("click",deleteThisBackground);async function applyThisBackground(e){if(e.button!==0||localIsLoading)return;let userImages=await localImages.get(),id2=this?.parentElement?.id;id2&&id2!==userImages.selected&&(localIsLoading=!1,localImages.update({selected:id2}),selectThumbnail(id2),displayCustomBackground(await getBlob(id2,"background")))}async function deleteThisBackground(e){if(e.button!==0||localIsLoading||!e.target)return;let{ids:ids2,selected}=await localImages.get(),thumbnail=this?.parentElement,id2=thumbnail?.id;if(id2&&(thumbnail?.classList.toggle("hiding",!0),setTimeout(()=>thumbnail?.remove(),100),ids2=ids2.filter(s=>!s.includes(id2)),localImages.update({ids:ids2}),del(id2)),id2===selected){if(ids2.length>0){selected=ids2[0],localImages.update({selected});let blob2=await getBlob(selected,"background");selectThumbnail(selected),displayCustomBackground(blob2);return}storage_default.sync.set({background_type:"unsplash"}),localImages.update({ids:[],selected:""}),setTimeout(async()=>{document.getElementById("credit-container")?.classList.toggle("shown",!0);let data=await storage_default.sync.get("unsplash"),local=await storage_default.local.get("unsplashCache");unsplashBackgrounds({unsplash:data.unsplash,cache:local.unsplashCache})},100)}}return thb}async function addThumbnailsToDom(ids2,selected){let thumbnailsContainer=document.getElementById("thumbnails-container"),fragment=document.createDocumentFragment(),idsToAdd=ids2.filter(id=>!document.getElementById(id));for(let id of idsToAdd){let isSelected=id===selected,blob=await getBlob(id,"thumbnail");fragment.appendChild(createThumbnail(blob,id,isSelected))}thumbnailsContainer.appendChild(fragment)}function localImagesStorage(){async function get2(){let res=await get("localImages");return{selected:res?.selected??"",freq:res?.freq??"pause",ids:res?.ids??[],last:res?.last??0}}function set2(val){set("localImages",val)}function update2(val){update("localImages",prev=>({...prev,...val}))}return{get:get2,set:set2,update:update2}}function initBackground(data,local){let type=data.background_type||"unsplash",blur=data.background_blur,brightness=data.background_bright;if(backgroundFilter({blur,brightness}),BROWSER==="safari"){let bgfirst=document.getElementById("background"),bgsecond=document.getElementById("background-bis");bgfirst.style.transform="scale(1.1) translateX(0px) translate3d(0, 0, 0)",bgsecond.style.transform="scale(1.1) translateX(0px) translate3d(0, 0, 0)"}type==="local"?localBackgrounds():unsplashBackgrounds({unsplash:data.unsplash,cache:local.unsplashCache})}function imgBackground(url,color){let img=new Image;color||(img.crossOrigin="Anonymous"),img.onload=()=>{let bgoverlay=document.getElementById("background_overlay"),bgfirst=document.getElementById("background"),bgsecond=document.getElementById("background-bis"),loadBis=bgfirst.style.opacity==="1",bgToChange=loadBis?bgsecond:bgfirst;bgfirst.style.opacity=loadBis?"0":"1",bgToChange.style.backgroundImage=`url(${url})`,bgoverlay.style.opacity="1",BROWSER==="safari"&&(color||(color=getAverageColor(img)),color&&(document.querySelector('meta[name="theme-color"]')?.setAttribute("content",color),setTimeout(()=>document.documentElement.style.setProperty("--average-color",color),400)))},img.src=url,img.remove()}function backgroundFilter({blur,brightness,isEvent}){let hasbright=typeof brightness=="number",hasblur=typeof blur=="number";hasblur&&document.documentElement.style.setProperty("--background-blur",blur.toString()+"px"),hasbright&&document.documentElement.style.setProperty("--background-brightness",brightness.toString()),hasblur&&document.body.classList.toggle("blurred",blur>16),isEvent&&hasblur&&eventDebounce({background_blur:blur}),isEvent&&hasbright&&eventDebounce({background_bright:brightness})}function updateBackgroundOption({freq,refresh}){let isLocal=document.getElementById("i_type").value==="local";freq!==void 0&&(isLocal?localBackgrounds({freq}):unsplashBackgrounds(void 0,{every:freq})),refresh&&(isLocal?localBackgrounds({refresh}):unsplashBackgrounds(void 0,{refresh}))}function getAverageColor(img){try{let canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),MAX_DIMENSION=100,scale=Math.min(MAX_DIMENSION/img.width,MAX_DIMENSION/img.height);canvas.width=img.width*scale,canvas.height=img.height*scale,ctx?.drawImage(img,0,0,canvas.width,canvas.height);let data=ctx?.getImageData(0,0,canvas.width,canvas.height)?.data,r=0,g=0,b=0,count=0;if(data)for(let i=0;i<data.length;i+=4)r+=data[i],g+=data[i+1],b+=data[i+2],count++;return r=Math.floor(r/count),g=Math.floor(g/count),b=Math.floor(b/count),console.log(rgbToHex(r,g,b)),rgbToHex(r,g,b)}catch(error){console.error("Error accessing image data:",error)}}async function setGistStatus(token,id){let wrapper=document.getElementById("gist-sync-status-wrapper"),base=document.getElementById("gist-sync-status-base");if(!token)return document.querySelector("#gist-sync-status")?.remove(),base.textContent=tradThis("Waiting for authentification"),!1;if(!id)return document.querySelector("#gist-sync-status")?.remove(),base.textContent=tradThis("No saved data yet"),!1;let resp=await fetch(`https://api.github.com/gists/${id}`,{headers:gistHeaders(token)});if(resp.status!==200)return document.querySelector("#gist-sync-status")?.remove(),base.textContent=tradThis("No saved data yet"),!1;let json=await resp.json(),isoDate=json.updated_at,dateString=new Date(isoDate).toLocaleString(getLang(),{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"});document.querySelector("#gist-sync-status")?.remove();let link=document.createElement("a");return link.id="gist-sync-status",link.href=json.html_url,link.textContent=dateString,wrapper?.appendChild(link),base.textContent=tradThis("Last update"),!0}async function retrieveGist(token,id){if(!token)throw new Error(GIST_ERROR.TOKEN);if(!id)throw new Error(GIST_ERROR.ID);let req=await fetch(`https://api.github.com/gists/${id}`,{headers:gistHeaders(token)});if(req.status===200){let gist=await req.json(),content=Object.values(gist?.files??{})[0]?.content??"";try{return JSON.parse(content)}catch{throw new Error(GIST_ERROR.JSON)}}throw new Error(GIST_ERROR.OTHER)}async function sendGist(token,id,data){let description="File automatically generated by Bonjourr. Learn more on https://bonjourr.fr/docs/overview/#sync",files={"bonjourr-export.json":{content:JSON.stringify(data,void 0,2)}};if(isStorageDefault(data))throw new Error(GIST_ERROR.DEFAULT);if(id===void 0){let resp2=await fetch("https://api.github.com/gists",{body:JSON.stringify({files,description,public:!1}),headers:gistHeaders(token),method:"POST"});if(resp2.status===401)throw new Error(GIST_ERROR.TOKEN);if(resp2.status>=300)throw new Error(GIST_ERROR.OTHER);return(await resp2.json()).id}if(isGistIdValid(id)===!1)throw new Error(GIST_ERROR.ID);let resp=await fetch(`https://api.github.com/gists/${id}`,{body:JSON.stringify({files,description}),headers:gistHeaders(token),method:"PATCH"});if(resp.status===404)throw new Error(GIST_ERROR.NOGIST);if(resp.status===401)throw new Error(GIST_ERROR.TOKEN);if(resp.status>=300)throw new Error(GIST_ERROR.OTHER);return id}async function findGistId(token){if(!token)throw new Error(GIST_ERROR.TOKEN);let resp=await fetch("https://api.github.com/gists?per_page=100",{headers:gistHeaders(token)});if(resp.status===401)throw new Error(GIST_ERROR.TOKEN);if(resp.status>=300)throw new Error(GIST_ERROR.OTHER);return(await resp.json()).filter(gist=>!gist.public&&gist.files["bonjourr-export.json"]?.size)[0]?.id}async function isGistTokenValid(token=""){if(!token)return!1;try{let ISODate=new Date()?.toISOString();return(await fetch(`https://api.github.com/gists?since=${ISODate}`,{headers:gistHeaders(token)})).status===200}catch{return!1}}function isGistIdValid(id){if(!id||id.length>32)return!1;for(let i=0;i<id.length;i++){let code=id[i].charCodeAt(0);if(!(code>=97&&code<=102||code>=48&&code<=57))return!1}return!0}function gistHeaders(token){return{Authorization:`Bearer ${token}`,Accept:"application/vnd.github+json","X-GitHub-Api-Version":"2022-11-28"}}var GIST_ERROR={ID:tradThis("Gist id in settings is invalid"),TOKEN:tradThis("Invalid token"),NOGIST:tradThis("Cannot find bonjourr file in gists"),NOCONN:tradThis("Cannot access Github servers right now"),JSON:tradThis("Response is not valid JSON"),OTHER:tradThis("Some Github Gist error happend"),DEFAULT:tradThis("Tried to send default config")};async function receiveFromURL(url=""){let resp;try{new URL(url)}catch{throw new Error(DISTANT_ERROR.URL)}try{resp=await fetch(url)}catch{try{resp=await fetch("https://services.bonjourr.fr/proxy",{method:"POST",body:url})}catch{throw new Error(DISTANT_ERROR.PROXY)}}try{return JSON.parse(await resp.text())}catch{throw new Error(DISTANT_ERROR.JSON)}}async function isDistantUrlValid(url=""){try{return await receiveFromURL(url),!0}catch{return!1}}var DISTANT_ERROR={URL:tradThis("Not a valid URL"),FAIL:tradThis("Cannot access resource right now"),PROXY:tradThis("Cannot access resource, even with proxy"),JSON:tradThis("Response is not valid JSON")};var gistsyncform=networkForm("f_gistsync"),urlsyncform=networkForm("f_urlsync");function synchronization(init2,update2){init2&&onSettingsLoad(()=>{toggleSyncSettingsOption(init2),setTimeout(()=>handleStoragePersistence(init2.syncType),200)}),update2&&updateSyncOption(update2)}async function updateSyncOption(update2){let local=await storage_default.local.get(["gistId","gistToken","distantUrl","syncType"]),data=await storage_default.sync.get();if(update2.down){if(local.syncType==="gist"){gistsyncform.load();try{let id=local.gistId??"",token=local.gistToken??"",update3=await retrieveGist(token,id);storage_default.sync.set(update3),fadeOut()}catch(err){gistsyncform.warn(err)}}if(local.syncType==="url"){urlsyncform.load();try{let update3=await receiveFromURL(local.distantUrl);storage_default.sync.set(update3),fadeOut()}catch(err){urlsyncform.warn(err)}}}if(update2.up&&local.syncType==="gist"){gistsyncform.load();try{let token=local.gistToken??"",id=await sendGist(token,local.gistId,data);gistsyncform.accept(),local.gistId=id,storage_default.local.set({gistId:id}),toggleSyncSettingsOption(local)}catch(error){gistsyncform.warn(error)}}if(update2.gistToken===""){local.gistToken="",local.gistId="",storage_default.local.remove("gistToken"),storage_default.local.remove("gistId"),gistsyncform.accept(),toggleSyncSettingsOption(local);return}if(update2.url===""){local.distantUrl="",storage_default.local.remove("distantUrl"),toggleSyncSettingsOption(local);return}if(update2.gistToken){gistsyncform.load();try{local.gistToken=update2.gistToken,local.gistId=await findGistId(local.gistToken),storage_default.local.set({gistId:local.gistId}),storage_default.local.set({gistToken:local.gistToken}),gistsyncform.accept(),toggleSyncSettingsOption(local)}catch(error){gistsyncform.warn(error)}}if(update2.url){urlsyncform.load();try{await receiveFromURL(update2.url),urlsyncform.accept("i_urlsync",update2.url),local.distantUrl=update2.url,storage_default.local.set({distantUrl:update2.url}),toggleSyncSettingsOption(local)}catch(error){urlsyncform.warn(error)}}isSyncType(update2.type)&&(local.syncType=update2.type,storage_default.local.set({syncType:local.syncType}),storage_default.type.change(update2.type==="browser"?"sync":"local",data),toggleSyncSettingsOption(local),handleStoragePersistence(update2.type)),update2.firefoxPersist&&(localStorage.choseStoragePersistence="true",toggleSyncSettingsOption(local))}async function handleStoragePersistence(type){if(!navigator?.storage?.persisted)return;let persisted=await navigator.storage.persisted();type==="off"&&(persisted||await navigator.storage.persist())}async function toggleSyncSettingsOption(local){let gistId=local?.gistId,gistToken=local?.gistToken,distantUrl=local?.distantUrl,type=local?.syncType,i_gistsync=document.querySelector("#i_gistsync"),i_urlsync=document.querySelector("#i_urlsync"),b_gistdown=document.querySelector("#b_gistdown"),b_gistup=document.querySelector("#b_gistup"),b_urldown=document.querySelector("#b_urldown");b_gistdown?.setAttribute("disabled",""),b_urldown?.setAttribute("disabled",""),b_gistup?.setAttribute("disabled",""),i_gistsync&&gistToken&&(i_gistsync.value=gistToken),i_urlsync&&distantUrl&&(i_urlsync.value=distantUrl);let choseStoragePersistence=localStorage.choseStoragePersistence==="true";switch(document.getElementById("disabled-sync")?.classList.toggle("shown",!choseStoragePersistence),type){case"off":case"browser":{document.getElementById("url-sync")?.classList.remove("shown"),document.getElementById("sync-freq")?.classList.remove("shown"),document.getElementById("gist-sync")?.classList.remove("shown");break}case"gist":{document.getElementById("gist-sync")?.classList.add("shown"),document.getElementById("url-sync")?.classList.remove("shown"),document.getElementById("disabled-sync")?.classList.remove("shown"),await isGistTokenValid(gistToken)&&(b_gistdown?.removeAttribute("disabled"),b_gistup?.removeAttribute("disabled")),setGistStatus(gistToken,gistId);break}case"url":{document.getElementById("url-sync")?.classList.add("shown"),document.getElementById("gist-sync")?.classList.remove("shown"),document.getElementById("disabled-sync")?.classList.remove("shown"),await isDistantUrlValid(distantUrl)&&b_urldown?.removeAttribute("disabled");break}}}function isSyncType(val=""){return["browser","gist","url","off"].includes(val)}var monthBackgrounds=["https://images.unsplash.com/photo-1457269449834-928af64c684d?q=80&w=700&auto=format&fit=crop","https://images.unsplash.com/photo-1613136391099-c2757009bb12?q=80&w=700&auto=format&fit=crop","https://images.unsplash.com/photo-1457670912047-6ad4485d43eb?q=80&w=700&auto=format&fit=crop","https://images.unsplash.com/photo-1528834342297-fdefb9a5a92b?q=80&w=700&auto=format&fit=crop","https://images.unsplash.com/photo-1486608766848-9b9fe0c37b9d?q=80&w=700&auto=format&fit=crop","https://images.unsplash.com/photo-1551516114-063f4cef7213?q=80&w=700&auto=format&fit=crop","https://images.unsplash.com/photo-1577353716826-9151912dcdd1?q=80&w=700&auto=format&fit=crop","https://images.unsplash.com/photo-1600699260196-aca47e6d2125?q=80&w=700&auto=format&fit=crop","https://images.unsplash.com/photo-1508255139162-e1f7b7288ab7?q=80&w=700&auto=format&fit=crop","https://images.unsplash.com/photo-1507834392452-0559ec185662?q=80&w=700&auto=format&fit=crop","https://images.unsplash.com/photo-1505567745926-ba89000d255a?q=80&w=700&auto=format&fit=crop","https://images.unsplash.com/photo-1513267257196-91be473829b3?q=80&w=700&auto=format&fit=crop"],supportersNotif,supportersModal;function supportersNotifications(init2,update2){if(update2?.translate){translateNotif();return}if(update2){updateSupportersOption(update2);return}if(!init2?.supporters?.enabled)return;let closed=init2?.supporters.closed,month=init2?.supporters.month,hasClosedReview=init2.review===-1,currentMonth=new Date().getMonth()+1;if(!hasClosedReview&&!closed){updateSupportersOption({closed:!0});return}if(currentMonth===month&&closed)return;let template=document.getElementById("supporters-notif-template"),doc=document.importNode(template.content,!0);supportersNotif=doc.getElementById("supporters-notif-container"),updateSupportersOption({closed:!1,month:currentMonth}),supportersNotif.classList.add("shown"),document.documentElement.dataset.supporters="",onSettingsLoad(()=>{let notifClose=doc.getElementById("supporters-notif-close"),settingsNotifs=document.getElementById("settings-notifications"),image=monthBackgrounds[currentMonth-1];supportersNotif.style.setProperty("--background",`url(${image})`),settingsNotifs?.insertAdjacentElement("beforebegin",supportersNotif),initSupportersModal(),translateNotif(),supportersNotif?.onclickdown(function(e){e.target instanceof Element&&!e.target.closest("#supporters-notif-close")&&(toggleSupportersModal(!0),loadModalData())}),notifClose?.onclickdown(function(){delete document.documentElement.dataset.supporters,supportersNotif.classList.remove("shown"),updateSupportersOption({closed:!0})})})}async function updateSupportersOption(update2){let newSupporters={...(await storage_default.sync.get()).supporters};update2.enabled!==void 0&&(newSupporters.enabled=update2.enabled),update2.closed!==void 0&&(newSupporters.closed=update2.closed),update2.month!==void 0&&(newSupporters.month=update2.month),storage_default.sync.set({supporters:newSupporters})}function translateNotif(){let currentMonthLocale=new Date().toLocaleDateString(getLang(),{month:"long"}),introString="This <currentMonth>, Bonjourr is brought to you by our lovely supporters.",notifTitle=document?.getElementById("supporters-notif-title"),notifButton=document.getElementById("supporters-notif-button");notifTitle&&notifButton&&(notifTitle.textContent=tradThis(introString).replace("<currentMonth>",currentMonthLocale),notifButton.textContent=tradThis("Find out who they are"))}function initSupportersModal(){let template=document.getElementById("supporters-modal-template"),doc=document.importNode(template.content,!0);supportersModal=doc.getElementById("supporters-modal-container"),onSettingsLoad(()=>{tradTemplateString(doc,"#title","Supporters like you make Bonjourr possible"),tradTemplateString(doc,"#desc","Here are the wonderful people who supported us last month. Thanks to them, we can keep Bonjourr free, open source, and constantly evolving."),tradTemplateString(doc,"#monthly #title","Our monthly supporters"),tradTemplateString(doc,"#once #title","Our one-time supporters"),tradTemplateString(doc,"#phrase","Join the community and get your name in Bonjourr."),tradTemplateString(doc,"#donate-button-text","Donate");let close=doc.getElementById("supporters-modal-close");document.querySelector("#interface")?.insertAdjacentElement("beforebegin",supportersModal),close.addEventListener("click",function(){toggleSupportersModal(!1)}),supportersModal.addEventListener("click",function(event){event.target?.id==="supporters-modal-container"&&toggleSupportersModal(!1)}),document.addEventListener("keyup",event=>{event.key==="Escape"&&document.documentElement.dataset.supportersModal!==void 0&&toggleSupportersModal(!1)})})}function toggleSupportersModal(toggle){document.dispatchEvent(new Event("toggle-settings")),toggle&&(document.documentElement.dataset.supportersModal=""),toggle||delete document.documentElement.dataset.supportersModal}var modalDataLoaded=!1;async function loadModalData(){if(modalDataLoaded)return;document.body.className.includes("potato")||initGlitter();let currentMonth=new Date().getMonth()+1,currentYear=new Date().getFullYear(),monthToGet,yearToGet=currentYear;currentMonth===1?(monthToGet=12,yearToGet=yearToGet-1):monthToGet=currentMonth-1;function injectError(string2){let main=document.querySelector("#supporters-modal main");main&&(main.innerHTML=`<i>${string2}</i>`)}function injectData(supporters=[]){supporters.sort((a,b)=>b.amount-a.amount);let monthlyFragment=document.createDocumentFragment(),onceFragment=document.createDocumentFragment();supporters.forEach(supporter=>{let li=document.createElement("li");li.innerHTML=supporter.name,(supporter.monthly?monthlyFragment:onceFragment).appendChild(li)}),document.querySelector("#supporters-modal #monthly #list")?.appendChild(monthlyFragment),document.querySelector("#supporters-modal #once #list")?.appendChild(onceFragment),console.info(`Loaded supporters data from ${monthToGet}/${yearToGet}.`)}try{let response,supporters=[];response=await fetch(`https://kofi.bonjourr.fr/list?date=${yearToGet}-${monthToGet}`),response.ok?supporters=await response.json():console.error(`HTTP error when fetching supporters list! status: ${response.status}`),document.querySelector("#supporters-modal")?.classList.add("loaded"),supporters.length!==0?injectData(supporters):(console.error(`No supporters data found for ${monthToGet}/${yearToGet}`),injectError("An error occured or there were no supporters last month."))}catch(error){console.error("An error occurred:",error),injectError("An Internet connection is required to see the supporters names.")}modalDataLoaded=!0}function tradTemplateString(doc,selector,text){let toTranslate=doc.querySelector(selector);toTranslate?toTranslate.innerText=tradThis(text):console.error(`Error when trying to translate "${selector}"`)}function initGlitter(){let snowfall={};snowfall.canvas=document.getElementById("glitter"),snowfall.context=snowfall.canvas.getContext("2d"),snowfall.snowflake=class{size;x;baseX;distance;opacity;radians;fallSpeed;y;constructor(){this.size=Math.random()*1.5+1.5,this.x=Math.random()*snowfall.canvas.width-this.size-1+this.size+1,this.baseX=this.x,this.distance=Math.random()*50+1,this.opacity=Math.random(),this.radians=Math.random()*Math.PI*2,this.fallSpeed=Math.random()*1.5+.5,this.y=Math.random()*snowfall.canvas.height-this.size-1+this.size+1}draw=()=>{this.y>snowfall.canvas.height+this.size?this.y=-this.size:this.y+=this.fallSpeed,this.radians+=.02,this.x=this.baseX+this.distance*Math.sin(this.radians),snowfall.context.beginPath(),snowfall.context.arc(this.x,this.y,this.size,0,Math.PI*2),snowfall.context.shadowBlur=8,snowfall.context.shadowColor=`rgba(255, 202, 56, ${this.opacity})`,snowfall.context.fillStyle=`rgba(255, 202, 56, ${this.opacity})`,snowfall.context.fill(),snowfall.context.closePath(),snowfall.context.shadowBlur=0,snowfall.context.shadowColor="transparent"}},snowfall.setup=()=>{snowfall.canvas.width=snowfall.context.canvas.clientWidth,snowfall.canvas.height=snowfall.context.canvas.clientHeight,snowfall.flakes=[];for(let x=0;x<Math.ceil(snowfall.canvas.width*snowfall.canvas.height/2e4);x++)snowfall.flakes.push(new snowfall.snowflake)};let snowfallDebounce=debounce(snowfall.setup,200);window.addEventListener("resize",snowfallDebounce),snowfall.animate=()=>{requestAnimationFrame(snowfall.animate),snowfall.context.clearRect(0,0,snowfall.canvas.width,snowfall.canvas.height);for(let snowflake of snowfall.flakes)snowflake.draw()},snowfall.setup(),snowfall.animate()}function favicon(val,isEvent){function createFavicon(emoji){let svg=`data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="85">${emoji}</text></svg>`,defaulticon="/src/assets/"+(BROWSER==="edge"?"monochrome.png":"favicon.ico"),domfavicon=document.getElementById("favicon");domfavicon.href=emoji?svg:defaulticon}if(isEvent){let isEmojiOrShape=val?.match(/[\p{Emoji}\u25A0-\u25FF]/gu)&&!val?.match(/[0-9a-z]/g);eventDebounce({favicon:isEmojiOrShape?val:""}),document.getElementById("head-favicon")?.remove()}BROWSER==="firefox"?setTimeout(()=>createFavicon(val),0):createFavicon(val)}function tabTitle(val="",isEvent){document.title=stringMaxSize(val,80)||tradThis("New tab"),isEvent&&eventDebounce({tabtitle:stringMaxSize(val,80)})}function pageControl(val,isEvent){val.width&&(document.documentElement.style.setProperty("--page-width",(val.width??SYNC_DEFAULT.pagewidth)+"px"),isEvent&&eventDebounce({pagewidth:val.width})),typeof val.gap=="number"&&(document.documentElement.style.setProperty("--page-gap",(val.gap??SYNC_DEFAULT.pagegap)+"em"),isEvent&&eventDebounce({pagegap:val.gap}))}function darkmode(value,isEvent){let settings=document.querySelector("aside"),theme="light";switch(value){case"disable":theme="light";break;case"enable":theme="dark";break;case"system":theme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";break;case"auto":{let now=minutator(new Date),{sunrise:sunrise2,sunset:sunset2}=suntime();theme=now<=sunrise2||now>sunset2?"dark":"light";break}}if(document.documentElement.dataset.theme=theme,isEvent){storage_default.sync.set({dark:value}),settings?.classList.add("change-theme"),setTimeout(()=>settings?.classList.remove("change-theme"),333);return}window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",event=>{document.documentElement.dataset.theme=event.matches?"dark":"light"})}function textShadow(init2,event){let val=init2??event;document.documentElement.style.setProperty("--text-shadow-alpha",(val??.2)?.toString()),typeof event=="number"&&eventDebounce({textShadow:val})}var JSON_PROTO=Object.getPrototypeOf({});function fastifyDeepMerge(options){function isNotPrototypeKey(value){return value!=="constructor"&&value!=="prototype"&&value!=="__proto__"}function cloneArray(value){let i=0,il=value.length,result=new Array(il);for(i=0;i<il;++i)result[i]=clone(value[i]);return result}function cloneObject(target){let result={};if(cloneProtoObject&&Object.getPrototypeOf(target)!==JSON_PROTO)return cloneProtoObject(target);let targetKeys=getKeys(target),i,il,key;for(i=0,il=targetKeys.length;i<il;++i)isNotPrototypeKey(key=targetKeys[i])&&(result[key]=clone(target[key]));return result}function concatArrays(target,source){let tl=target.length,sl=source.length,i=0,result=new Array(tl+sl);for(i=0;i<tl;++i)result[i]=clone(target[i]);for(i=0;i<sl;++i)result[i+tl]=clone(source[i]);return result}let propertyIsEnumerable=Object.prototype.propertyIsEnumerable;function getSymbolsAndKeys(value){let result=Object.keys(value),keys=Object.getOwnPropertySymbols(value);for(let i=0,il=keys.length;i<il;++i)propertyIsEnumerable.call(value,keys[i])&&result.push(keys[i]);return result}let getKeys=options&&options.symbols?getSymbolsAndKeys:Object.keys,cloneProtoObject=typeof options?.cloneProtoObject=="function"?options.cloneProtoObject:void 0;function isMergeableObject(value){return typeof value=="object"&&value!==null&&!(value instanceof RegExp)&&!(value instanceof Date)}function isPrimitive(value){return typeof value!="object"||value===null}let isPrimitiveOrBuiltIn=typeof Buffer<"u"?value=>typeof value!="object"||value===null||value instanceof RegExp||value instanceof Date||value instanceof Buffer:value=>typeof value!="object"||value===null||value instanceof RegExp||value instanceof Date,mergeArray=options&&typeof options.mergeArray=="function"?options.mergeArray({clone,deepmerge:_deepmerge,getKeys,isMergeableObject}):concatArrays;function clone(entry){return isMergeableObject(entry)?Array.isArray(entry)?cloneArray(entry):cloneObject(entry):entry}function mergeObject(target,source){let result={},targetKeys=getKeys(target),sourceKeys=getKeys(source),i,il,key;for(i=0,il=targetKeys.length;i<il;++i)isNotPrototypeKey(key=targetKeys[i])&&sourceKeys.indexOf(key)===-1&&(result[key]=clone(target[key]));for(i=0,il=sourceKeys.length;i<il;++i)isNotPrototypeKey(key=sourceKeys[i])&&(key in target&&(targetKeys.indexOf(key)!==-1&&(result[key]=_deepmerge(target[key],source[key])),!0)||(result[key]=clone(source[key])));return result}function _deepmerge(target,source){let sourceIsArray=Array.isArray(source),targetIsArray=Array.isArray(target);return isPrimitive(source)?source:isPrimitiveOrBuiltIn(target)?clone(source):sourceIsArray&&targetIsArray?mergeArray(target,source):sourceIsArray!==targetIsArray?clone(source):mergeObject(target,source)}function _deepmergeAll(){switch(arguments.length){case 0:return{};case 1:return clone(arguments[0]);case 2:return _deepmerge(arguments[0],arguments[1])}let result;for(let i=0,il=arguments.length;i<il;++i)result=_deepmerge(result,arguments[i]);return result}return options&&options.all?_deepmergeAll:_deepmerge}var deepmerge=fastifyDeepMerge({symbols:!1}),deepmergeAll=fastifyDeepMerge({all:!0,symbols:!1});function filterImports(current,target){return target=booleanSearchbarToObject(target),target=linkListToFlatObjects(target),target=hideArrayToObject(target),target=dynamicToUnsplash(target),target=improvedWeather(target),target=newFontSystem(target),target=newReviewData(target),target=quotesJsonToCSV(target),target=linksDataMigration(target),target=addSupporters(target),current=deepmergeAll(current,target,{about:structuredClone(SYNC_DEFAULT.about)}),current=analogClockOptions(current),current=convertOldCSSSelectors(current),current=toISOLanguageCode(current),current=removeWorldClocksDuplicate(current,target),current=validateLinkGroups(current),current=toggleMoveWidgets(current,target),delete current.settingssync,delete current.custom_every,delete current.custom_time,delete current.searchbar_newtab,delete current.searchbar_newtab,delete current.searchbar_engine,delete current.cssHeight,delete current.linktabs,delete current.links,delete current.dynamic,current}function addSupporters(data){return data.supporters===void 0&&(data.supporters={enabled:!0,closed:!1,month:-1}),data}function hideArrayToObject(data){return Array.isArray(data.hide)&&(data.hide[0][0]&&(data.hide.clock=!0),data.hide[0][1]&&(data.hide.date=!0),data.hide[1][0]&&(data.hide.greetings=!0),data.hide[1][1]&&(data.hide.weatherdesc=!0),data.hide[1][2]&&(data.hide.weathericon=!0),data.hide[3][0]&&(data.hide.settingsicon=!0),data.time=!(data.hide.clock&&data.hide.date),data.main=!(data.hide.weatherdesc&&data.hide.weathericon&&data.hide.weathericon)),data}function booleanSearchbarToObject(data){return typeof data.searchbar=="boolean"&&(data.searchbar={...SYNC_DEFAULT.searchbar,on:data.searchbar,newtab:data.searchbar_newtab||!1,engine:data.searchbar_engine?.replace("s_","")||"google",suggestions:!1}),data}function linkListToFlatObjects(data){return Array.isArray(data.links)&&(data.links.length>0&&data.quicklinks===void 0&&(data.quicklinks=!0),data.links?.forEach(({title,url,icon},i)=>{let id="links"+randomString(6),filteredIcon=icon?.startsWith("alias:")?data[icon]:icon;data[id]={_id:id,order:i,title,url,icon:filteredIcon}}),Object.keys(data).filter(key=>key.match("alias:")).forEach(key=>delete data[key])),data}function newFontSystem(data){return data.font&&(data.font.weightlist=data.font?.availWeights??[],delete data.font.url,delete data.font.availWeights,data.font.system===void 0&&(data.font.system=!1)),data}function newReviewData(data){return data.reviewPopup&&(data.review=data.reviewPopup==="removed"?-1:+data.reviewPopup),data}function quotesJsonToCSV(data){return Array.isArray(data?.quotes?.userlist)&&(data.quotes.userlist=oldJSONToCSV(data.quotes.userlist)),data}function toISOLanguageCode(data){return data.lang=countryCodeToLanguageCode(data.lang??"en"),data}function removeWorldClocksDuplicate(current,target){return target.worldclocks&&current.worldclocks&&(current.worldclocks=target.worldclocks),current}function validateLinkGroups(current){let links=bundleLinks(current),parents=[...new Set(links.map(link=>link.parent))],parentGroups=parents.filter(p=>!p?.toString().startsWith("links")),oldNumberParents=parents.filter(parent=>typeof parent=="number");if(current.linktabs&&oldNumberParents.length>0){current.linkgroups={on:current.linktabs.active,selected:current.linktabs.titles[current.linktabs.selected],groups:[...current.linktabs.titles],synced:[],pinned:[]};for(let link of links)typeof link?.parent=="number"&&(link.parent=current.linkgroups.groups[link.parent]),current[link._id]=link}let{groups:groups2,pinned,synced,selected}=current.linkgroups;current.linkgroups.selected=selected||"default",current.linkgroups.groups=groups2.map(val=>val||"default"),current.linkgroups.pinned=pinned.map(val=>val||"default"),current.linkgroups.synced=synced.map(val=>val||"default");for(let link of links)link?.parent||(link.parent="default",current[link._id]=link);links=bundleLinks(current),parents=[...new Set(links.map(link=>link.parent))],parentGroups=parents.filter(p=>!p?.toString().startsWith("links"));for(let group of parentGroups)group&&current.linkgroups.groups.push(group.toString());current.linkgroups.groups=[...new Set(current.linkgroups.groups)],current.linkgroups.pinned=[...new Set(current.linkgroups.pinned)],current.linkgroups.synced=[...new Set(current.linkgroups.synced)],current.linkgroups.groups.length>1&&(current.linkgroups.on=!0);let parentNoDefault=current.linkgroups.groups.filter(group=>group!=="default"),defaultExists=current.linkgroups.groups.includes("default"),defaultIsEmpty=parentGroups.includes("default")===!1,hasUserGroups=parentNoDefault.length>0,hasLinks=links.length>0;return defaultExists&&defaultIsEmpty&&hasUserGroups&&hasLinks&&(current.linkgroups.groups=parentNoDefault,current.linkgroups.selected=parentNoDefault[0]),current}function linksDataMigration(data){if(data?.linktabs||data?.linkgroups)return data;let notfoundicon="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI2MiIgdmlld0JveD0iMC";return bundleLinks(data).sort((a,b)=>(a.order??0)-(b.order??0)).forEach(link=>{link.icon?.startsWith(notfoundicon)&&(link.icon=API_DOMAIN+"/favicon/blob/",data[link._id]=link)}),data}function dynamicToUnsplash(data){return data.background_type==="dynamic"&&(data.background_type="unsplash"),data.background_type==="custom"&&(data.background_type="local"),data.dynamic&&(data.unsplash={...data.dynamic,pausedImage:void 0}),data}function improvedWeather(data){if(data.weather&&data.weather?.geolocation===void 0){let oldLocation=data.weather?.location??[];data.weather.geolocation="approximate",data.weather.geolocation=oldLocation.length===0?"off":"precise",delete data.weather.location,delete data.weather.lastState,delete data.weather.lastCall,delete data.weather.location}return data}function analogClockOptions(data){return data.clock?.style&&(data.analogstyle={background:"#fff2",border:"#ffff",face:data?.clock?.face||"none",shape:"round",hands:"modern"},(data.clock.style==="round"||data.clock.style==="square")&&(data.analogstyle.shape=data.clock.style),data.clock.style==="transparent"&&(data.analogstyle.background="#fff0",data.analogstyle.border="#fff0")),data}function toggleMoveWidgets(current,imported){if(imported.move){current.move=imported.move;let area=(current.move.layouts[current.move.selection]?.grid??defaultLayouts[current.move.selection].grid).flat().join(" ");return current.time=area.includes("time"),current.main=area.includes("main"),current.quicklinks=area.includes("quicklinks"),current.notes&&(current.notes.on=area.includes("notes")),current.quotes&&(current.quotes.on=area.includes("quotes")),current.searchbar&&(current.searchbar.on=area.includes("searchbar")),current}if(!imported.move){let importStates={time:imported.time??current.time,main:imported.main??current.main,notes:imported.notes?.on??(current.notes?.on||!1),quotes:imported.quotes?.on??current.quotes?.on,searchbar:imported.searchbar?.on??current.searchbar?.on,quicklinks:imported.quicklinks??current.quicklinks},diffWidgets={time:current.time!==importStates.time,main:current.main!==importStates.main,notes:current.notes?.on!==importStates.notes,quotes:current.quotes?.on!==importStates.quotes,searchbar:current.searchbar?.on!==importStates.searchbar,quicklinks:current.quicklinks!==importStates.quicklinks};Object.keys(imported).some(key=>key.match(/time|main|notes|quotes|searchbar|quicklinks/g))&&(current.move.selection="single");let selection=current.move.selection,layout=structuredClone(current.move.layouts[selection]),diffEntries=Object.entries(diffWidgets).filter(([_,diff])=>diff===!0);if(!layout)return current;diffEntries.forEach(([key,_])=>{let id=key,gridToggle=importStates[id]?addGridWidget:removeGridWidget;layout.grid=gridParse(gridToggle(gridStringify(layout.grid),id,selection))}),current.move.layouts[selection]=layout}return current}function convertOldCSSSelectors(data){return data?.css&&(data.css=data.css.replaceAll(".block",".link").replaceAll("#clock","#digital").replaceAll("#analogClock","#analog").replaceAll("#center","#analog-center").replaceAll("#hours","#analog-hours").replaceAll("#minutes","#analog-minutes").replaceAll("#analogSeconds","#analog-seconds").replaceAll("#creditContainer","#credit-container")),data}function orderedStringify(data){let orderedKeys=[...Object.keys(SYNC_DEFAULT)],keylist=new Set;JSON.stringify(data,(key,value)=>(keylist.add(key),value));let links=bundleLinks(data);links.length>0&&links.forEach(link=>orderedKeys.splice(orderedKeys.indexOf("linksrow")+1,0,link._id));let sortOrder=(a,b)=>orderedKeys.indexOf(a)-orderedKeys.indexOf(b);return JSON.stringify(data,Array.from(keylist).sort(sortOrder),2)}async function settingsPreload(){let domshowsettings=document.getElementById("show-settings"),outerHtml=`<aside id="settings" class="init">${await(await fetch("settings.html")).text()}</aside>`,template=document.querySelector("#settings-template");if(template&&(template.innerHTML=outerHtml),window.matchMedia("(pointer: coarse)").matches&&!window.matchMedia("(pointer: fine)").matches){settingsInit();return}domshowsettings?.addEventListener("mouseenter",triggerSettingsInit),domshowsettings?.addEventListener("pointerdown",triggerSettingsInit),document.body.addEventListener("keydown",triggerSettingsInit);function triggerSettingsInit(event){let keyboard=event?.code==="Escape",pointer=event?.type.includes("key")===!1;(keyboard||pointer)&&(domshowsettings?.removeEventListener("mouseenter",triggerSettingsInit),domshowsettings?.removeEventListener("pointerdown",triggerSettingsInit),document.body.removeEventListener("keydown",triggerSettingsInit),settingsInit())}}async function settingsInit(){if(document.getElementById("settings"))return;let sync=await storage_default.sync.get(),local=await storage_default.local.get(),settingsDom=getHTMLTemplate("settings-template","#settings");document.body.appendChild(settingsDom),translateAriaLabels(),translatePlaceholders(),traduction(settingsDom,sync.lang),showall(sync.showall,!1),initOptionsValues(sync,local),initOptionsEvents(),updateSettingsJSON(sync),updateSettingsEvent(),settingsDrawerBar(),settingsFooter(),loadCallbacks(),document.dispatchEvent(new Event("settings")),document.addEventListener("toggle-settings",settingsToggle)}function settingsToggle(){let domsettings=document.getElementById("settings"),domshowsettings=document.getElementById("show-settings"),dominterface4=document.getElementById("interface"),domedit=document.getElementById("editlink"),isClosed=domsettings?.classList.contains("shown")===!1;domsettings?.classList.toggle("init",!1),domsettings?.classList.toggle("shown",isClosed),domedit?.classList.toggle("pushed",isClosed),dominterface4?.classList.toggle("pushed",isClosed),domshowsettings?.classList.toggle("shown",isClosed),domsettings?.style.removeProperty("transform"),domsettings?.style.removeProperty("transition"),document.dispatchEvent(new Event("close-edit"))}function initOptionsValues(data,local){let domsettings=document.getElementById("settings"),userQuotes=data.quotes?.userlist?.[0]?data.quotes?.userlist:void 0,unsplashCollec=data?.unsplash?.lastCollec==="user"?"day":data?.unsplash?.lastCollec;setInput("i_blur",data.background_blur??15),setInput("i_bright",data.background_bright??.8),setInput("i_row",data.linksrow||8),setInput("i_linkstyle",data.linkstyle||"default"),setInput("i_type",data.background_type||"unsplash"),setInput("i_freq",data.unsplash?.every),setInput("i_dark",data.dark||"system"),setInput("i_favicon",data.favicon??""),setInput("i_tabtitle",data.tabtitle??""),setInput("i_pagewidth",data.pagewidth||1600),setInput("i_pagegap",data.pagegap??1),setInput("i_dateformat",data.dateformat||"eu"),setInput("i_greeting",data.greeting??""),setInput("i_textshadow",data.textShadow??.2),setInput("i_noteswidth",data.notes?.width||50),setInput("i_notes-opacity",opacityFromHex(data.notes?.background??"#fff2")),setInput("i_notesalign",data.notes?.align||"left"),setInput("i_sbengine",data.searchbar?.engine||"google"),setInput("i_sbplaceholder",data.searchbar?.placeholder||""),setInput("i_sb-opacity",opacityFromHex(data.searchbar?.background??"#fff2")),setInput("i_sbwidth",data.searchbar?.width??30),setInput("i_sbrequest",data.searchbar?.request||""),setInput("i_qtfreq",data.quotes?.frequency||"day"),setInput("i_qttype",data.quotes?.type||"classic"),setInput("i_qtlist",userQuotes??""),setInput("i_qturl",data.quotes?.url??""),setInput("i_clockface",data.analogstyle?.face||"none"),setInput("i_clockhands",data.analogstyle?.hands||"none"),setInput("i_clockshape",data.analogstyle?.shape||"round"),setInput("i_analog-border-opacity",opacityFromHex(data.analogstyle?.border??"#ffff")),setInput("i_analog-background-opacity",opacityFromHex(data.analogstyle?.background??"#fff2")),setInput("i_clocksize",data.clock?.size??5),setInput("i_timezone",data.clock?.timezone||"auto"),setInput("i_geol",data.weather?.geolocation||"approximate"),setInput("i_units",data.weather?.unit??"metric"),setInput("i_forecast",data.weather?.forecast||"auto"),setInput("i_temp",data.weather?.temperature||"actual"),setInput("i_moreinfo",data.weather?.moreinfo||"none"),setInput("i_provider",data.weather?.provider??""),setInput("i_weight",data.font?.weight||"300"),setInput("i_size",data.font?.size||(IS_MOBILE?11:14)),setInput("i_announce",data.announcements??"major"),setInput("i_synctype",local.syncType??(PLATFORM==="online"?"off":"browser")),setFormInput("i_collection",bonjourrCollections[unsplashCollec],data.unsplash?.collection),setFormInput("i_city",local.lastWeather?.approximation?.city??"Paris",data.weather.city),setFormInput("i_customfont",systemfont.placeholder,data.font?.family),setFormInput("i_gistsync","github_pat_XX000X00X",local?.gistToken),setFormInput("i_urlsync","https://pastebin.com/raw/y7XhhiDs",local?.distantUrl),setCheckbox("i_showall",data.showall),setCheckbox("i_settingshide",data.hide?.settingsicon??!1),setCheckbox("i_quicklinks",data.quicklinks),setCheckbox("i_linkgroups",data?.linkgroups?.on||!1),setCheckbox("i_linknewtab",data.linknewtab),setCheckbox("i_time",data.time),setCheckbox("i_analog",data.clock?.analog??!1),setCheckbox("i_seconds",data.clock?.seconds??!1),setCheckbox("i_worldclocks",data.clock?.worldclocks??!1),setCheckbox("i_main",data.main),setCheckbox("i_greethide",!data.hide?.greetings),setCheckbox("i_notes",data.notes?.on??!1),setCheckbox("i_sb",data.searchbar?.on??!1),setCheckbox("i_quotes",data.quotes?.on??!1),setCheckbox("i_ampm",data.clock?.ampm??!1),setCheckbox("i_ampm-label",data.clock?.ampmlabel??!1),setCheckbox("i_sbsuggestions",data.searchbar?.suggestions??!0),setCheckbox("i_sbnewtab",data.searchbar?.newtab??!1),setCheckbox("i_qtauthor",data.quotes?.author??!1),setCheckbox("i_supporters_notif",data.supporters?.enabled??!0),paramId("i_analog-border-shade")?.classList.toggle("on",(data.analogstyle?.border??"#fff").includes("#000")),paramId("i_analog-background-shade")?.classList.toggle("on",(data.analogstyle?.background??"#fff").includes("#000")),paramId("i_notes-shade")?.classList.toggle("on",(data.notes?.background??"#fff").includes("#000")),paramId("i_sb-shade")?.classList.toggle("on",(data.searchbar?.background??"#fff").includes("#000")),translatePlaceholders(),IS_MOBILE&&(domsettings.querySelector(".tooltiptext .instructions").textContent=tradThis("Edit your Quick Links by long-pressing the icon."));let i_lang=paramId("i_lang");Object.entries(langs_default).forEach(([code,title])=>{let option=document.createElement("option");option.value=code,option.text=title,i_lang.appendChild(option)}),setInput("i_lang",data.lang||"en"),paramId("time_options")?.classList.toggle("shown",data.time),paramId("analog_options")?.classList.toggle("shown",data.clock.analog&&data.showall),paramId("digital_options")?.classList.toggle("shown",!data.clock.analog),paramId("ampm_label")?.classList.toggle("shown",data.clock.ampm),paramId("worldclocks_options")?.classList.toggle("shown",data.clock.worldclocks),paramId("main_options")?.classList.toggle("shown",data.main),paramId("weather_provider")?.classList.toggle("shown",data.weather?.moreinfo==="custom"),paramId("quicklinks_options")?.classList.toggle("shown",data.quicklinks),paramId("notes_options")?.classList.toggle("shown",data.notes?.on||!1),paramId("searchbar_options")?.classList.toggle("shown",data.searchbar?.on),paramId("searchbar_request")?.classList.toggle("shown",data.searchbar?.engine==="custom"),paramId("quotes_options")?.classList.toggle("shown",data.quotes?.on),domsettings.querySelectorAll("#grid-layout button").forEach(b=>{let selectedLayout=b.dataset.layout===(data.move?.selection||"single");b?.classList.toggle("selected",selectedLayout)}),paramId("b_showtitles").classList.toggle("on",data?.linktitles??!0),paramId("b_showbackgrounds").classList.toggle("on",data?.linkbackgrounds??!0),function(){let{clock:clock2,date,weatherdesc,weathericon}=data.hide||{},time=!clock2&&!date?"all":clock2?"clock":"date",weather2=weatherdesc&&weathericon?"disabled":weatherdesc?"desc":weathericon?"icon":"all";setInput("i_timehide",time),setInput("i_weatherhide",weather2)}(),paramId("local_options")?.classList.toggle("shown",data.background_type==="local"),paramId("unsplash_options")?.classList.toggle("shown",data.background_type==="unsplash"),paramId("quotes_options")?.classList.toggle("shown",data.quotes?.on),paramId("quotes_userlist")?.classList.toggle("shown",data.quotes?.type==="user"),paramId("quotes_url")?.classList.toggle("shown",data.quotes?.type==="url"),document.querySelectorAll("#settings form").forEach(form=>{form.querySelectorAll("input").forEach(input=>{input.addEventListener("input",()=>form.classList.toggle("valid",form.checkValidity()))})}),document.querySelectorAll('select[name="worldclock-timezone"], #i_timezone').forEach(select=>{getHTMLTemplate("timezones-select-template","select").querySelectorAll("optgroup").forEach(group=>{select.appendChild(group)})}),document.querySelectorAll('select[name="worldclock-timezone"]').forEach((select,i)=>{let zones=["Europe/Paris","America/Sao_Paulo","America/Los_Angeles","Asia/Tokyo","Asia/Kolkata"];select.value=data?.worldclocks?.[i]?.timezone??zones[i]}),document.querySelectorAll('input[name="worldclock-city"]').forEach((input,i)=>{input.value=data?.worldclocks?.[i]?.region??""}),paramId("i_timezone").value=data.clock.timezone}function initOptionsEvents(){if(paramId("b_accept-permissions").onclickdown(async function(){await getPermissions("topSites","bookmarks");let data=await storage_default.sync.get();quickLinks(data),setTimeout(()=>initGroups(data),10),settingsNotifications({"accept-permissions":!1})}),paramId("i_showall").onclickdown(function(_,target){showall(target.checked,!0)}),paramId("i_lang").addEventListener("change",function(){switchLangs(this.value)}),paramId("i_favicon").addEventListener("input",function(){favicon(this.value,!0)}),paramId("i_favicon").addEventListener("change",function(){this.blur()}),paramId("i_tabtitle").addEventListener("input",function(){tabTitle(this.value,!0)}),paramId("i_tabtitle").addEventListener("change",function(){this.blur()}),paramId("i_dark").addEventListener("change",function(){darkmode(this.value,!0)}),paramId("i_settingshide").onclickdown(function(_,target){hideElements({settingsicon:target.checked},{isEvent:!0})}),paramId("i_quicklinks").onclickdown(function(_,target){moveElements(void 0,{widget:["quicklinks",target.checked]})}),paramId("f_addlink").addEventListener("submit",function(event){event.preventDefault(),quickLinks(void 0,{addLinks:[{title:paramId("i_addlink-title").value,url:paramId("i_addlink-url").value}]}),paramId("i_addlink-url").value="",paramId("i_addlink-title").value="",this.classList.remove("valid")}),paramId("i_linkgroups").onclickdown(function(_,target){quickLinks(void 0,{groups:target.checked})}),paramId("i_linknewtab").onclickdown(function(_,target){quickLinks(void 0,{newtab:target.checked})}),paramId("i_linkstyle").addEventListener("change",function(){quickLinks(void 0,{styles:{style:this.value}})}),paramId("b_showtitles").onclickdown(function(_,target){quickLinks(void 0,{styles:{titles:!target.classList.contains("on")}})}),paramId("b_showbackgrounds").onclickdown(function(_,target){quickLinks(void 0,{styles:{backgrounds:!target.classList.contains("on")}})}),paramId("i_row").addEventListener("input",function(){quickLinks(void 0,{row:this.value})}),paramId("b_importbookmarks").onclickdown(async function(){await getPermissions("topSites","bookmarks"),linksImport()}),paramId("i_type").addEventListener("change",function(){selectBackgroundType(this.value)}),paramId("i_freq").addEventListener("change",function(){updateBackgroundOption({freq:this.value})}),paramId("i_refresh").onclickdown(function(_,target){updateBackgroundOption({refresh:target.children[0]})}),paramId("f_collection").addEventListener("submit",function(event){event.preventDefault(),unsplashBackgrounds(void 0,{collection:stringMaxSize(paramId("i_collection").value,256)})}),paramId("i_background-upload").addEventListener("change",function(){localBackgrounds({newfile:this.files})}),paramId("b_thumbnail-all").onclickdown(function(){localBackgrounds({showing:"all"})}),paramId("i_blur").addEventListener("input",function(){backgroundFilter({blur:parseFloat(this.value),isEvent:!0})}),paramId("i_bright").addEventListener("input",function(){backgroundFilter({brightness:parseFloat(this.value),isEvent:!0})}),paramId("i_time").onclickdown(function(_,target){moveElements(void 0,{widget:["time",target.checked]})}),paramId("i_analog").onclickdown(function(_,target){clock(void 0,{analog:target.checked})}),paramId("i_seconds").onclickdown(function(_,target){clock(void 0,{seconds:target.checked})}),paramId("i_worldclocks").onclickdown(function(_,target){paramId("worldclocks_options")?.classList.toggle("shown",target.checked),clock(void 0,{worldclocks:target.checked})}),document.querySelectorAll('input[name="worldclock-city"]')?.forEach((input,i)=>{input.addEventListener("input",()=>clock(void 0,{world:{index:i,region:input.value}}))}),document.querySelectorAll('select[name="worldclock-timezone"]')?.forEach((select,i)=>{select.addEventListener("change",()=>clock(void 0,{world:{index:i,timezone:select.value}}))}),paramId("i_clockface").addEventListener("change",function(){clock(void 0,{face:this.value})}),paramId("i_clockhands").addEventListener("change",function(){clock(void 0,{hands:this.value})}),paramId("i_analog-border-opacity").addEventListener("input",function(){clock(void 0,{border:"opacity"})}),paramId("i_analog-background-opacity").addEventListener("input",function(){clock(void 0,{background:"opacity"})}),paramId("i_analog-border-shade").addEventListener("click",function(){clock(void 0,{border:"shade"})}),paramId("i_analog-background-shade").addEventListener("click",function(){clock(void 0,{background:"shade"})}),paramId("i_clockshape").addEventListener("change",function(){clock(void 0,{shape:this.value})}),paramId("i_clocksize").addEventListener("input",function(){clock(void 0,{size:parseFloat(this.value)})}),paramId("i_ampm").onclickdown(function(_,target){clock(void 0,{ampm:target.checked})}),paramId("i_ampm-label").onclickdown(function(_,target){clock(void 0,{ampmlabel:target.checked})}),paramId("i_timezone").addEventListener("change",function(){clock(void 0,{timezone:this.value})}),paramId("i_dateformat").addEventListener("change",function(){clock(void 0,{dateformat:this.value})}),paramId("i_timehide").addEventListener("change",function(){hideElements({clock:this.value==="clock",date:this.value==="date"},{isEvent:!0})}),paramId("i_main").onclickdown(function(_,target){moveElements(void 0,{widget:["main",target.checked]})}),paramId("i_geol").addEventListener("change",function(){weather(void 0,{geol:this?.value})}),paramId("i_city").addEventListener("input",function(event){weather(void 0,{suggestions:event})}),paramId("f_location").addEventListener("submit",function(event){weather(void 0,{city:!0}),event.preventDefault()}),paramId("i_units").addEventListener("change",function(){weather(void 0,{units:this.value})}),paramId("i_forecast").addEventListener("change",function(){weather(void 0,{forecast:this.value})}),paramId("i_temp").addEventListener("change",function(){weather(void 0,{temp:this.value})}),paramId("i_moreinfo").addEventListener("change",function(){weather(void 0,{moreinfo:this.value})}),paramId("i_provider").addEventListener("change",function(){weather(void 0,{provider:this.value}),this.blur()}),paramId("i_weatherhide").addEventListener("change",function(){let weatherdesc=this.value==="disabled"||this.value==="desc",weathericon=this.value==="disabled"||this.value==="icon";hideElements({weatherdesc,weathericon},{isEvent:!0}),weather(void 0,{unhide:!0})}),paramId("i_greethide").onclickdown(function(_,target){hideElements({greetings:!target.checked},{isEvent:!0})}),paramId("i_greeting").addEventListener("input",function(){clock(void 0,{greeting:this.value})}),paramId("i_greeting").addEventListener("change",function(){paramId("i_greeting").blur()}),paramId("i_notes").onclickdown(function(_,target){moveElements(void 0,{widget:["notes",target.checked]})}),paramId("i_notesalign").addEventListener("change",function(){notes(void 0,{align:this.value})}),paramId("i_noteswidth").addEventListener("input",function(){notes(void 0,{width:this.value})}),paramId("i_notes-opacity").addEventListener("input",function(){notes(void 0,{background:!0})}),paramId("i_notes-shade").onclickdown(function(){notes(void 0,{background:!0})}),paramId("i_sb").onclickdown(function(_,target){moveElements(void 0,{widget:["searchbar",target.checked]}),getPermissions("search")}),paramId("i_sbengine").addEventListener("change",function(){searchbar(void 0,{engine:this.value})}),paramId("i_sb-opacity").addEventListener("input",function(){searchbar(void 0,{background:!0})}),paramId("i_sb-shade").addEventListener("click",function(){searchbar(void 0,{background:!0})}),paramId("i_sbwidth").addEventListener("input",function(){searchbar(void 0,{width:this.value})}),paramId("i_sbrequest").addEventListener("change",function(){searchbar(void 0,{request:this})}),paramId("i_sbnewtab").onclickdown(function(_,target){searchbar(void 0,{newtab:target.checked})}),paramId("i_sbsuggestions").onclickdown(function(_,target){searchbar(void 0,{suggestions:target.checked})}),paramId("i_sbplaceholder").addEventListener("keyup",function(){searchbar(void 0,{placeholder:this.value})}),paramId("i_sbplaceholder").addEventListener("change",function(){paramId("i_sbplaceholder").blur()}),paramId("i_quotes").onclickdown(function(_,target){moveElements(void 0,{widget:["quotes",target.checked]})}),paramId("i_qtfreq").addEventListener("change",function(){quotes(void 0,{frequency:this.value})}),paramId("i_qttype").addEventListener("change",function(){quotes(void 0,{type:this.value})}),paramId("i_qtrefresh").onclickdown(function(_,target){inputThrottle(target),turnRefreshButton(target.children[0],!0),quotes(void 0,{refresh:!0})}),paramId("i_qtauthor").onclickdown(function(_,target){quotes(void 0,{author:target.checked})}),paramId("i_qtlist").addEventListener("change",function(){quotes(void 0,{userlist:this.value})}),paramId("f_qturl").addEventListener("submit",function(event){event.preventDefault(),quotes(void 0,{url:paramId("i_qturl").value})}),paramId("i_customfont").addEventListener("pointerenter",function(){customFont(void 0,{autocomplete:!0})}),paramId("f_customfont").addEventListener("submit",function(event){customFont(void 0,{family:paramId("i_customfont").value}),event.preventDefault()}),paramId("i_weight").addEventListener("input",function(){customFont(void 0,{weight:this.value})}),paramId("i_size").addEventListener("input",function(){customFont(void 0,{size:this.value})}),paramId("i_textshadow").addEventListener("input",function(){textShadow(void 0,parseFloat(this.value))}),paramId("b_editmove").onclickdown(function(){moveElements(void 0,{toggle:!document.getElementById("interface")?.classList.contains("move-edit")})}),paramId("i_pagecolumns").addEventListener("change",function(){moveElements(void 0,{layout:this.value,toggle:!0})}),paramId("i_pagewidth").addEventListener("input",function(){pageControl({width:parseInt(this.value)},!0)}),paramId("i_pagegap").addEventListener("input",function(){pageControl({gap:parseFloat(this.value)},!0)}),paramId("i_pagewidth").addEventListener("touchstart",()=>moveElements(void 0,{overlay:!0}),{passive:!0}),paramId("i_pagewidth").addEventListener("mousedown",()=>moveElements(void 0,{overlay:!0})),paramId("i_pagewidth").addEventListener("touchend",()=>moveElements(void 0,{overlay:!1})),paramId("i_pagewidth").addEventListener("mouseup",()=>moveElements(void 0,{overlay:!1})),paramId("i_announce").addEventListener("change",function(){interfacePopup(void 0,{announcements:this.value})}),paramId("i_supporters_notif").onclickdown(function(_,target){supportersNotifications(void 0,{enabled:target.checked})}),paramId("i_synctype").addEventListener("change",function(){synchronization(void 0,{type:this.value})}),paramId("f_gistsync").addEventListener("submit",function(event){event.preventDefault(),synchronization(void 0,{gistToken:paramId("i_gistsync").value})}),paramId("f_urlsync").addEventListener("submit",function(event){event.preventDefault(),synchronization(void 0,{url:paramId("i_urlsync").value})}),paramId("b_storage-persist").onclickdown(async function(){let persists=await navigator.storage.persist();synchronization(void 0,{firefoxPersist:persists})}),paramId("b_gistup").onclickdown(function(){synchronization(void 0,{up:!0})}),paramId("b_gistdown").onclickdown(function(){synchronization(void 0,{down:!0})}),paramId("b_urldown").onclickdown(function(){synchronization(void 0,{down:!0})}),paramId("settings-managment").addEventListener("dragenter",function(){paramId("settings-managment").classList.add("dragging-file")}),paramId("file-import").addEventListener("dragleave",function(){paramId("settings-managment").classList.remove("dragging-file")}),paramId("b_file-load").addEventListener("click",function(){paramId("file-import")?.click()}),paramId("b_file-save").addEventListener("click",function(){saveImportFile()}),paramId("file-import").addEventListener("change",function(){loadImportFile(this)}),paramId("b_settings-copy").addEventListener("click",function(){copySettings()}),paramId("settings-data").addEventListener("input",function(event){toggleSettingsChangesButtons(event.type)}),paramId("settings-data").addEventListener("focus",function(event){toggleSettingsChangesButtons(event.type)}),paramId("settings-data").addEventListener("blur",function(event){toggleSettingsChangesButtons(event.type)}),paramId("b_settings-cancel").onclickdown(function(){toggleSettingsChangesButtons("cancel")}),paramId("b_settings-apply").onclickdown(function(){let val=paramId("settings-data").value;importSettings(parse(val)??{})}),paramId("b_reset-first").onclickdown(function(){resetSettings("first")}),paramId("b_reset-apply").onclickdown(function(){resetSettings("yes")}),paramId("b_reset-cancel").onclickdown(function(){resetSettings("no")}),IS_MOBILE){let touchHandler=touch=>document.getElementById("settings")?.classList.toggle("see-through",touch);document.querySelectorAll("input[type='range'").forEach(input=>{input.addEventListener("touchstart",()=>touchHandler(!0),{passive:!0}),input.addEventListener("touchend",()=>touchHandler(!1),{passive:!0})})}document.querySelectorAll('input[type="file"]').forEach(input=>{let toggleDrag=_=>{input.classList.toggle("dragover")};input?.addEventListener("dragenter",toggleDrag),input?.addEventListener("dragleave",toggleDrag),input?.addEventListener("drop",toggleDrag)}),document.querySelectorAll(".tooltip").forEach(elem=>{elem.onclickdown(function(){let cl=[...elem.classList].filter(c=>c.startsWith("tt"))[0];document.querySelector(".tooltiptext."+cl)?.classList.toggle("shown")})}),document.querySelectorAll(".split-range button")?.forEach(button=>{button.onclickdown(()=>button.classList.toggle("on"))})}function translatePlaceholders(){let cases=[["i_title","Name"],["i_greeting","Name"],["i_tabtitle","New tab"],["i_sbrequest","Search query: %s"],["i_sbplaceholder","Search"],["css-editor-textarea","Type in your custom CSS"],["i_importtext","or paste as text"],["i_addlink-title","Title"],["i_addlink-url","example.com"],["i_qtlist",`Author, Your quote.
Author, Your second quote.`]];for(let[id,text]of cases)document.getElementById(id)?.setAttribute("placeholder",tradThis(text))}function translateAriaLabels(){for(let element of document.querySelectorAll("[title]")){let title=element.getAttribute("title")??"";element.setAttribute("title",tradThis(title)),element.setAttribute("aria-label",tradThis(title))}}async function switchLangs(nextLang){await toggleTraduction(nextLang),storage_default.sync.set({lang:nextLang}),storage_default.local.remove("quotesCache"),document.documentElement.setAttribute("lang",nextLang);let data=await storage_default.sync.get(),local=await storage_default.local.get(["quotesCache","userQuoteSelection","lastWeather"]);local?.lastWeather&&(local.lastWeather.timestamp=0,local.lastWeather.forecasted_timestamp=0),data.lang=nextLang,clock(data),changeGroupTitle({old:"",new:""},data),weather({sync:data,lastWeather:local.lastWeather}),quotes({sync:data,local}),tabTitle(data.tabtitle),notes(data.notes),customFont(void 0,{lang:!0}),settingsFooter(),translatePlaceholders(),translateAriaLabels(),supportersNotifications(void 0,{translate:!0})}function showall(val,event){document.getElementById("settings")?.classList.toggle("all",val),event&&storage_default.sync.set({showall:val})}async function selectBackgroundType(cat){if(document.getElementById("local_options")?.classList.toggle("shown",cat==="local"),document.getElementById("unsplash_options")?.classList.toggle("shown",cat==="unsplash"),cat==="local"&&(localBackgrounds({settings:document.getElementById("settings")}),setTimeout(()=>localBackgrounds(),100),storage_default.sync.set({background_type:"local"})),cat==="unsplash"){let data=await storage_default.sync.get(),local=await storage_default.local.get("unsplashCache");if(!data.unsplash)return;document.querySelector("#i_freq").value=data.unsplash.every||"hour",document.getElementById("credit-container")?.classList.toggle("shown",!0),setTimeout(()=>unsplashBackgrounds({unsplash:data.unsplash,cache:local.unsplashCache}),100),storage_default.sync.set({background_type:"unsplash"})}}function settingsFooter(){let one=document.querySelector("#signature-one"),two=document.querySelector("#signature-two"),version=document.getElementById("version"),rand=Math.random()>.5;one&&two&&(one.href=rand?"https://victr.me/":"https://tahoe.be/",two.href=rand?"https://tahoe.be/":"https://victr.me/",one.textContent=rand?"Victor Azevedo":"Tahoe Beetschen",two.textContent=rand?"Tahoe Beetschen":"Victor Azevedo"),version&&(version.textContent=SYNC_DEFAULT.about.version)}function settingsDrawerBar(){let drawerDragDebounce=debounce(()=>{document.getElementById("settings-footer").style.removeProperty("padding"),drawerDragEvents()},600);window.addEventListener("resize",()=>{drawerDragDebounce(),document.getElementById("settings")?.style.transition||document.getElementById("settings")?.setAttribute("style","transition: none")}),drawerDragEvents()}function drawerDragEvents(){let mobileDragZone=document.getElementById("mobile-drag-zone"),settingsDom=document.getElementById("settings"),dragZoneHeight=mobileDragZone.getBoundingClientRect().height,settingsVh=-75,firstPos2=0,startTouchY=0;mobileDragZone?.addEventListener("touchstart",dragStart,{passive:!1}),mobileDragZone?.addEventListener("pointerdown",dragStart,{passive:!1});function dragStart(e){e.preventDefault(),!settingsDom.classList.contains("dragging-mobile-settings")&&(e.type==="pointerdown"&&(startTouchY=e.clientY),e.type==="touchstart"&&(startTouchY=e.touches[0].clientY),firstPos2===0&&(firstPos2=startTouchY),window.addEventListener("touchmove",dragMove),window.addEventListener("pointermove",dragMove),document.body.addEventListener("touchend",dragEnd),document.body.addEventListener("pointerup",dragEnd),document.body.classList.add("dragging-mobile-settings"))}function dragMove(e){let clientY=0;e.type==="pointermove"&&(clientY=e.clientY),e.type==="touchmove"&&(clientY=e.touches[0].clientY),clientY>60&&(settingsVh=+(100-(clientY-dragZoneHeight/2)/window.innerHeight*100).toFixed(2),settingsDom.style.transform=`translateY(-${settingsVh}dvh)`,settingsDom.style.transition="transform .0s")}function dragEnd(e){let clientY=0;e.type==="pointerup"&&(clientY=e.clientY),e.type==="touchend"&&(clientY=e.changedTouches[0].clientY),window.removeEventListener("touchmove",dragMove),window.removeEventListener("pointermove",dragMove),document.body.removeEventListener("touchend",dragEnd),document.body.removeEventListener("pointerup",dragEnd),startTouchY=0;let footer=document.getElementById("settings-footer");footer.style.paddingBottom=100-Math.abs(settingsVh)+"dvh",settingsDom.style.removeProperty("padding"),settingsDom.style.removeProperty("width"),settingsDom.style.removeProperty("overflow"),settingsDom.classList.remove("dragging"),clientY>window.innerHeight-100&&settingsToggle()}}async function copySettings(){let copybtn=document.querySelector("#b_settings-copy span"),pre=document.getElementById("settings-data");try{navigator.clipboard.writeText(pre?.textContent??"{}"),copybtn&&(copybtn.textContent=tradThis("Copied!"),setTimeout(()=>copybtn.textContent=tradThis("Copy"),1e3))}catch(error){console.error(`Failed when copying: ${error}`)}}async function saveImportFile(){let a=document.getElementById("file-download");if(!a)return;let date=new Date,data=await storage_default.sync.get()??{},zero=n=>n.toString().length===1?"0"+n:n.toString(),YYYYMMDD=date.toISOString().slice(0,10),HHMMSS=`${zero(date.getHours())}_${zero(date.getMinutes())}_${zero(date.getSeconds())}`,bytes=new TextEncoder().encode(orderedStringify(data)),blob=new Blob([bytes],{type:"application/json;charset=utf-8"}),href=URL.createObjectURL(blob);a.setAttribute("href",href),a.setAttribute("tabindex","-1"),a.setAttribute("download",`bonjourr-${data?.about?.version} ${YYYYMMDD} ${HHMMSS}.json`),a.click()}function loadImportFile(target){function decodeExportFile(str){let result={};try{result=parse(atob(str))??{}}catch{try{result=parse(str)??{}}catch{result={}}}return result}if(!target.files||target.files&&target.files.length===0)return;let file=target.files[0],reader=new FileReader;reader.onload=()=>{if(typeof reader.result!="string")return!1;let importData=decodeExportFile(reader.result);Object.keys(SYNC_DEFAULT).filter(key=>key in importData).length>0&&importSettings(importData)},reader.readAsText(file)}async function importSettings(imported){try{let data=await storage_default.sync.get();if(imported?.font?.system===!1){let family=imported?.font?.family,lang=imported?.lang;await fontIsAvailableInSubset(lang,family)===!1&&(imported.font.family="")}imported?.searchbar?.on&&getPermissions("search"),data=filterImports(data,imported),storage_default.sync.clear(),storage_default.sync.set(data),fadeOut()}catch(e){console.log(e)}}function resetSettings(action){if(action==="yes"){storage_default.clearall().then(fadeOut);return}document.getElementById("reset-first")?.classList.toggle("shown",action==="no"),document.getElementById("reset-conf")?.classList.toggle("shown",action==="first")}function updateSettingsJSON(data){data?updateTextArea(data):storage_default.sync.get().then(updateTextArea);function updateTextArea(data2){let pre=document.getElementById("settings-data");pre&&data2.about&&(data2.about.browser=PLATFORM,pre.textContent=orderedStringify(data2))}}function updateSettingsEvent(){let storageUpdate=()=>updateSettingsJSON(),removeListener=()=>chrome.storage.onChanged.removeListener(storageUpdate);PLATFORM==="online"?window.addEventListener("storage",storageUpdate):(chrome.storage.onChanged.addListener(storageUpdate),window.addEventListener("beforeunload",removeListener,{once:!0}))}async function toggleSettingsChangesButtons(action){let textarea=paramId("settings-data"),data=await storage_default.sync.get(),hasChanges=!1;if(action==="input"){let current=orderedStringify(data),user="";try{user=orderedStringify(JSON.parse(textarea.value??"{}"))}catch{}hasChanges=user.length>2&&current!==user,hasChanges?paramId("b_settings-apply")?.removeAttribute("disabled"):paramId("b_settings-apply")?.setAttribute("disabled","")}action==="cancel"&&(textarea.value=orderedStringify(data),hasChanges=!1),action==="focus"&&(paramId("settings-files-options")?.classList.add("hidden"),paramId("settings-changes-options")?.classList.remove("hidden")),action==="blur"&&(paramId("settings-changes-options")?.classList.add("hidden"),paramId("settings-files-options")?.classList.remove("hidden"))}function paramId(str){return document.getElementById(str)}function setCheckbox(id,cat){let checkbox=paramId(id);checkbox.checked=cat}function setInput(id,val){let input=paramId(id);input.value=typeof val=="string"?val:val?.toString()}function setFormInput(id,defaults,value){let input=paramId(id);value?(input.value=value,input.setAttribute("placeholder",value)):input.setAttribute("placeholder",defaults)}function clickdown(callback,options){let self=this,isCheckbox=self.tagName==="INPUT"&&self.getAttribute("type")==="checkbox",isLink2=self.tagName==="A",isFast=!1;self?.addEventListener("pointerdown",downEvent),self?.addEventListener("keydown",downEvent),self?.addEventListener("click",clickEvent);function downEvent(event){let isKeydown=event.type==="keydown",code=event?.code??"",tagName=event.target.tagName??"";if(!(isKeydown&&!code.match(/Space|Enter/))&&!(isLink2&&isKeydown&&code==="Space")){if(tagName==="SUMMARY"){let details=self;details.open=!details.open}if(isCheckbox){let checkbox=self;checkbox.checked=!checkbox.checked}if(isLink2){let link=self;window.location.href=link.href}isFast=!0,callback(event,self)}}function clickEvent(event){if(!(event.composedPath()[0]!==self&&options?.propagate===!1)){if(isFast===!1){callback(event,self);return}isFast=!1,event.preventDefault()}}}Element.prototype.onclickdown=clickdown;HTMLElement.prototype.onclickdown=clickdown;HTMLInputElement.prototype.onclickdown=clickdown;var dominterface3=document.getElementById("interface"),features=["clock","links"],interfaceDisplayCallback=()=>{},loadtime=performance.now();try{startup(),serviceWorker(),onlineAndMobile()}catch(error){errorMessage(error)}async function startup(){let{sync,local}=await storage_default.init(),OLD_VERSION=sync?.about?.version;if(!sync||!local){errorMessage("Storage failed \u{1F625}");return}OLD_VERSION!==CURRENT_VERSION&&(console.log(`Version change: ${OLD_VERSION} => ${CURRENT_VERSION}`),sync=upgradeSyncStorage(sync),local=upgradeLocalStorage(local),await storage_default.sync.clear(),await storage_default.sync.set(sync)),await setTranslationCache(sync.lang,local),displayInterface(void 0,sync),traduction(null,sync.lang),suntime(local.lastWeather?.sunrise,local.lastWeather?.sunset),weather({sync,lastWeather:local.lastWeather}),customFont(sync.font),textShadow(sync.textShadow),favicon(sync.favicon),tabTitle(sync.tabtitle),clock(sync),darkmode(sync.dark),searchbar(sync.searchbar),quotes({sync,local}),notes(sync.notes),moveElements(sync.move),customCss(sync.css),hideElements(sync.hide),initBackground(sync,local),quickLinks(sync),synchronization(local),pageControl({width:sync.pagewidth,gap:sync.pagegap}),operaExtensionExplainer(local.operaExplained),document.documentElement.dataset.system=SYSTEM_OS,document.documentElement.dataset.browser=BROWSER,document.documentElement.dataset.platform=PLATFORM,document.getElementById("time")?.classList.toggle("hidden",!sync.time),document.getElementById("main")?.classList.toggle("hidden",!sync.main),onInterfaceDisplay(()=>{document.body.classList.remove("init"),settingsPreload(),userActionsEvents(),setPotatoComputerMode(),supportersNotifications({supporters:sync.supporters,review:sync.review}),interfacePopup({old:OLD_VERSION,new:CURRENT_VERSION,review:sync.review??0,announce:sync.announcements})})}function upgradeSyncStorage(data){return filterImports(data,data)}function upgradeLocalStorage(data){return data.translations=void 0,storage_default.local.remove("translations"),data}function displayInterface(ready,data){if(data){data?.font?.family&&features.push("fonts"),data?.quotes?.on&&features.push("quotes");return}else if(!ready)return;let index=features.indexOf(ready);if(index!==-1)features.splice(index,1);else return;features.length>0||(loadtime=Math.min(performance.now()-loadtime,400),loadtime=loadtime>33?loadtime:0,document.documentElement.style.setProperty("--load-time-transition",loadtime+"ms"),document.body.classList.remove("loading"),setTimeout(()=>{onInterfaceDisplay()},Math.max(333,loadtime)))}function onInterfaceDisplay(callback){callback?interfaceDisplayCallback=callback:interfaceDisplayCallback()}function userActionsEvents(){let domsuggestions2=document.getElementById("sb-suggestions"),isMousingDownOnInput=!1;document.body.addEventListener("mousedown",detectTargetAsInputs),document.getElementById("b_editmove")?.addEventListener("click",closeSettingsOnMoveOpen),document.addEventListener("click",clickUserActions),document.addEventListener("keydown",keydownUserActions),document.addEventListener("keyup",keydownUserActions);function keydownUserActions(event){if(event.code==="Escape"){if(domsuggestions2?.classList.contains("shown")){domsuggestions2?.classList.remove("shown");return}let open=isOpen(),keyup=event.type==="keyup";open.contextmenu?document.dispatchEvent(new Event("close-edit")):open.settings&&keyup?document.dispatchEvent(new Event("toggle-settings")):open.selectall?document.dispatchEvent(new Event("remove-select-all")):open.folder?document.dispatchEvent(new Event("close-folder")):keyup&&document.documentElement.dataset.supportersModal===void 0&&document.dispatchEvent(new Event("toggle-settings"));return}if(event.code==="Tab"){document.body.classList.toggle("tabbing",!0);return}}function clickUserActions(event){if(isMousingDownOnInput)return;let open=isOpen(),path=(event.composedPath()??[document.body]).filter(node=>node?.className?.includes),pathIds=path.map(el=>el.id),on={body:path[0].tagName==="BODY",link:path.some(el=>el.classList.contains("link")),linkfolder:path.some(el=>el.className.includes("folder")),addgroup:path.some(el=>el.className.includes("add-group")),folder:path.some(el=>el.className.includes("in-folder")),interface:pathIds.includes("interface"),editlink:pathIds.includes("editlink"),settings:path.some(el=>el.id==="settings"),showsettings:path.some(el=>el.id==="show-settings")};if(document.body.classList.contains("tabbing")&&document.body?.classList.toggle("tabbing",!1),on.showsettings&&document.dispatchEvent(new Event("toggle-settings")),open.contextmenu&&!on.editlink){if(on.addgroup&&document.querySelector(".link-title.add-group.selected"))return;document.dispatchEvent(new Event("close-edit"));return}(on.body||on.interface)!==!1&&(open.settings?document.dispatchEvent(new Event("toggle-settings")):open.selectall&&!on.link?document.dispatchEvent(new Event("remove-select-all")):open.folder&&!on.folder&&!on.linkfolder&&document.dispatchEvent(new Event("close-folder")))}function isOpen(){return{settings:!!document.getElementById("settings")?.classList.contains("shown"),folder:!!document.querySelector(".in-folder"),selectall:document.getElementById("linkblocks")?.classList.contains("select-all"),contextmenu:document.querySelector("#editlink")?.open}}function detectTargetAsInputs(event){let tagName=event.composedPath()[0]?.tagName??"";isMousingDownOnInput=["TEXTAREA","INPUT"].includes(tagName)}function closeSettingsOnMoveOpen(){setTimeout(()=>{document.getElementById("element-mover")?.classList.contains("hidden")===!1&&document.dispatchEvent(new Event("toggle-settings"))},20)}}function onlineAndMobile(){let onlineFirefoxMobile=PLATFORM==="online"&&BROWSER==="firefox"&&IS_MOBILE,onlineSafariIOS=PLATFORM==="online"&&BROWSER==="safari"&&SYSTEM_OS==="ios",visibilityHasChanged=!1,firefoxRAFTimeout;IS_MOBILE&&document.addEventListener("visibilitychange",updateOnVisibilityChange),onlineFirefoxMobile&&(updateAppHeight(),SYSTEM_OS==="ios"&&(window.requestAnimationFrame(triggerAnimationFrame),setTimeout(()=>cancelAnimationFrame(firefoxRAFTimeout),500))),onlineSafariIOS&&onSettingsLoad(()=>{let inputs=document.querySelectorAll('input[type="text"], input[type="url"], textarea');for(let input of inputs)input.addEventListener("focus",disableTouchAction),input.addEventListener("blur",enableTouchAction)});async function updateOnVisibilityChange(){if(visibilityHasChanged===!1){visibilityHasChanged=!0;return}visibilityHasChanged=!1;let data=await storage_default.sync.get(),local=await storage_default.local.get(["unsplashCache","lastWeather"]);if(!data?.clock||!data?.weather)return;let frequency=freqControl.get(data.unsplash.every,data.unsplash.time??Date.now());data.background_type==="unsplash"&&frequency&&data.unsplash&&initBackground(data,local),clock(data),weather({sync:data,lastWeather:local.lastWeather})}function triggerAnimationFrame(){updateAppHeight(),firefoxRAFTimeout=requestAnimationFrame(triggerAnimationFrame)}function updateAppHeight(){document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)}function disableTouchAction(){let settingsDom=document.getElementById("settings");dominterface3&&settingsDom&&(dominterface3.style.touchAction="none",settingsDom.style.touchAction="none")}function enableTouchAction(){let settingsDom=document.getElementById("settings");dominterface3&&settingsDom&&(dominterface3.style.removeProperty("touch-action"),settingsDom.style.removeProperty("touch-action"))}}function serviceWorker(){if(ENVIRONNEMENT!=="PROD"||PLATFORM!=="online"||!("serviceWorker"in navigator))return;navigator.serviceWorker.register("service-worker.js");let promptEvent;window.addEventListener("beforeinstallprompt",function(e){return promptEvent=e,promptEvent})}function setPotatoComputerMode(){if(BROWSER==="firefox"||BROWSER==="safari")return;let fourHours=1e3*60*60*4,isPotato=localStorage.potato==="yes";if(Date.now()-parseInt(localStorage.lastPotatoCheck??"0")<fourHours){document.body.classList.toggle("potato",isPotato);return}let gl=document.createElement("canvas")?.getContext("webgl"),debugInfo=gl?.getExtension("WEBGL_debug_renderer_info");if(BROWSER==="chrome"&&!gl){document.body.classList.add("potato");return}let vendor=gl?.getParameter(debugInfo?.UNMASKED_VENDOR_WEBGL??0)+"",renderer=gl?.getParameter(debugInfo?.UNMASKED_RENDERER_WEBGL??0)+"",detectedPotato=vendor.includes("Google")&&renderer.includes("SwiftShader");localStorage.potato=detectedPotato?"yes":"no",localStorage.lastPotatoCheck=Date.now(),document.body.classList.toggle("potato",detectedPotato)}function operaExtensionExplainer(explained){if(explained||BROWSER!=="opera"||PLATFORM!=="chrome")return;let doc=document.getElementById("opera-explainer-template").content.cloneNode(!0),dialog=doc.getElementById("opera-explainer"),button=doc.getElementById("b_opera-explained");document.body.classList.add("loading"),document.body.appendChild(dialog),dialog.showModal(),setTimeout(()=>dialog.classList.add("shown")),button?.addEventListener("click",()=>{storage_default.local.set({operaExplained:!0}),document.body.classList.remove("loading"),dialog.close()})}})();
